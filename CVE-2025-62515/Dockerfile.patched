# CVE-2025-62515 Lab — pyquokka FlightServer (Patched — json.loads for do_action)
# Exploit Intelligence Platform | https://exploit-intel.com | @exploit_intel

FROM python:3.10-slim-bookworm

# Install only the minimal dependencies needed for the standalone FlightServer
# pyarrow: Apache Arrow Flight server (gRPC transport layer)
# polars: DataFrame operations used in FlightServer
# psutil: System monitoring used in check_puttable action
RUN pip install --no-cache-dir pyarrow polars psutil

# Copy the PATCHED flight.py with json.loads fix for do_action methods
# Fix: set_configs and cache_garbage_collect now use json.loads() instead of pickle.loads()
# Note: do_put and do_get still use pickle.loads() (simulated incomplete fix)
COPY flight_patched.py /app/flight.py

WORKDIR /app

# FlightServer listens on gRPC port 5005
EXPOSE 5005

# Start the FlightServer - binds to 0.0.0.0:5005 (all interfaces, no auth)
CMD ["python", "/app/flight.py"]
