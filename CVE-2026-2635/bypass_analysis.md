# Bypass Analysis: CVE-2026-2635

## CVE Summary

| Field | Value |
|---|---|
| **CVE ID** | CVE-2026-2635 |
| **Title** | MLflow Authentication Bypass via Default Credentials |
| **CVSS** | 9.8 Critical (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H) |
| **CWE** | CWE-1393 (Use of Default Credentials) |
| **Affected** | MLflow v2.3.0 – v3.10.0+ with `--app-name basic-auth` |

---

## Bypass Result: ✅ SUCCESSFUL

A **complete authentication bypass** was identified in MLflow's FastAPI route handling. Even when the default admin password is changed (the recommended remediation for CVE-2026-2635), multiple FastAPI API endpoints remain **completely unauthenticated**, allowing an attacker to enumerate jobs, submit background tasks, inject OTEL traces into experiments, and potentially achieve remote code execution — all without any credentials.

---

## Bypass Hypothesis

### What We Expected to Work

The MLflow server (v3.9.0) uses a hybrid Flask/FastAPI architecture. Flask routes are protected by the `_before_request()` hook which enforces HTTP Basic Auth. FastAPI routes are protected by a separate `fastapi_permission_middleware()`. We hypothesized that the FastAPI middleware might not cover all routes, creating an authentication bypass for FastAPI-served endpoints.

### Why We Believed the Fix Was Incomplete

The Analysis agent noted that no official fix exists for CVE-2026-2635 (hardcoded default credentials). The recommended remediation is for administrators to change the default password. However, examining the source code revealed that the FastAPI permission middleware in `mlflow/server/auth/__init__.py` only validates `/gateway/` routes in its `_find_fastapi_validator()` function, while several other FastAPI routes exist:
- `/v1/traces` (OTEL trace ingestion)
- `/ajax-api/3.0/jobs/*` (background job management)
- `/ajax-api/3.0/mlflow/assistant/*` (AI assistant)

These routes would pass through the auth middleware without any authentication check, regardless of whether the default password was changed.

---

## Bypass Method

### Technical Description

The FastAPI permission middleware (`add_fastapi_permission_middleware`) in `mlflow/server/auth/__init__.py` (line 2179 in v3.9.0) works as follows:

```python
@app.middleware("http")
async def fastapi_permission_middleware(request, call_next):
    path = request.url.path

    # Skip unprotected routes
    if is_unprotected_route(path):
        return await call_next(request)

    # Find validator for this route
    validator = _find_fastapi_validator(path)
    if validator is None:
        return await call_next(request)  # ← NO AUTH CHECK!

    # ... authentication and authorization follow ...
```

The `_find_fastapi_validator()` function (line 2159) only handles `/gateway/` routes:

```python
def _find_fastapi_validator(path):
    if path.startswith("/gateway/"):
        return _get_gateway_validator(path)
    return None  # ← All other FastAPI routes bypass auth!
```

When `validator is None` (i.e., for any non-gateway FastAPI route), the middleware passes the request through **without any authentication or authorization check**. This means the following FastAPI routes are completely unauthenticated:

| Route | Method | Impact |
|---|---|---|
| `/ajax-api/3.0/jobs/search` | POST | Job enumeration — information disclosure |
| `/ajax-api/3.0/jobs/` | POST | Job submission — potential code execution |
| `/ajax-api/3.0/jobs/{id}` | GET | Job detail retrieval — information disclosure |
| `/ajax-api/3.0/jobs/cancel/{id}` | PATCH | Job cancellation — availability impact |
| `/v1/traces` | POST | OTEL trace injection — data integrity impact |
| `/ajax-api/3.0/mlflow/assistant/*` | Various | AI assistant (blocked by separate localhost check) |

### Attack Technique

1. **No credentials required** — The attacker sends requests to FastAPI routes without any `Authorization` header
2. **Jobs API access** — `POST /ajax-api/3.0/jobs/search` returns all background jobs (HTTP 200)
3. **Job submission** — `POST /ajax-api/3.0/jobs/` can submit scorer jobs (evaluations) that execute server-side
4. **Trace injection** — `POST /v1/traces` can inject OTEL traces into any experiment, poisoning ML data
5. **Job cancellation** — `PATCH /ajax-api/3.0/jobs/cancel/{id}` can disrupt running evaluations

### Difference from Original PoC

The original PoC exploits **hardcoded default credentials** (HTTP Basic Auth with `admin:password1234`). This bypass uses a completely **different technique**: it accesses FastAPI routes that **skip the authentication middleware entirely**, requiring **zero credentials**. The bypass works even when the default password has been changed to a random, unknown value.

---

## Bypass Script

| Field | Value |
|---|---|
| **Location** | `poc/bypass_poc.py` |
| **Language** | Python 3 (stdlib only) |
| **Usage** | `python3 bypass_poc.py <host> <port>` |

---

## Test Results

### Test Environment

| Container | Version | Password | Purpose |
|---|---|---|---|
| `cve-2026-2635-vulnerable` (localhost:5000) | v3.9.0 | `password1234` (default) | Unpatched baseline |
| `cve-2026-2635-patched` (localhost:5001) | v3.9.0 | Random (changed) | Simulated password fix |
| `cve-2026-2635-v310` (localhost:5002) | v3.10.0 | `password1234` (default) | Latest release |

### Results Matrix

| Test | v3.9.0 (vuln) | v3.9.0 (patched pwd) | v3.10.0 |
|---|---|---|---|
| Default creds (`admin:password1234`) | ✅ HTTP 200 | ❌ HTTP 401 | ✅ HTTP 200 |
| Flask API (no auth) | ❌ HTTP 401 | ❌ HTTP 401 | ❌ HTTP 401 |
| Jobs search (no auth) | **✅ HTTP 200** | **✅ HTTP 200 (BYPASS!)** | ❌ HTTP 401 |
| OTEL traces (no auth) | **✅ HTTP 400** | **✅ HTTP 400 (BYPASS!)** | ❌ HTTP 401 |
| Job submit (no auth) | **✅ HTTP 400** | **✅ HTTP 400 (BYPASS!)** | ❌ HTTP 401 |
| Assistant (no auth) | HTTP 403 (localhost) | HTTP 403 (localhost) | ❌ HTTP 401 |

**Key**: HTTP 400/422 on OTEL/job-submit = **format/validation error, NOT auth error** — the request passed through the auth middleware without being blocked.

### Test 1: Bypass Against PATCHED Container (v3.9.0, password changed)

```
[Step 1] Verifying Flask routes enforce authentication ...
  [OK]   Flask route returned HTTP 401 — authentication enforced

[Step 2] Verifying default credentials are rejected (fix applied) ...
  [OK]   Default credentials rejected (HTTP 401)

[Step 3] BYPASS: Accessing Jobs API without authentication ...
  [BYPASS!] Jobs search returned HTTP 200 — NO AUTH REQUIRED!
            Retrieved 0 job(s) without authentication

[Step 4] BYPASS: Accessing OTEL Trace API without authentication ...
  [BYPASS!] OTEL traces returned HTTP 400 (format error, NOT auth error)
            The request bypassed authentication entirely!

[Step 5] BYPASS: Attempting job submission without authentication ...
  [BYPASS!] Jobs submit returned HTTP 400 — NO AUTH REQUIRED!
            Server response: Missing required parameters for function 'invoke_scorer_job':
            ['experiment_id', 'serialized_scorer', 'trace_ids']

[Step 6] Testing Assistant API ...
  [INFO] HTTP 403 — Blocked by localhost check, NOT by authentication

[Step 7] Control test: Flask route still requires authentication ...
  [OK]   Flask route correctly returns HTTP 401

[BYPASS CONFIRMED] FastAPI routes accessible without authentication!
```

### Test 2: Verification Against v3.10.0 (FastAPI fix applied)

```
[Step 3] Jobs API: [FIXED] HTTP 401
[Step 4] OTEL traces: [FIXED] HTTP 401
[Step 5] Job submit: [FIXED] HTTP 401
[Step 6] Assistant: [FIXED] HTTP 401

[NO BYPASS] All routes properly require authentication
```

However, **v3.10.0 still accepts default credentials** (`admin:password1234` → HTTP 200), meaning CVE-2026-2635 itself remains unpatched even in the latest release.

---

## Severity Assessment

### Bypass Severity: **HIGH** (CVSS ~7.5 estimated)

**CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:H/A:L**

| Factor | Assessment |
|---|---|
| **Attack Vector** | Network — no physical or local access needed |
| **Attack Complexity** | Low — simple HTTP requests, no special conditions |
| **Privileges Required** | None — completely unauthenticated |
| **User Interaction** | None |
| **Confidentiality** | Low — job data disclosure, experiment IDs via OTEL |
| **Integrity** | High — can inject traces into any experiment, submit jobs |
| **Availability** | Low — can cancel running jobs |

### Does This Constitute a New Vulnerability?

**Yes.** While related to CVE-2026-2635 (both involve authentication bypass in MLflow with `--app-name basic-auth`), this is a **distinct vulnerability class**:

- **CVE-2026-2635**: CWE-1393 (Use of Default Credentials) — hardcoded admin password
- **This bypass**: CWE-306 (Missing Authentication for Critical Function) — FastAPI routes skip auth middleware entirely

The root cause is different (missing middleware coverage vs. hardcoded credentials), the attack technique is different (no credentials at all vs. default credentials), and the fix is different (add FastAPI validators vs. generate random passwords).

This bypass could be assigned its own CVE identifier, potentially referencing ZDI-CAN-28256 or filed as a separate finding.

---

## Fix Analysis

### Fix for FastAPI Auth Bypass

The bypass was fixed in commit `0b15c3ca55b3f5b21a7cfc0f771d42c8456dcd36` (2026-02-18, PR #20920: "Add missing authentication for fastapi routes"). The fix adds validators for the missing routes:

```python
def _find_fastapi_validator(path):
    if path.startswith("/gateway/"):
        return _get_gateway_validator(path)

    if path.startswith("/v1/traces"):          # NEW
        return _get_otel_validator(path)

    if path.startswith("/ajax-api/3.0/jobs"):  # NEW
        return _get_require_authentication_validator()

    if path.startswith("/ajax-api/3.0/mlflow/assistant"):  # NEW
        return _get_require_authentication_validator()

    return None
```

**This fix is included in v3.10.0** but NOT in v3.9.0 or earlier.

### Fix for CVE-2026-2635 (Default Credentials)

**No fix exists.** The hardcoded default credentials `admin`/`password1234` remain in `basic_auth.ini` as of v3.10.0 (the latest release). The CVE-2026-2635 core issue is still unpatched.

### Recommended Additional Fix

1. **Immediate**: Upgrade to MLflow v3.10.0+ AND change the default admin password
2. **Complete fix for CVE-2026-2635**: MLflow should generate a random admin password on first startup and display it in the server logs, or require password configuration via environment variable
3. **Defense in depth**: Consider a default-deny approach for the FastAPI middleware — require an explicit validator for every FastAPI route, rather than passing through when `validator is None`

---

## Affected Versions

| Version | Default Credentials | FastAPI Auth Bypass |
|---|---|---|
| v2.3.0 – v2.21.x | ✅ (`admin`/`password`) | N/A (no FastAPI routes) |
| v2.22.0 – v3.9.x | ✅ (`admin`/`password1234`) | ✅ Vulnerable |
| v3.10.0+ | ✅ (`admin`/`password1234`) | ❌ Fixed (PR #20920) |

---

## Confidence Level

| Assessment | Confidence |
|---|---|
| FastAPI bypass confirmed on v3.9.0 | **100%** — Tested and reproduced |
| FastAPI bypass fixed in v3.10.0 | **100%** — Tested and verified |
| Default credentials unfixed in v3.10.0 | **100%** — Tested and confirmed |
| Bypass constitutes separate vuln class | **High** — Different CWE, different root cause |

---

## Files Created

| File | Description |
|---|---|
| `poc/bypass_poc.py` | Bypass PoC script (Python 3, stdlib only) |
| `Dockerfile.patched` | Patched container (v3.9.0, random password) |
| `Dockerfile.v3.10` | v3.10.0 container (FastAPI fix included) |
| `docker-compose.yml` | Updated with all three containers |
