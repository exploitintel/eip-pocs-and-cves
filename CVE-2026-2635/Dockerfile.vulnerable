# CVE-2026-2635 Lab - MLflow Default Credentials Auth Bypass
# Vulnerable: MLflow v3.9.0 with hardcoded admin/password1234
FROM python:3.10-slim-bullseye

# Install MLflow v3.9.0 with auth dependencies
# Using --no-cache-dir to keep image smaller
RUN pip install --no-cache-dir "mlflow[auth]==3.9.0"

# Set required environment variables
# MLFLOW_FLASK_SERVER_SECRET_KEY is required for CSRF protection (Flask-WTF)
ENV MLFLOW_FLASK_SERVER_SECRET_KEY=cve-2026-2635-lab-secret-key

# Create a working directory for MLflow data (SQLite DB, artifacts)
WORKDIR /mlflow

EXPOSE 5000

# Start MLflow server with basic-auth enabled
# This will:
# 1. Read basic_auth.ini from the installed package (admin/password1234)
# 2. Create SQLite database basic_auth.db
# 3. Create admin user with default hardcoded credentials
# 4. Listen on port 5000 with HTTP Basic Auth enforcement
CMD ["mlflow", "server", "--app-name", "basic-auth", "--host", "0.0.0.0", "--port", "5000"]
