# Lab Build Report: CVE-2026-0765

## Lab Architecture

Single-container lab using the official Open WebUI Docker image at the exact vulnerable version (v0.6.32). No external database or supporting services required — Open WebUI uses SQLite by default and the vulnerability is entirely self-contained in the web application backend.

### Architecture Diagram
```
                   Host
                    │
                    │  localhost:8080
                    ▼
┌─────────────────────────────────────────────┐
│     cve-2026-0765-vulnerable                │
│     ghcr.io/open-webui/open-webui:v0.6.32   │
│                                             │
│  ┌─────────────────────────────────┐        │
│  │ Open WebUI (FastAPI/uvicorn)    │        │
│  │ Port: 8080                      │        │
│  │ Python: 3.11.13                 │        │
│  │ pip: 24.0                       │        │
│  │ git: 2.39.5                     │        │
│  │ Running as: root (UID=0)        │        │
│  │ DB: SQLite (auto-created)       │        │
│  └─────────────────────────────────┘        │
│                                             │
│  Vulnerable function:                       │
│  plugin.py:267 install_frontmatter_         │
│  requirements() — passes user input         │
│  directly to pip install subprocess         │
└─────────────────────────────────────────────┘
```

## Container Details

| Field | Value |
|-------|-------|
| **Container Name** | `cve-2026-0765-vulnerable` |
| **Image** | `ghcr.io/open-webui/open-webui:v0.6.32` |
| **Internal Port** | 8080 |
| **Networks** | `lab-net` (internal) |
| **Running User** | root (UID=0, GID=0) |
| **Python** | 3.11.13 |
| **pip** | 24.0 |
| **git** | 2.39.5 |
| **Database** | SQLite (auto-created at `/app/backend/data/webui.db`) |
| **Healthcheck** | `curl --silent --fail http://localhost:8080/health` |
| **Startup Time** | ~25 seconds to healthy |

### Environment Variables

| Variable | Value | Purpose |
|----------|-------|---------|
| `WEBUI_SECRET_KEY` | `poc-secret-key-cve-2026-0765` | JWT signing key |
| `USE_SLIM_DOCKER` | `true` | Skip ML model downloads (~2GB saved) |
| `USE_OLLAMA_DOCKER` | `false` | No Ollama backend needed |
| `WEBUI_AUTH` | `true` | Authentication enabled |
| `ENABLE_SIGNUP` | `true` | Self-registration enabled |
| `PORT` | `8080` | Application port |
| `HOST` | `0.0.0.0` | Bind to all interfaces |

## Build Status

| Component | Status | Notes |
|-----------|--------|-------|
| Image Pull | ✅ Success | `ghcr.io/open-webui/open-webui:v0.6.32` |
| Container Start | ✅ Success | Healthy in ~25 seconds |
| Health Check | ✅ Passing | `/health` returns `{"status": true}` |
| Version Verified | ✅ Confirmed | `/api/config` returns version `0.6.32` |
| Vulnerable Function | ✅ Present | `plugin.py:267` — `install_frontmatter_requirements()` |
| Signup API | ✅ Working | First user gets `admin` role |
| Auth API | ✅ Working | JWT tokens issued correctly |
| Tool Creation API | ✅ Working | Tools created and stored in SQLite |
| pip Available | ✅ v24.0 | Ready for package installation exploits |
| git Available | ✅ v2.39.5 | Supports `git+https://` attack vector |

## Start/Stop Commands

### Start Lab
```bash
docker compose up -d
```

### Stop Lab
```bash
docker compose down
```

### Reset Lab (Clean State)
```bash
docker compose down -v
docker compose up -d
```

### Check Status
```bash
docker compose ps
```

### View Logs
```bash
docker compose logs -f vulnerable
```

## Accessing the Lab

```bash
# Health check
curl http://localhost:8080/health

# Version check
curl http://localhost:8080/api/config | jq .version

# Sign up as first user (becomes admin)
curl -X POST http://localhost:8080/api/v1/auths/signup \
  -H "Content-Type: application/json" \
  -d '{"email":"attacker@poc.local","password":"password123","name":"Attacker"}'
```

## Verification Evidence

### Health Check
```
GET http://<IP>:8080/health → {"status": true}
```

### Version Confirmation
```
GET http://<IP>:8080/api/config → {"version": "0.6.32", "name": "Open WebUI"}
```

### Vulnerable Code Confirmed
```
$ docker exec cve-2026-0765-vulnerable grep -n "def install_frontmatter_requirements" /app/backend/open_webui/utils/plugin.py
267:def install_frontmatter_requirements(requirements: str):
```

### Full Exploitation Path Validated
1. ✅ `POST /api/v1/auths/signup` — First user gets `admin` role
2. ✅ `POST /api/v1/tools/create` — Admin can create tools with arbitrary content
3. ✅ Tool frontmatter `requirements` field → passed to `pip install` without validation
4. ✅ pip, git, and Python all available in container for malicious package execution
5. ✅ Container runs as root (UID=0) — maximum post-exploitation impact

## Lab Files

| File | Description |
|------|-------------|
| `docker-compose.yml` | Lab orchestration |

## Known Issues / Notes

- **No build from source required** — official Docker image contains exact vulnerable version
- **Container state is ephemeral** — restarting the container resets the SQLite database (no persistent volumes). This is intentional for PoC repeatability.
- **First user is admin** — On a fresh instance, the first user to sign up automatically gets the `admin` role. The PoC exploits this for zero-privilege-escalation RCE.
- **The `exec()` code execution (plugin.py lines 101, 145) is a separate vulnerability** — the PoC should specifically target the pip injection vector (CVE-2026-0765) via frontmatter requirements, not the exec() path.
- **Project name must be lowercase** — Docker Compose requires lowercase project names; use `cve-2026-0765` not `CVE-2026-0765`.
