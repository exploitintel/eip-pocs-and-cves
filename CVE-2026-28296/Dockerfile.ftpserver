# CVE-2026-28296 Lab - FTP Server
# Provides an FTP target for demonstrating GVFS CRLF command injection.

FROM debian:bookworm-slim

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        vsftpd \
        tcpdump \
        net-tools && \
    rm -rf /var/lib/apt/lists/*

# Create FTP user
RUN useradd -m -s /bin/bash ftpuser && \
    echo "ftpuser:ftpuser" | chpasswd

# Create vsftpd required directories
RUN mkdir -p /var/run/vsftpd/empty

# Seed FTP directory with test files
RUN mkdir -p /home/ftpuser/public && \
    echo "This is a public file." > /home/ftpuser/public/readme.txt && \
    echo "CONFIDENTIAL: secret data" > /home/ftpuser/secret.txt && \
    chown -R ftpuser:ftpuser /home/ftpuser

# Configure vsftpd
COPY vsftpd.conf /etc/vsftpd.conf

EXPOSE 21 30000-30009

CMD ["/usr/sbin/vsftpd", "/etc/vsftpd.conf"]
