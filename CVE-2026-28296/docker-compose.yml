# CVE-2026-28296 - GVFS FTP Backend CRLF Command Injection Lab
# For authorized security testing and research only.

services:
  # Vulnerable FTP server target (vsftpd - for original PoC)
  ftpserver:
    build:
      context: .
      dockerfile: Dockerfile.ftpserver
    container_name: cve-2026-28296-ftpserver
    hostname: ftpserver
    ports:
      - "2121:21"
      - "30000-30009:30000-30009"
    networks:
      vulnnet:
        ipv4_address: 172.28.0.10

  # Malicious FTP server (crafted LIST with tainted symlink targets)
  malicious-ftpserver:
    build:
      context: .
      dockerfile: Dockerfile.malicious-ftpserver
    container_name: cve-2026-28296-malicious-ftpserver
    hostname: malicious-ftpserver
    environment:
      - PASV_ADDRESS=172.28.0.11
    ports:
      - "2122:21"
      - "31000-31009:31000-31009"
    networks:
      vulnnet:
        ipv4_address: 172.28.0.11

  # Vulnerable GVFS client (pre-fix version, 1.54.2 on bookworm)
  gvfs-client:
    build:
      context: .
      dockerfile: Dockerfile.gvfs-client
    container_name: cve-2026-28296-gvfs-client
    hostname: gvfs-client
    depends_on:
      - ftpserver
      - malicious-ftpserver
    networks:
      vulnnet:
        ipv4_address: 172.28.0.20
    # Keep container running for interactive use
    stdin_open: true
    tty: true

  # Patched GVFS client (HEAD/1.59.2 on trixie - has incomplete CRLF fix)
  gvfs-patched:
    build:
      context: .
      dockerfile: Dockerfile.gvfs-patched
    container_name: cve-2026-28296-gvfs-patched
    hostname: gvfs-patched
    depends_on:
      - ftpserver
      - malicious-ftpserver
    networks:
      vulnnet:
        ipv4_address: 172.28.0.21
    # Keep container running for interactive use
    stdin_open: true
    tty: true

networks:
  vulnnet:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/24
