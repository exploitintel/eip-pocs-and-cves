# Intel Brief: CVE-2026-26321

## CVE Summary

| Field | Value |
|---|---|
| **CVE ID** | CVE-2026-26321 |
| **Title** | OpenClaw <2026.2.14 — Path Traversal / Local File Disclosure via Feishu Extension |
| **Affected Software** | OpenClaw (AI assistant gateway) |
| **Vendor** | openclaw (GitHub: openclaw/openclaw) |
| **Affected Versions** | All versions prior to 2026.2.14 (npm package: `openclaw`) |
| **CVSS Score** | 7.5 (HIGH) |
| **CVSS Vector** | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N |
| **CWE** | CWE-22 — Improper Limitation of a Pathname to a Restricted Directory (Path Traversal) |
| **EPSS** | 0.1% (23.4th percentile) |
| **Published** | 2026-02-19 |
| **GHSA** | GHSA-8jpq-5h99-ff5r |

## Description

The Feishu (Lark) extension in OpenClaw contains a path traversal and local file disclosure vulnerability. The `sendMediaFeishu()` function in `extensions/feishu/src/media.ts` accepts attacker-controlled `mediaUrl` values and, when they resolve to local filesystem paths (starting with `/`, `~`, a drive letter, or `file://` protocol), reads them directly from disk using `fs.readFileSync()`.

If an attacker can influence tool calls — either directly through an exposed API or via prompt injection against the AI assistant — they can supply paths such as `/etc/passwd` as the `mediaUrl` parameter to exfiltrate arbitrary local files. The file contents are then uploaded and sent as a Feishu message to a target chat.

A secondary vulnerable path exists in `extensions/feishu/src/docx.ts` where `downloadImage()` performs unrestricted `fetch()` calls on URLs extracted from markdown content, enabling SSRF.

## Vulnerability Details

### Primary Vulnerability (media.ts — Local File Read)

**File:** `extensions/feishu/src/media.ts`

**Vulnerable Function:** `sendMediaFeishu()` (lines 472-512)

**Root Cause:** The `isLocalPath()` helper function (lines 455-467) intentionally classifies filesystem paths and then `sendMediaFeishu()` uses `fs.readFileSync()` to read those paths without any sandboxing or path restriction:

```typescript
function isLocalPath(urlOrPath: string): boolean {
  if (urlOrPath.startsWith("/") || urlOrPath.startsWith("~") || /^[a-zA-Z]:/.test(urlOrPath)) {
    return true;
  }
  try {
    const url = new URL(urlOrPath);
    return url.protocol === "file:";
  } catch {
    return true;
  }
}
```

When `isLocalPath()` returns true, the file is read directly:
```typescript
if (isLocalPath(mediaUrl)) {
  const filePath = mediaUrl.startsWith("~")
    ? mediaUrl.replace("~", process.env.HOME ?? "")
    : mediaUrl.replace("file://", "");
  buffer = fs.readFileSync(filePath);  // <-- ARBITRARY FILE READ
}
```

### Secondary Vulnerability (docx.ts — SSRF)

**File:** `extensions/feishu/src/docx.ts`

**Vulnerable Function:** `downloadImage()` (lines 178-184)

```typescript
async function downloadImage(url: string): Promise<Buffer> {
  const response = await fetch(url);  // <-- No URL validation, enables SSRF
  return Buffer.from(await response.arrayBuffer());
}
```

### Attack Vectors

1. **Direct tool invocation**: If an attacker has access to OpenClaw's tool-calling interface, they can call `sendMediaFeishu` with `mediaUrl: "/etc/passwd"`.
2. **Prompt injection**: An AI assistant using OpenClaw may be tricked via prompt injection to invoke the Feishu media tool with a malicious local path.
3. **SSRF via docx**: Markdown content with `![img](http://169.254.169.254/...)` can trigger SSRF through the docx image processing path.

## Repository Information

| Field | Value |
|---|---|
| **Repository URL** | https://github.com/openclaw/openclaw.git |
| **Vulnerable Version** | v2026.2.13 (checked out) |
| **Fix Commit** | `5b4121d6011a48c71e747e3c18197f180b872c5d` |
| **Fix Author** | Peter Steinberger (steipete) — credited @mbelinky |
| **Fix Date** | 2026-02-14 |
| **Patched Version** | v2026.2.14 |
| **Fix PR** | #16285 |

## Fix Summary

The fix in commit `5b4121d` makes these changes:

1. **media.ts**: Removes the `isLocalPath()` function entirely and all direct `fs.readFileSync()` calls. Replaces with a call to `getFeishuRuntime().media.loadWebMedia()` which is a hardened helper that:
   - Rejects private/internal IP addresses (SSRF protection)
   - Enforces byte size limits (`mediaMaxMb` config, default 30MB)
   - Does not support local filesystem paths at all

2. **docx.ts**: Replaces the bare `fetch(url)` in `downloadImage()` with `getFeishuRuntime().channel.media.fetchRemoteMedia()` which applies the same SSRF protections and size limits.

3. **Tests added**: `media.test.ts` and `docx.test.ts` add test cases that verify blocked URLs (private IPs) are properly rejected.

## Build System

| Field | Value |
|---|---|
| **Language** | TypeScript (Node.js) |
| **Node.js Version** | >= 22.12.0 |
| **Package Manager** | pnpm (monorepo workspace) |
| **Build Tool** | tsdown (Rolldown-based bundler) |
| **Test Framework** | Vitest |
| **Linting** | oxlint |

### Project Structure
- Monorepo with pnpm workspaces: root, `ui/`, `packages/*`, `extensions/*`
- The Feishu extension is at `extensions/feishu/`

### Key Dependencies (Feishu Extension)
- `@larksuiteoapi/node-sdk` ^1.59.0 — Feishu/Lark API SDK
- `@sinclair/typebox` 0.34.48 — Runtime type validation
- `zod` ^4.3.6 — Schema validation

### Key Dev Dependencies (Root)
- `vitest` — Test runner
- `tsx` — TypeScript execution
- `tsdown` — Build/bundle
- `typescript` (via `@typescript/native-preview`)

## Public Exploits

### Exploit #116366 (Writeup/Patch)
- **Source**: GitHub commit (the fix itself serves as a writeup)
- **Classification**: WRITEUP (AI confidence: 95%)
- **Attack Type**: SSRF / Local File Disclosure
- **Complexity**: Moderate
- **Reliability**: Reliable
- **Requires Auth**: Yes (ability to invoke tool calls)
- **Safety**: Clean — no trojan or suspicious indicators
- **MITRE ATT&CK**: T1189 (Drive-by Compromise), T1083 (File and Directory Discovery)
- **Note**: No standalone PoC exploit script exists. The patch diff itself reveals the vulnerability pattern clearly. A PoC must be written from scratch.

## PoC Strategy

To demonstrate CVE-2026-26321, a PoC should:

1. **Set up a minimal OpenClaw instance** with the Feishu extension enabled (version 2026.2.13)
2. **Trigger `sendMediaFeishu()`** with `mediaUrl` set to a local file path (e.g., `/etc/passwd`)
3. **Observe** that the file contents are read and would be sent to the Feishu API

**Simplest approach**: Mock/stub the Feishu API endpoints and call `sendMediaFeishu()` directly with a crafted `mediaUrl`. This avoids needing real Feishu credentials.

**Key files for PoC**:
- `extensions/feishu/src/media.ts` — Contains `sendMediaFeishu()` and `isLocalPath()`
- `extensions/feishu/src/accounts.ts` — Account resolution
- `extensions/feishu/src/client.ts` — Feishu client creation

## References

| Type | URL |
|---|---|
| Patch (Fix Commit) | https://github.com/openclaw/openclaw/commit/5b4121d6011a48c71e747e3c18197f180b872c5d |
| Vendor Advisory (GHSA) | https://github.com/openclaw/openclaw/security/advisories/GHSA-8jpq-5h99-ff5r |
| Release Notes (v2026.2.14) | https://github.com/openclaw/openclaw/releases/tag/v2026.2.14 |
| Repository | https://github.com/openclaw/openclaw |
| npm Package | https://www.npmjs.com/package/openclaw |
