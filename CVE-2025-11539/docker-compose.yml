# docker-compose.yml â€” CVE-2025-11539 Lab Environment
#
# Grafana Image Renderer v4.0.16 Arbitrary File Write / RCE
#
# Usage:
#   docker compose up -d
#   docker compose down

services:
  grafana:
    image: grafana/grafana:11.6.0
    container_name: cve-2025-11539-grafana
    environment:
      GF_RENDERING_SERVER_URL: http://cve-2025-11539-renderer:8081/render
      GF_RENDERING_CALLBACK_URL: http://cve-2025-11539-grafana:3000/
      GF_LOG_FILTERS: rendering:debug
      GF_AUTH_ANONYMOUS_ENABLED: "true"
      GF_AUTH_ANONYMOUS_ORG_ROLE: Admin
    ports:
      - "3000:3000"
    healthcheck:
      test: ["CMD", "wget", "-O-", "-q", "http://localhost:3000/api/health"]
      interval: 5s
      timeout: 3s
      retries: 15
      start_period: 10s
    networks:
      - lab-net

  renderer:
    image: ghcr.io/exploitintel/cve-2025-11539-vulnerable:latest
    container_name: cve-2025-11539-renderer
    depends_on:
      grafana:
        condition: service_healthy
    environment:
      CHROME_BIN: /usr/bin/chromium
      PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: "true"
      NODE_ENV: production
    ports:
      - "8081:8081"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "wget", "-O-", "-q", "http://localhost:8081/"]
      interval: 10s
      timeout: 5s
      retries: 6
      start_period: 30s
    networks:
      - lab-net

networks:
  lab-net:
    driver: bridge
