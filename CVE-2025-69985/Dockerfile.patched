# CVE-2025-69985 Lab - FUXA Patched (master 427d2f63)
# Built from source with secureEnabled=true for bypass testing

FROM node:18-bookworm

RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    python3 \
    git \
    sqlite3 \
    libsqlite3-dev \
    unixodbc \
    unixodbc-dev \
    curl \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src/app/FUXA

# Clone the patched version (master with security fixes)
RUN git clone https://github.com/frangoteam/FUXA.git . && \
    git checkout 427d2f63

WORKDIR /usr/src/app/FUXA/server

RUN npm install --no-audit --no-fund --legacy-peer-deps 2>/dev/null; exit 0

RUN mkdir -p _appdata _db _logs _images

# Enable security (secureEnabled: true) with default secret for testing
RUN echo '{"secureEnabled":true,"secretCode":"frangoteam751","tokenExpiresIn":"1h"}' > _appdata/mysettings.json

EXPOSE 1881

CMD ["npm", "start"]
