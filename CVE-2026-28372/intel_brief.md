# Intel Brief: CVE-2026-28372

## CVE Summary

| Field | Value |
|---|---|
| **CVE ID** | CVE-2026-28372 |
| **Title** | GNU inetutils ≤2.7 — Privilege Escalation via telnetd + systemd Credentials |
| **Affected Software** | GNU inetutils (telnetd) |
| **Vendor** | GNU / Free Software Foundation |
| **Affected Versions** | All versions through 2.7 (inclusive) |
| **CVSS Score** | 7.4 (HIGH) |
| **CVSS Vector** | CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H |
| **CWE** | CWE-829 (Inclusion of Functionality from Untrusted Control Sphere) |
| **Published** | 2026-02-27 |
| **Reporter** | Ron Ben Yizhak (SafeBreach) |

## Description

telnetd in GNU inetutils through version 2.7 allows **local privilege escalation** by abusing the interaction between two components:

1. **GNU inetutils telnetd** accepts arbitrary environment variables from telnet clients via the Telnet NEW_ENVIRON option (RFC 1572) and passes them to the `/bin/login` process.
2. **util-linux login(1)** (version 2.40+) added systemd service credentials support, which checks the `CREDENTIALS_DIRECTORY` environment variable for a file named `login.noauth`. If this file contains "yes", authentication is **completely bypassed**.

The telnetd `scrub_env()` function in `pty.c` uses a **blacklist approach** that only removes `LD_*`, `_RLD_*`, `LIBPATH=`, and `IFS=` from the environment. It does **not** filter `CREDENTIALS_DIRECTORY`, allowing a telnet client to inject this variable into the login process.

### Attack Chain

1. An **unprivileged local user** creates a directory (e.g., `/home/user/fake_cred/`)
2. Inside that directory, they create a file `login.noauth` containing `yes`
3. The user connects to the local telnetd and uses the Telnet NEW_ENVIRON option to set:
   - `CREDENTIALS_DIRECTORY=/home/user/fake_cred`
   - `USER=root`
4. telnetd passes these environment variables to `login(1)`, which finds the `login.noauth` file and **skips authentication entirely**
5. The attacker gets a root shell

### Attack Prerequisites

- GNU inetutils telnetd must be running on the target system
- util-linux ≥ 2.40 must be installed (for login(1) with systemd credentials support)
- The attacker needs a local unprivileged account to create the `login.noauth` file
- The attack vector is **local** (connecting to telnetd on localhost)

## Source Repository

| Field | Value |
|---|---|
| **Repository URL** | https://codeberg.org/inetutils/inetutils.git |
| **Repository Type** | Git (hosted on Codeberg) |
| **License** | GPLv3 |

## Version Information

| Field | Value |
|---|---|
| **Vulnerable Version** | v2.7 (tag `v2.7`, commit `380e69a5`) |
| **Patched Version** | No upstream release yet. Fix available as Debian patch only. |
| **Vulnerable Range** | All versions through 2.7 |

## Fix Details

### Upstream Patch (not yet in upstream repo)

The fix was authored by **Erik Auerswald** on 2026-02-15 and has been applied to the Debian packaging repo, but has **not yet been pushed to the upstream Codeberg repository**.

**Patch commit (from Debian quilt patch):** `4db2f19f4caac03c7f4da6363c140bd70df31386`
**Debian packaging commit:** `3953943d8296310485f98963883a798545ab9a6c`

### Fix Description

The fix adds a single `unsetenv("CREDENTIALS_DIRECTORY")` call in `telnetd/pty.c` in the `start_login()` function, immediately before the `execv()` call that launches `/bin/login`.

### Fix Diff

```diff
diff --git a/telnetd/pty.c b/telnetd/pty.c
index c727e7be..f3518049 100644
--- a/telnetd/pty.c
+++ b/telnetd/pty.c
@@ -129,6 +129,14 @@ start_login (char *host, int autologin, char *name)
   if (!cmd)
     fatal (net, "can't expand login command line");
   argcv_get (cmd, "", &argc, &argv);
+
+  /* util-linux's "login" introduced an authentication bypass method
+   * via environment variable "CREDENTIALS_DIRECTORY" in version 2.40.
+   * Clear it from the environment before executing "login" to prevent
+   * abuse via Telnet.
+   */
+  unsetenv ("CREDENTIALS_DIRECTORY");
+
   execv (argv[0], argv);
   syslog (LOG_ERR, "%s: %m\n", cmd);
   fatalperror (net, cmd);
```

## Vulnerable Code Analysis

### Key File: `telnetd/state.c` (lines 1324-1522)

The telnet NEW_ENVIRON option handler accepts arbitrary environment variables from the client and sets them via `setenv()`:

```c
// telnetd/state.c:1495-1501
case NEW_ENV_VAR:
case ENV_USERVAR:
    *cp = '\0';
    if (valp)
        setenv (varp, valp, 1);  // <-- ARBITRARY env var set from client
    else
        unsetenv (varp);
```

### Key File: `telnetd/pty.c` (lines 86-107)

The `scrub_env()` function uses a blacklist that is insufficient:

```c
static void scrub_env (void)
{
    char **cpp, **cpp2;
    for (cpp2 = cpp = environ; *cpp; cpp++)
    {
        if (strncmp (*cpp, "LD_", 3)
            && strncmp (*cpp, "_RLD_", 5)
            && strncmp (*cpp, "LIBPATH=", 8)
            && strncmp (*cpp, "IFS=", 4))
            *cpp2++ = *cpp;
    }
    *cpp2 = 0;
}
```

This only removes `LD_*`, `_RLD_*`, `LIBPATH`, and `IFS` — it does **not** filter `CREDENTIALS_DIRECTORY`.

### Key File: `telnetd/pty.c` (lines 109-137)

The `start_login()` function calls `scrub_env()` then executes login — the fix inserts `unsetenv("CREDENTIALS_DIRECTORY")` just before `execv()`.

### Key File: `telnetd/telnetd.c` (lines 47-60)

The login invocation template shows `login` is called with `-p` flag (preserving environment):

```c
char *login_invocation =
#else /* !SOLARIS */
    PATH_LOGIN " -p -h %h %?u{-f %u}{%U}"
#endif
```

The `-p` flag is critical — it tells login to **preserve the environment**, which is how `CREDENTIALS_DIRECTORY` reaches login.

## Build System

| Field | Value |
|---|---|
| **Build System** | GNU Autotools (autoconf/automake) |
| **Language** | C |
| **Build Steps** | `./bootstrap` → `./configure` → `make` |
| **Bootstrap Required** | Yes (requires gnulib submodule) |

### Key Dependencies

| Dependency | Purpose | Required |
|---|---|---|
| **libcrypt** (`-lcrypt`) | Password hashing for login | Yes |
| **libutil** (`-lutil`) | Login/logout/utmp functions | Yes |
| **ncurses/libtermcap** | Terminal capability database | Yes |
| **pty library** | Pseudo-terminal allocation | Yes |
| **autoconf/automake** | Build system generation | Yes (for bootstrap) |
| **gnulib** | GNU portability library | Yes (pulled by bootstrap) |
| **Kerberos** (optional) | Authentication | No |
| **PAM** (optional) | Pluggable authentication | No |
| **libwrap** (optional) | TCP wrapper support | No |

### Building telnetd Only

To build only telnetd (the vulnerable component):
```bash
./bootstrap
./configure --enable-telnetd --disable-servers --disable-clients
make -C telnetd
```

### Lab Environment Requirements

To reproduce the vulnerability, the lab needs:
1. **GNU inetutils 2.7** (telnetd) — built from source at tag `v2.7`
2. **util-linux ≥ 2.40** — for `login(1)` with systemd credentials support
3. A **local user account** (e.g., `weakuser`) to create the `login.noauth` file
4. telnetd configured and running (typically via inetd or xinetd)
5. A telnet client capable of setting environment variables (standard telnet or custom Python script)

## Public Exploits

| Source | Status |
|---|---|
| **EIP/Metasploit** | None |
| **ExploitDB** | None |
| **GitHub PoCs** | None |
| **Nuclei Templates** | None |

A Python PoC script (`telnet_lpe.py`) was referenced in the original bug report by Ron Ben Yizhak but is **not publicly available**. The reproduction steps from the bug report are:

```bash
./telnet_lpe.py 127.0.0.1 --env CREDENTIALS_DIRECTORY=/home/weak_user/fake_cred --env USER=root
```

This can be reproduced using a standard telnet client or a custom Python script that sends the Telnet NEW_ENVIRON option.

### PoC Strategy for Lab

A PoC can be written from scratch using Python's `telnetlib` (or raw sockets with telnet protocol handling) to:
1. Connect to telnetd on port 23
2. Negotiate NEW_ENVIRON option
3. Send `CREDENTIALS_DIRECTORY=/path/to/dir` and `USER=root` variables
4. Verify that a root shell is obtained without authentication

## Related CVEs

| CVE | Description | Relationship |
|---|---|---|
| **CVE-2026-24061** | telnetd remote auth bypass via `-f root` in USER variable | Same component, predecessor vulnerability. Fixed by commits `fd702c0` and `38b78ad`. |
| **CVE-1999-0073** | telnet LD_LIBRARY_PATH injection | Same root cause pattern (env var injection via telnet), 27 years earlier |

## References

1. **Debian fix commit**: https://git.hadrons.org/cgit/debian/pkgs/inetutils.git/commit/?id=3953943d8296310485f98963883a798545ab9a6c
2. **Original bug report**: https://lists.gnu.org/archive/html/bug-inetutils/2026-02/msg00000.html
3. **Follow-up discussion**: https://lists.gnu.org/archive/html/bug-inetutils/2026-02/msg00012.html
4. **oss-security disclosure**: https://www.openwall.com/lists/oss-security/2026/02/24/1
5. **Upstream repository**: https://codeberg.org/inetutils/inetutils
6. **Debian patches repo**: https://git.hadrons.org/cgit/debian/pkgs/inetutils.git/
