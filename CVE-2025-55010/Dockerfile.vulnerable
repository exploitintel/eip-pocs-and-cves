# CVE-2025-55010 - Vulnerable Kanboard v1.2.46
# Unsafe deserialization in ProjectActivityEventFormatter::unserializeEvent()
FROM kanboard/kanboard:v1.2.46

LABEL maintainer="Exploit Intelligence Platform" \
    description="Kanboard v1.2.46 - Vulnerable to CVE-2025-55010 (Unsafe Deserialization)"

# Pre-generate SwiftMailer gadget chain payloads at build time.
# The PHP payload generator requires SwiftMailer classes from Kanboard's vendor/.
# Output is saved so the Python PoC can read it without docker exec.
COPY poc/generate_payload.php /tmp/generate_payload.php
RUN php /tmp/generate_payload.php marker /var/www/app/plugins > /opt/payload_marker.txt 2>/dev/null && \
    php /tmp/generate_payload.php filewrite /var/www/app/plugins > /opt/payload_filewrite.txt 2>/dev/null && \
    rm /tmp/generate_payload.php

# Entrypoint wrapper copies pre-generated payloads to the bind-mounted poc directory
COPY entrypoint-wrapper.sh /usr/local/bin/entrypoint-wrapper.sh
RUN chmod +x /usr/local/bin/entrypoint-wrapper.sh

ENTRYPOINT ["/usr/local/bin/entrypoint-wrapper.sh"]
