# CVE-2025-59390 Lab - MIT Kerberos KDC
# Provides Kerberos authentication infrastructure for the Druid lab

FROM debian:bookworm

RUN apt-get update && \
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
    krb5-kdc \
    krb5-admin-server \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Copy Kerberos configuration
COPY krb5.conf /etc/krb5.conf
COPY kdc.conf /etc/krb5kdc/kdc.conf
COPY kadm5.acl /etc/krb5kdc/kadm5.acl

# Create directories
RUN mkdir -p /var/lib/krb5kdc /var/log /keytab-share

# Copy and set up entrypoint
COPY kdc-entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

EXPOSE 88

ENTRYPOINT ["/entrypoint.sh"]
