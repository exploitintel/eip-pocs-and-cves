# docker-compose.yml â€” CVE-2025-58046 Lab Environment
#
# DataEase v2.10.12 Impala JNDI Injection to RCE.
# Includes vulnerable (v2.10.12) and patched (v2.10.13) targets.
#
# Usage:
#   docker compose up -d
#   docker compose down

services:

  mysql-de:
    image: ghcr.io/exploitintel/cve-2025-58046-mysql:latest
    container_name: cve-2025-58046-mysql
    environment:
      - MYSQL_ROOT_PASSWORD=Password123@mysql
      - MYSQL_DATABASE=dataease
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-pPassword123@mysql", "--protocol", "tcp"]
      interval: 5s
      timeout: 3s
      retries: 30
      start_period: 30s
    networks:
      - cve-2025-58046-net

  dataease:
    image: ghcr.io/exploitintel/cve-2025-58046-vulnerable:latest
    container_name: cve-2025-58046-dataease
    stop_signal: SIGTERM
    stop_grace_period: 15s
    ports:
      - "18100:8100"
    environment:
      - DE_EXTERNAL_MYSQL=true
      - DE_MYSQL_HOST=mysql-de
      - DE_MYSQL_PORT=3306
      - DE_MYSQL_DB=dataease
      - DE_MYSQL_USER=root
      - DE_MYSQL_PASSWORD=Password123@mysql
      - DE_MYSQL_PARAMS=autoReconnect=true&useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true
      - DE_CONTEXT_PATH=/
      - DE_EXPORT_VIEWS_LIMIT=100
      - DE_EXPORT_DATASET_LIMIT=100000
      - DE_ORIGIN_LIST=
      - DE_LOGIN_TIMEOUT=480
      - DE_SELENIUM_SERVER=
      - DE_SERVERS=
    depends_on:
      mysql-de:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "nc", "-zv", "127.0.0.1", "8100"]
      interval: 15s
      timeout: 5s
      retries: 20
      start_period: 60s
    networks:
      - cve-2025-58046-net

  dataease-patched:
    image: ghcr.io/exploitintel/cve-2025-58046-patched:latest
    container_name: cve-2025-58046-patched
    stop_signal: SIGTERM
    stop_grace_period: 15s
    ports:
      - "18101:8100"
    environment:
      - DE_EXTERNAL_MYSQL=true
      - DE_MYSQL_HOST=mysql-de
      - DE_MYSQL_PORT=3306
      - DE_MYSQL_DB=dataease
      - DE_MYSQL_USER=root
      - DE_MYSQL_PASSWORD=Password123@mysql
      - DE_MYSQL_PARAMS=autoReconnect=true&useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true
      - DE_CONTEXT_PATH=/
      - DE_EXPORT_VIEWS_LIMIT=100
      - DE_EXPORT_DATASET_LIMIT=100000
      - DE_ORIGIN_LIST=
      - DE_LOGIN_TIMEOUT=480
      - DE_SELENIUM_SERVER=
      - DE_SERVERS=
    depends_on:
      mysql-de:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "nc", "-zv", "127.0.0.1", "8100"]
      interval: 15s
      timeout: 5s
      retries: 20
      start_period: 60s
    networks:
      - cve-2025-58046-net

networks:
  cve-2025-58046-net:
    driver: bridge
