# CVE-2026-0773 - Upsonic Cloudpickle Deserialization Remote Code Execution

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field | Value |
|---|---|
| CVE | CVE-2026-0773 |
| Component | [Upsonic AI Agent Framework](https://github.com/Upsonic/Upsonic) |
| Type | CWE-502: Deserialization of Untrusted Data |
| CVSS | 9.8 (Critical) — `CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H` |
| EPSS | 1.3% (79.6th percentile) |
| Affected | v0.36.0 through v0.55.6 |
| Fix | v0.56.0 — entire server architecture removed |
| Author | Exploit Intelligence Platform |
| Date | 2026-03-01 |

## Vulnerability Details

Upsonic AI Agent Framework versions 0.36.0 through 0.55.6 contain multiple unauthenticated API endpoints that deserialize user-supplied `cloudpickle` data without any validation, authentication, or sandboxing. An attacker can send a crafted HTTP POST request containing a malicious serialized Python object to achieve **Remote Code Execution (RCE)** on the server with no authentication required. Five independent deserialization sinks across three endpoints were confirmed exploitable.

## Affected Versions

| | Version |
|---|---------|
| **Vulnerable** | v0.36.0 through v0.55.6 |
| **First Vulnerable** | v0.36.0 (commit `8c28730`, 2025-01-17) |
| **Last Vulnerable** | v0.55.6 |
| **First Patched** | v0.56.0 |

## Root Cause

The Upsonic AI Agent Framework exposes multiple FastAPI HTTP endpoints that accept base64-encoded Python `cloudpickle` serialized objects from user-controlled request parameters and deserialize them using `cloudpickle.loads()` with no preceding authentication, authorization, integrity verification, or type restriction.

Python's pickle protocol allows arbitrary code execution during deserialization via the `__reduce__` method. When `cloudpickle.loads()` processes a crafted payload, it invokes the `__reduce__()` method which returns a `(callable, args)` tuple. The deserializer then calls `callable(*args)`, executing whatever function and arguments the attacker specifies — typically `os.system()` or `subprocess.check_output()` for arbitrary OS command execution.

The primary sink is in `src/upsonic/tools_server/server/tools.py`:
```python
@app.post(f"{prefix}/add_tool")
@timeout(30.0)
async def add_tool(request: AddToolRequest):
    decoded_function = base64.b64decode(request.function)
    deserialized_function = cloudpickle.loads(decoded_function)  # RCE HERE
```

Four additional sinks exist across the `/level_one/gpt4o` and `/level_two/agent` endpoints on the main server, each deserializing the `response_format` and `context` request fields via the identical `cloudpickle.loads()` pattern. All endpoints are completely unauthenticated — no API keys, tokens, or session cookies are required.

## Lab Setup

### Prerequisites

- Docker with compose plugin (`docker compose`)
- Network connectivity between the host and containers

### Quick Start

```bash
cd CVE-2026-0773

# Build and start
docker compose build
docker compose up -d

# Run the exploit
python3 poc/poc.py localhost 7541

# Cleanup
docker compose down
```

### Container Details

| Property | Value |
|----------|-------|
| **Container Name** | `cve-2026-0773-vulnerable` |
| **Base Image** | `python:3.12-slim` |
| **Software** | Upsonic v0.55.6 |
| **Exposed Port** | 7541 (main server) |
| **Internal Port** | 8086 (tools server, localhost only) |
| **Health Check** | `GET http://localhost:7541/status` |

### Architecture

The vulnerable container runs two servers:

```
┌─────────────────────────────────────────────────┐
│  cve-2026-0773-vulnerable                       │
│                                                 │
│  Main Server (uvicorn) — 0.0.0.0:7541           │
│    POST /tools/add_tool  ──proxy──┐             │
│    POST /level_one/gpt4o (direct) │             │
│    POST /level_two/agent (direct) │             │
│    GET  /status                   │             │
│                                   ▼             │
│  Tools Server (uvicorn) — localhost:8086         │
│    POST /tools/add_tool                         │
│    → cloudpickle.loads() → RCE                  │
└─────────────────────────────────────────────────┘
```

### Verify the Lab is Running

```bash
# Check container health
docker compose ps

# Verify server is responding
curl -s http://localhost:7541/status
# Expected: {"status": "Server is running"}
```

### Stop the Lab

```bash
docker compose down
```

## PoC Usage

### Prerequisites (attacker side)

```bash
pip install cloudpickle
```

The PoC scripts use Python 3 stdlib for HTTP (`urllib`) and Docker CLI for verification. No additional dependencies are needed.

### Vector 1 — Primary (`/tools/add_tool`)

```bash
python3 poc/poc.py <target_host> [port]

# Examples:
python3 poc/poc.py localhost
python3 poc/poc.py localhost 7541
```

This is the primary exploit vector. The payload is sent to `POST /tools/add_tool`, proxied through the main server to the tools server, where `cloudpickle.loads()` triggers RCE.

### Vector 2 — Level One (`/level_one/gpt4o`)

```bash
python3 poc/poc_vector2_level_one.py <target_host> [port]
```

Tests two independent deserialization sinks (`response_format` and `context` fields) on the `/level_one/gpt4o` endpoint. Executes directly on the main server — does not require the tools server.

### Vector 3 — Level Two (`/level_two/agent`)

```bash
python3 poc/poc_vector3_level_two.py <target_host> [port]
```

Same deserialization pattern as Vector 2 but on the `/level_two/agent` endpoint, which requires an additional `agent_id` field.

### Expected Output (Vector 1)

```
=================================================================
  CVE-2026-0773 — Upsonic Cloudpickle Deserialization RCE
  Vector: POST /tools/add_tool (proxied to tools_server)
=================================================================

[*] Step 1: Checking target server...
[+] Target is running: {'status': 'Server is running'}

[*] Step 3: Generating cloudpickle RCE payload...
[+] Payload generated (216 bytes base64)

[*] Step 4: Sending exploit to target...
[*] Response status: 500
[!] Error (may still be exploited): HTTP Error 500: Internal Server Error

[*] Step 5: Verifying Remote Code Execution...
[+] SUCCESS! Marker file contents:
    ---
    uid=0(root) gid=0(root) groups=0(root)
    EXPLOITED
    <hostname>
    ---

[+] VULNERABILITY CONFIRMED: CVE-2026-0773
```

> **Note:** The HTTP 500 response on Vector 1 is expected — `os.system()` returns an integer (0), which is not a valid function object, so the application logic fails *after* the RCE has already executed. Vectors 2-3 return HTTP 200, making them stealthier.

## Verification

### Vulnerable Version (v0.55.6)

All 5 deserialization sinks are exploitable:

| # | Endpoint | Field | Result |
|---|----------|-------|--------|
| 1 | `POST /tools/add_tool` | `function` | **RCE CONFIRMED** |
| 2A | `POST /level_one/gpt4o` | `response_format` | **RCE CONFIRMED** |
| 2B | `POST /level_one/gpt4o` | `context` | **RCE CONFIRMED** |
| 3A | `POST /level_two/agent` | `response_format` | **RCE CONFIRMED** |
| 3B | `POST /level_two/agent` | `context` | **RCE CONFIRMED** |

Commands execute as `uid=0(root)` inside the container, providing full system access.

### Patched Version (v0.56.0+)

The entire server architecture was removed in v0.56.0. None of the vulnerable endpoints exist — the application was restructured from a client-server model to a library/SDK model. There is no HTTP server to connect to, and no `cloudpickle.loads()` call reachable via network input.

### Manual Verification

After running any PoC script, verify RCE by checking the marker file inside the container:

```bash
# Vector 1 marker
docker exec cve-2026-0773-vulnerable cat /tmp/cve-2026-0773-pwned

# Vector 2 markers
docker exec cve-2026-0773-vulnerable cat /tmp/cve-2026-0773-level1-response_format
docker exec cve-2026-0773-vulnerable cat /tmp/cve-2026-0773-level1-context

# Vector 3 markers
docker exec cve-2026-0773-vulnerable cat /tmp/cve-2026-0773-level2-response_format
docker exec cve-2026-0773-vulnerable cat /tmp/cve-2026-0773-level2-context
```

## Fix

The vulnerability was resolved in commit [`a54529a`](https://github.com/Upsonic/Upsonic/commit/a54529acc6e4bfe28f4f5c80c058144348a306b7) ("Stability (#360)", 2025-06-15), first included in release **v0.56.0**.

The fix completely removes the entire vulnerable server architecture rather than patching individual endpoints:

- **Deleted** `src/upsonic/tools_server/` — entire directory including the `cloudpickle.loads()` sink
- **Deleted** `src/upsonic/server/` — all proxy endpoints and related deserialization sinks
- **Deleted** `src/upsonic/server_manager.py` — server process management
- **Deleted** `run_main_server.py` and `run_tools_server.py` — server entry points

The project was restructured from a network-accessible client-server model (with FastAPI endpoints) to a library/SDK model. Since all vulnerable network-facing code was removed — not patched — there are no bypass possibilities and no residual attack surface.

> **Note:** This was not an explicit security fix. It was a major architectural refactoring. The ZDI advisory (published January 2026) notes "no patch" because the vendor did not formally acknowledge the CVE, even though the vulnerable code was removed prior to the advisory's publication.

## References

| Source | URL |
|--------|-----|
| ZDI Advisory | https://www.zerodayinitiative.com/advisories/ZDI-26-042/ |
| GitHub Security Advisory | https://github.com/advisories/GHSA-8rrj-mw9c-258v |
| NVD | https://nvd.nist.gov/vuln/detail/CVE-2026-0773 |
| Source Repository | https://github.com/Upsonic/Upsonic |
| Fix Commit | https://github.com/Upsonic/Upsonic/commit/a54529acc6e4bfe28f4f5c80c058144348a306b7 |

## Timeline

| Date | Event |
|------|-------|
| 2025-01-17 | Vulnerable code introduced in v0.36.0 (commit `8c28730`) |
| 2025-05-18 | Last vulnerable release v0.55.6 (commit `97f9f8f`) |
| 2025-06-15 | Vulnerable code removed in "Stability (#360)" refactoring (commit `a54529a`) |
| 2025-06-15 | First patched release v0.56.0 |
| 2026-01-23 | CVE-2026-0773 published; ZDI advisory ZDI-26-042 released |
| 2026-01-23 | Credit: Alessio Dalla Piazza (Equixly) |

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2026-0773 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
