-- Seed a test user for CVE-2025-66489 PoC testing
-- Password: Password123! (bcrypt hash below)

-- Create the test user (non-2FA, CAL identity provider)
-- Note: uuid must be provided explicitly as Prisma handles default generation
INSERT INTO "users" (
    uuid,
    email,
    username,
    name,
    "identityProvider",
    "completedOnboarding",
    "twoFactorEnabled",
    role,
    "emailVerified",
    "timeZone",
    "weekStart",
    locale
) VALUES (
    gen_random_uuid(),
    'victim@example.com',
    'victim',
    'Victim User',
    'CAL',
    true,
    false,
    'USER',
    NOW(),
    'America/New_York',
    'Sunday',
    'en'
) ON CONFLICT DO NOTHING;

-- Create the password entry (bcrypt hash of "Password123!")
INSERT INTO "UserPassword" ("userId", hash)
SELECT id, '$2b$10$zQfXC6SxIG8iuxiWGeYJB.cQRuObMrXS2k9KGTB9/Rp1TxpxN0HqG'
FROM "users"
WHERE email = 'victim@example.com'
ON CONFLICT ("userId") DO NOTHING;
