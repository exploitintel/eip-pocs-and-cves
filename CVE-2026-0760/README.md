# CVE-2026-0760 - MetaGPT Deserialization of Untrusted Data — Remote Code Execution

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field | Value |
|---|---|
| CVE | CVE-2026-0760 |
| Component | [MetaGPT](https://github.com/geekan/MetaGPT) |
| Type | CWE-502: Deserialization of Untrusted Data + eval() Injection |
| CVSS | 9.8 (Critical) — `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H` |
| EPSS | 1.7% (81.9th percentile) |
| Affected | v0.8.1 and all prior versions (UNPATCHED) |
| Fix | None — no official fix released |
| Author | Exploit Intelligence Platform |
| Date | 2026-03-01 |

## Root Cause

The `deserialize_message()` function in `metagpt/utils/serialize.py` (line 75) calls Python's `pickle.loads()` directly on externally-supplied serialized byte data without any validation, sanitization, or restricted unpickler. An attacker can craft a malicious pickle payload using the `__reduce__` protocol that executes arbitrary commands during deserialization — before any application-level checks run.

A secondary `eval()` vulnerability exists in `actionoutput_str_to_mapping()` (line 56 of the same file), providing an independent RCE path through `Message` object construction from user-controlled JSON/dict data.

```python
# metagpt/utils/serialize.py, lines 74-75
def deserialize_message(message_ser: str) -> "Message":
    message = pickle.loads(message_ser)  # <-- CWE-502: ARBITRARY CODE EXECUTION
```

**No authentication required. Network-accessible. Low attack complexity.**

## Lab Setup

### Prerequisites

- Docker and Docker Compose installed

### Quick Start

```bash
cd CVE-2026-0760

# Build and start
docker compose build
docker compose up -d

# Run the exploit
python3 poc/poc.py localhost 8080 cve-2026-0760-vulnerable

# Cleanup
docker compose down
```

### Container Details

| Container | Image | Role | Port |
|---|---|---|---|
| `cve-2026-0760-vulnerable` | `cve-2026-0760-vulnerable:latest` | MetaGPT v0.8.1 with Flask HTTP server | 8080 |

### Verify Lab is Running

```bash
docker compose ps
```

### HTTP Endpoints

| Method | Path | Description |
|---|---|---|
| `GET` | `/` | Info page — lists endpoints and CVE details |
| `GET` | `/health` | Health check — `{"status": "ok", "vulnerable": true}` |
| `POST` | `/api/message/deserialize` | **Vulnerable** — accepts base64-encoded pickle, calls `deserialize_message()` → `pickle.loads()` (CWE-502) |
| `POST` | `/api/message/from-json` | **Vulnerable** — accepts JSON mapping, calls `actionoutput_str_to_mapping()` → `eval()` (CWE-95) |

### Stop Lab

```bash
docker compose down
```

## PoC Usage

Three PoC scripts are provided in the `poc/` directory, each demonstrating a different attack vector.

### Vector 1: Network HTTP Pickle RCE (Primary)

**Script:** `poc/poc.py`

Exploits the HTTP `/api/message/deserialize` endpoint by sending a base64-encoded malicious pickle payload over the network.

```bash
python3 poc/poc.py localhost 8080 cve-2026-0760-vulnerable
```

**Expected output:**
```
[+] ╔══════════════════════════════════════════════════════╗
[+] ║  RCE CONFIRMED — CVE-2026-0760 EXPLOITED            ║
[+] ╚══════════════════════════════════════════════════════╝
[+]
[+] Marker file contents (/tmp/cve-2026-0760-poc-proof.txt):
[+]   uid=0(root) gid=0(root) groups=0(root)
[+]   EXPLOITED
```

> **Note:** The HTTP 500 response is expected. The RCE payload executes during `pickle.loads()` — the error occurs afterward when the deserialized `int` has no `.instruct_content` attribute.

### Vector 2: eval() RCE via HTTP (Secondary)

**Script:** `poc/poc_vector2_eval.py`

Exploits the HTTP `/api/message/from-json` endpoint by sending a JSON mapping with a malicious Python expression. The server passes the mapping to `actionoutput_str_to_mapping()`, which calls `eval()` on each value — a separate code path from the pickle issue (CWE-95).

```bash
python3 poc/poc_vector2_eval.py localhost 8080 cve-2026-0760-vulnerable
```

**Expected output:**
```
[+] ╔══════════════════════════════════════════════════════╗
[+] ║  EVAL RCE CONFIRMED — SECONDARY VECTOR EXPLOITED     ║
[+] ╚══════════════════════════════════════════════════════╝
[+]
[+] Marker file contents (/tmp/cve-2026-0760-eval-proof.txt):
[+]   uid=0(root) gid=0(root) groups=0(root)
[+]   EVAL_RCE
[+]   root
```

### Vector 3: Multi-Payload Pickle RCE (Tertiary)

**Script:** `poc/poc_vector3_direct.py`

Sends three distinct pickle `__reduce__` payloads over HTTP to `/api/message/deserialize`, demonstrating the flexibility of the deserialization primitive:

1. `subprocess.check_output()` — captures command stdout as return value
2. `eval()` + `os.popen()` — shell pipeline with output exfiltration
3. `os.system()` — fire-and-forget command execution with marker file proof

```bash
python3 poc/poc_vector3_direct.py localhost 8080 cve-2026-0760-vulnerable
```

## Fix

### Current Status: UNPATCHED

No official fix has been released. The `pickle.loads()` call on line 75 and the `eval()` call on line 56 remain in the codebase across all available versions (v0.8.1, v0.8.2, HEAD as of 2026-03-01). The ZDI advisory recommends: *"Restrict interaction with the product."*

## References

| Source | Link |
|---|---|
| **ZDI Advisory** | [ZDI-26-026](https://www.zerodayinitiative.com/advisories/ZDI-26-026/) |
| **GHSA Advisory** | GHSA-3xp7-v582-9h3c |
| **NVD Entry** | [CVE-2026-0760](https://nvd.nist.gov/vuln/detail/CVE-2026-0760) |
| **GitHub Repository** | [geekan/MetaGPT](https://github.com/geekan/MetaGPT) |

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2026-0760 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
