# Intel Brief: CVE-2026-0760

## CVE Summary

| Field | Value |
|---|---|
| **CVE ID** | CVE-2026-0760 |
| **Title** | Foundation Agents MetaGPT deserialize_message Deserialization of Untrusted Data RCE |
| **Affected Software** | MetaGPT |
| **Vendor** | deepwisdom (Foundation Agents) |
| **Affected Version** | 0.8.1 (and all prior versions containing `deserialize_message`) |
| **CVSS Score** | 9.8 (Critical) |
| **CVSS Vector** | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |
| **EPSS** | 1.7% (81.9th percentile) |
| **CWE** | CWE-502 (Deserialization of Untrusted Data) |
| **Published** | 2026-01-23 |
| **ZDI Reported** | 2025-09-19 |

## Description

The `deserialize_message` function in `metagpt/utils/serialize.py` (line 75) calls Python's `pickle.loads()` directly on user-supplied serialized data **without any validation, sanitization, or restricted unpickler**. Since Python's `pickle` module can execute arbitrary code during deserialization (via `__reduce__`, `__reduce_ex__`, or other magic methods), an attacker who can supply a crafted pickle payload to this function achieves **remote code execution** in the context of the service account.

**No authentication is required** to exploit this vulnerability. The attack complexity is Low.

### Vulnerable Code

**File:** `metagpt/utils/serialize.py` — Lines 74-83

```python
def deserialize_message(message_ser: str) -> "Message":
    message = pickle.loads(message_ser)       # <-- CWE-502: UNSAFE DESERIALIZATION
    if message.instruct_content:
        ic = message.instruct_content
        actionnode_class = import_class("ActionNode", "metagpt.actions.action_node")
        ic_obj = actionnode_class.create_model_class(class_name=ic["class"], mapping=ic["mapping"])
        ic_new = ic_obj(**ic["value"])
        message.instruct_content = ic_new
    return message
```

The `serialize_message` function (line 69) uses `pickle.dumps()` to serialize `Message` objects. The corresponding `deserialize_message` accepts raw bytes and passes them directly to `pickle.loads()` — the canonical Python unsafe deserialization pattern.

### Secondary Vulnerability (Same File)

**Line 56:** `actionoutput_str_to_mapping()` contains `eval(value)` on user-controlled mapping data, which is also an arbitrary code execution vector.

### Attack Surface

- The `serialize_message`/`deserialize_message` functions handle MetaGPT's internal `Message` objects (defined in `metagpt/schema.py`).
- Messages are serialized for persistence/caching. MetaGPT supports Redis-based memory (`metagpt/utils/redis.py`, `metagpt/memory/brain_memory.py`), meaning serialized messages may be stored in and retrieved from Redis.
- When MetaGPT is deployed as a service, an attacker who can inject a malicious pickle payload into the message store (e.g., via Redis if exposed, or via any API that accepts serialized messages) can achieve RCE.
- The `Message` class (`metagpt/schema.py:188`) is a Pydantic BaseModel with fields: `content`, `instruct_content`, `role`, `cause_by`, `sent_from`, `send_to`.

## Repository Information

| Field | Value |
|---|---|
| **Repository URL** | https://github.com/geekan/MetaGPT.git |
| **Vulnerable Version** | v0.8.1 (tag, commit `c036574507e7616c02512e7c8ad88dd847783afa`) |
| **Fix Commit** | **NONE** — No fix has been applied. The vulnerability still exists in HEAD (latest main branch). ZDI mitigation: "Restrict interaction with the product." |
| **Patched Version** | **NONE** — No patched release exists as of 2026-03-01. The HEAD of main still contains `pickle.loads(message_ser)` in `deserialize_message`. |
| **Currently Checked Out** | v0.8.1 (detached HEAD at `c0365745`) |

### Version History (Relevant Tags)

```
v0.8.2  (2025-03-03) — Still vulnerable
v0.8.1  (2024-04-22) — Confirmed vulnerable (EIP-listed version)
v0.8.0  (2024-03-17)
v0.7.7, v0.7.6, ... — Also contain the same pickle.loads pattern
```

## Build System & Dependencies

| Field | Value |
|---|---|
| **Language** | Python 3 (requires >=3.9, <3.12) |
| **Build System** | setuptools (setup.py + requirements.txt) |
| **Package Name** | `metagpt` |
| **Base Docker Image** | `nikolaik/python-nodejs:python3.9-nodejs20-slim` (per upstream Dockerfile) |
| **Install Command** | `pip install -r requirements.txt && pip install -e .` |

### Key Dependencies (from requirements.txt)

| Package | Version | Relevance |
|---|---|---|
| pydantic | >=2.5.3 | Core data model — `Message` is a Pydantic BaseModel |
| openai | ~=1.64.0 | LLM provider |
| redis | ~=5.0.0 | Message caching / persistence (attack surface) |
| aiohttp | ==3.8.6 | HTTP client |
| grpcio | ~=1.67.0 | gRPC (listed in deps but no proto files found) |
| fire | ==0.4.0 | CLI framework |
| typer | ==0.9.0 | CLI framework |

### Minimal Dependencies for PoC

For a PoC targeting `deserialize_message`, only these are needed:
- `python3` (3.9+)
- `pickle` (stdlib — no install needed)
- `pydantic>=2.5.3` (for Message model)
- `metagpt` package installed (or just the `serialize.py` module)

**Important:** The PoC can be written standalone using only `pickle` from stdlib, since the vulnerability is in `pickle.loads()` directly. A crafted pickle payload will execute before any MetaGPT model validation occurs.

## Public Exploits

**No public exploits found** as of 2026-03-01:
- No Metasploit modules
- No ExploitDB entries
- No GitHub PoC repositories
- No Nuclei scanner templates

## PoC Strategy

The exploitation is straightforward using Python's well-known pickle RCE technique:

1. **Craft malicious pickle payload** using `__reduce__` method:
```python
import pickle
import os

class RCE:
    def __reduce__(self):
        return (os.system, ("id",))

payload = pickle.dumps(RCE())
```

2. **Deliver payload** to `deserialize_message(payload)`:
   - Direct function call (simplest PoC)
   - Via Redis injection if MetaGPT is running with Redis memory backend
   - Via any API endpoint that processes serialized Message objects

3. **Verify execution** by checking command output or callback.

The PoC does NOT require MetaGPT to be fully configured with LLM API keys — only the `deserialize_message` function needs to be called with the malicious payload.

## References

| Source | URL |
|---|---|
| ZDI Advisory | https://www.zerodayinitiative.com/advisories/ZDI-26-026/ |
| GHSA Advisory | GHSA-3xp7-v582-9h3c |
| GitHub Repository | https://github.com/geekan/MetaGPT |
| NVD Entry | https://nvd.nist.gov/vuln/detail/CVE-2026-0760 |
| Vulnerable File | `metagpt/utils/serialize.py` (line 75) |
| Vulnerable Function | `deserialize_message()` |

## Lab Build Notes for Downstream Agents

1. **Docker base image**: Use `python:3.9-slim` (simpler than upstream's node-included image since we don't need Node.js for the PoC).
2. **Install**: `pip install -e .` from the cloned repo at tag v0.8.1. Many dependencies can be skipped if only testing the serialize module — a minimal install of just `pydantic` + the serialize.py file would suffice.
3. **No LLM API keys needed**: The vulnerability is in the serialization utility, not in the LLM pipeline.
4. **The PoC is self-contained**: A standalone Python script that imports `pickle` and calls `deserialize_message()` (or directly `pickle.loads()`) with a crafted payload is sufficient.
5. **Verification**: The PoC should demonstrate arbitrary command execution (e.g., `id`, `whoami`, file creation) triggered by deserialization.
6. **No fix exists**: The lab should reproduce the vulnerability on v0.8.1. There is no patched version to compare against.
