# Intel Brief: CVE-2026-26988

## CVE Summary

| Field | Value |
|-------|-------|
| **CVE ID** | CVE-2026-26988 |
| **Title** | LibreNMS ≤25.12.0 — SQL Injection in ajax_table.php IPv6 Address Search |
| **Affected Software** | LibreNMS |
| **Vendor** | librenms |
| **CVSS Score** | 9.1 (Critical) |
| **CVSS Vector** | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N |
| **CWE** | CWE-89 (Improper Neutralization of Special Elements used in an SQL Command — SQL Injection) |
| **EPSS** | 0.0% |
| **Published** | 2026-02-20 |
| **Reporter** | Snow1nd |

## Description

LibreNMS versions 25.12.0 and below contain an SQL Injection vulnerability in the `ajax_table.php` endpoint when processing address search requests with `search_type=ipv6` (also affects `ipv4`). The application fails to parameterize user input when processing IPv6/IPv4 address prefix values. Specifically, the `address` parameter is split on `/` into an address portion and a prefix portion. The prefix is then directly concatenated into the SQL query string without any validation or escaping:

```php
// Line 52 of includes/html/table/address-search.inc.php (IPv6 path)
$sql .= " AND ipv6_prefixlen = '$prefix'";

// Line 34 (IPv4 path — same pattern)
$sql .= " AND ipv4_prefixlen='$prefix'";
```

An attacker can inject arbitrary SQL by sending a crafted `address` parameter like `2001:db8::1/64' OR SLEEP(6)-- ` where the portion after `/` breaks out of the string literal.

## Vulnerability Details

### Attack Path
1. Attacker sends a POST request to `/ajax_table.php`
2. Parameters: `id=address-search`, `search_type=ipv6`, `address=2001:db8::1/<SQLI_PAYLOAD>`
3. The `address` is split on `/` — the portion after `/` becomes `$prefix`
4. `$prefix` is directly concatenated into the SQL WHERE clause without parameterization
5. The injected SQL executes against the MySQL database

### Input Flow
- `html/ajax_table.php` receives the HTTP request
- Line 40: `$id = basename((string) $_REQUEST['id']);` → resolves to `address-search`
- Line 43-45: Includes `includes/html/table/address-search.inc.php`
- Inside the included file, `$vars` is populated from `$_POST` (via `includes/html/vars.inc.php` line 9-11, **no sanitization on POST values**)
- `$vars['address']` is split on `/` at line 20-22
- The prefix portion is concatenated directly into SQL at line 34 (ipv4) or line 52 (ipv6)

### Authentication Requirement
The `ajax_table.php` file checks `Auth::check()` on line 20-22 and returns "Unauthorized" for unauthenticated requests. A valid LibreNMS session cookie is required. However, **no CSRF token is needed** — this is a legacy PHP endpoint that bypasses Laravel's CSRF middleware.

## Repository & Version Information

| Field | Value |
|-------|-------|
| **Repository URL** | https://github.com/librenms/librenms.git |
| **Vulnerable Version** | 25.12.0 (tag `25.12.0`, commit `dc27eaef9f8079c7f64b84d1488d956b2aac75ad`) |
| **Fix Commit** | `15429580baba03ed1dd377bada1bde4b7a1175a1` ("Rewrite address search backend (#18777)") |
| **Fix Merged** | 2026-01-15 (authored by Tony Murray) |
| **Patched Version** | 26.2.0 (first release tag containing the fix) |
| **Checked-Out Version** | `25.12.0` |

### Version Timeline
- `25.12.0` (2025-12-15) — Last vulnerable release (confirmed, source checked out here)
- `26.1.0` (2026-01-12) — Still vulnerable (fix NOT yet merged)
- `26.1.1` (2026-01-23) — Still vulnerable (fix merged Jan 15 but not in this tag's branch)
- `26.2.0` (2026-02-16) — First patched release (fix confirmed present)

## Build System & Dependencies

| Field | Value |
|-------|-------|
| **Primary Language** | PHP (^8.2) |
| **Build System** | Composer (PHP dependency manager) + npm (frontend assets) |
| **Framework** | Laravel (via `laravel/framework`) |
| **Database** | MySQL / MariaDB (required) |
| **Web Server** | nginx + php-fpm (in official Docker image) |
| **Key PHP Extensions** | ext-curl, ext-gd, ext-json, ext-mbstring, ext-pcre, ext-pdo, ext-session, ext-simplexml, ext-sockets, ext-xml, ext-zlib |
| **Optional Services** | Redis, RRDcached, Memcached |

### Docker Image Available
The official Docker image `librenms/librenms:25.12.0` is available on Docker Hub and provides the exact vulnerable version. This is the **recommended approach for lab setup** — avoids building PHP from source.

**Required services for docker-compose:**
- LibreNMS container (`librenms/librenms:25.12.0`)
- MySQL/MariaDB database container (`mariadb:10.11`)
- (Optional) Redis for caching

## Vulnerable File

**Path:** `includes/html/table/address-search.inc.php`

**Injection points (confirmed in checked-out source):**
- **Line 34 (IPv4):** `$sql .= " AND ipv4_prefixlen='$prefix'";`
- **Line 52 (IPv6):** `$sql .= " AND ipv6_prefixlen = '$prefix'";`

The fix commit **deletes this file entirely** and replaces it with three new controller classes using Laravel Eloquent ORM with parameterized queries:
- `app/Http/Controllers/Table/Ipv4AddressSearchController.php`
- `app/Http/Controllers/Table/Ipv6AddressSearchController.php`
- `app/Http/Controllers/Table/MacSearchController.php`

## Public Exploits

### 1. mbanyamer/CVE-2026-26988-LibreNMS-SQLi (Exploit #116383) — RECOMMENDED

| Field | Value |
|-------|-------|
| **Source** | GitHub (nomisec) |
| **Author** | Mohammed Idrees Banyamer |
| **Classification** | `working_poc` (95% confidence) |
| **Trojan Check** | CLEAN — no deception indicators |
| **Attack Type** | SQLi |
| **Complexity** | Trivial |
| **Reliability** | Reliable |
| **Requires Auth** | No (per analysis; but LibreNMS does check Auth::check()) |
| **Language** | Python 3 (requires `requests` library) |
| **URL** | https://github.com/mbanyamer/CVE-2026-26988-LibreNMS-SQLi |

**Summary:** Functional Python PoC targeting the `ajax_table.php` endpoint via the `ipv6_prefixlen` parameter. Supports three modes:
- `--test`: Basic syntax error injection (single quote breakout)
- `--boolean`: Boolean-based blind SQLi confirmation
- `--time`: Time-based blind SQLi confirmation (SLEEP)
- `--payload`: Custom injection payload

**Usage:** `python3 exploit.py http://target/librenms --time`

**Code retrieved and saved to:** `poc/reference_exploit.py`

### 2. XiaomingX/data-cve-poc-py-v1 (Exploit #122132) — SKIP (MISLABELED)

| Field | Value |
|-------|-------|
| **Classification** | `working_poc` (95% confidence) |
| **Issue** | **Targets WordPress Quiz Maker (CVE-2025-10042), NOT LibreNMS** |
| **Verdict** | SKIP — wrong vulnerability, mislabeled in repository |

### 3. Fix Commit Writeup (Exploit #116344)

| Field | Value |
|-------|-------|
| **Classification** | `writeup` |
| **URL** | The fix commit itself |
| **Verdict** | Reference only — shows the patch diff |

## References

| Type | URL |
|------|-----|
| **Fix Commit** | https://github.com/librenms/librenms/commit/15429580baba03ed1dd377bada1bde4b7a1175a1 |
| **Pull Request** | https://github.com/librenms/librenms/pull/18777 |
| **Security Advisory** | https://github.com/librenms/librenms/security/advisories/GHSA-h3rv-q4rq-pqcv |
| **Docker Image (vuln)** | https://hub.docker.com/r/librenms/librenms (tag: `25.12.0`) |
| **Docker Setup Guide** | https://github.com/librenms/docker |

## Lab Reproduction Notes

### Recommended Lab Architecture
1. **Use the official Docker image** `librenms/librenms:25.12.0` — avoids building from source
2. **MariaDB 10.11 container** — LibreNMS requires a MySQL-compatible backend
3. **docker-compose** with LibreNMS + MariaDB + optional Redis
4. Existing lab artifacts at `lab/`

### PoC Execution Steps
1. Deploy LibreNMS 25.12.0 via Docker
2. Complete initial setup (create admin user, seed test data)
3. Authenticate via HTTP POST `/login` to get session cookie
4. Send crafted POST to `/ajax_table.php`:
   ```
   POST /ajax_table.php
   Content-Type: application/x-www-form-urlencoded
   Cookie: <session_cookie>

   id=address-search&search_type=ipv6&address=::1/1' OR SLEEP(5)-- -&current=1&rowCount=10
   ```
5. A ~5+ second delay confirms the SQL injection (SLEEP fires per-row in both COUNT and SELECT queries)

### Verification of Fix
After deploying version 26.2.0, the same request returns immediately (no delay) because the vulnerable file is deleted and replaced by parameterized Eloquent queries.

### Key PoC Notes
- No CSRF token required for `ajax_table.php` (legacy endpoint bypasses Laravel CSRF middleware)
- POST data preferred over GET (POST values not sanitized with `strip_tags()`)
- Both IPv4 (`search_type=ipv4`) and IPv6 (`search_type=ipv6`) paths are injectable
- MAC search path (`search_type=mac`) is NOT vulnerable
- Database must contain at least one row in `ipv6_addresses`/`ipv4_addresses` for SLEEP to fire per-row
- Session cookie name is typically `laravel_session` (may vary by config)
