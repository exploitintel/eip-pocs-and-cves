# CVE-2025-7734 Lab Environment
# GitLab CE 18.0.5 â€” Stored XSS in Code Navigation
#
# Usage:
#   docker compose up -d
#   # Wait ~3 minutes for GitLab to initialize
#   docker compose ps   # STATUS should show "healthy"

services:
  gitlab:
    image: gitlab/gitlab-ce:18.0.5-ce.0
    container_name: cve-2025-7734-gitlab
    hostname: gitlab.local
    ports:
      - "8880:80"
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://gitlab.local'
        gitlab_rails['initial_root_password'] = 'LabPass2025!'
        # Reduce memory usage
        puma['worker_processes'] = 2
        sidekiq['max_concurrency'] = 5
        prometheus_monitoring['enable'] = false
        alertmanager['enable'] = false
        # Disable unnecessary services
        gitlab_kas['enable'] = false
        sentinel['enable'] = false
    shm_size: '512m'
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost/-/health"]
      interval: 15s
      timeout: 10s
      retries: 40
      start_period: 120s
    volumes:
      - gitlab-config:/etc/gitlab
      - gitlab-logs:/var/log/gitlab
      - gitlab-data:/var/opt/gitlab

volumes:
  gitlab-config:
  gitlab-logs:
  gitlab-data:
