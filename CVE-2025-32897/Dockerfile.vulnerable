# CVE-2025-32897: Apache Seata Insecure Deserialization in Raft Cluster
# Vulnerable version: 2.2.0
FROM apache/seata-server:2.2.0

# Copy the Raft-mode entrypoint wrapper
COPY entrypoint-raft.sh /entrypoint-raft.sh
RUN chmod +x /entrypoint-raft.sh

# Expose ports:
#   7091 - HTTP console (Spring Boot web UI, default creds: seata:seata)
#   8091 - Seata TC (Transaction Coordinator) service port
#   9091 - Raft cluster port (SOFABolt TCP RPC) - THE ATTACK SURFACE
EXPOSE 7091 8091 9091

ENTRYPOINT ["/bin/bash", "/entrypoint-raft.sh"]
