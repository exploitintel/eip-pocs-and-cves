# Intel Brief: CVE-2025-66524

## CVE Overview

- **CVE ID**: CVE-2025-66524
- **Title**: Apache NiFi GetAsanaObject Processor Remote Code Execution via Unsafe Deserialization
- **Published**: 2025-12-19
- **Reported**: 2025-12-01
- **Resolved**: 2025-12-04
- **Finder**: Jaeyeong Lee

## Affected Software

- **Software**: Apache NiFi
- **Vendor**: Apache Software Foundation
- **Affected Component**: `GetAsanaObject` Processor in the `nifi-asana-processors` bundle
- **Maven Artifact**: `org.apache.nifi:nifi-asana-processors`
- **Affected Versions**: 1.20.0 through 2.6.0 (inclusive)
- **Patched Version**: 2.7.0

## Severity

- **CVSS Score**: 8.8 (HIGH)
- **CVSS Vector**: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
- **Attack Vector**: Network
- **Attack Complexity**: Low
- **Privileges Required**: Low
- **User Interaction**: None
- **EPSS**: 0.2% (36.2th percentile)

## CWE Classification

- **CWE-502**: Deserialization of Untrusted Data
- **Description**: The product deserializes untrusted data without sufficiently ensuring that the resulting data will be valid.

## Vulnerability Description

The `GetAsanaObject` Processor in Apache NiFi uses a configurable Distributed Map Cache Client Service for storing and retrieving state information. The processor's `GenericObjectSerDe` class implemented generic Java Object serialization and deserialization using `java.io.ObjectInputStream` and `java.io.ObjectOutputStream` without any class filtering or type validation.

**Root Cause**: The `GenericObjectSerDe.deserialize()` method calls `ObjectInputStream.readObject()` on data retrieved from the configured cache server, performing an unchecked cast `(V) objectInputStream.readObject()`. This allows an attacker who has direct access to the configured Distributed Map Cache Client Service to store crafted serialized Java objects that will be deserialized by the processor, potentially leading to Remote Code Execution (RCE).

**Attack Requirements**:
1. The target Apache NiFi instance must be running the `GetAsanaObject` Processor
2. The attacker must have direct access to the configured Distributed Map Cache Client Service
3. The attacker can inject maliciously crafted serialized Java objects into the cache

**Vulnerable Code Path**:
- `GetAsanaObject.recoverState()` → calls `client.get()` with `STATE_MAP_VALUE_SERIALIZER` (a `GenericObjectSerDe<Map<String, String>>`)
- `GenericObjectSerDe.deserialize()` → creates `ObjectInputStream` and calls `readObject()` without filtering

## Source Repository

- **Repository URL**: https://github.com/apache/nifi.git
- **Repository Type**: Git (GitHub)
- **Language**: Java (JDK 21)
- **Build System**: Apache Maven (multi-module project)

## Version Information

- **Vulnerable Version (checked out)**: `rel/nifi-2.6.0` (tag)
- **Patched Version**: `rel/nifi-2.7.0` (tag)
- **Fix Commit**: `1c081c15544b8459d69daaae2056f0f433cafce6`
- **Fix Author**: David Handermann (exceptionfactory)
- **Fix Committer**: Pierre Villard
- **Fix Date**: 2025-12-03 to 2025-12-04
- **JIRA Issue**: NIFI-15292
- **GitHub PR**: #10599

## Fix Details

The fix replaced generic Java Object serialization with type-safe, JSON-based serialization:

### Files Changed:
1. **DELETED**: `GenericObjectSerDe.java` — Removed the vulnerable generic serializer/deserializer that used `ObjectInputStream`/`ObjectOutputStream`
2. **ADDED**: `StringSerDe.java` — New String serializer using UTF-8 charset encoding (no Java Object serialization)
3. **ADDED**: `MapStringSerDe.java` — New `Map<String, String>` serializer using Google Gson JSON serialization
4. **MODIFIED**: `GetAsanaObject.java` — Changed `STATE_MAP_KEY_SERIALIZER` from `GenericObjectSerDe<String>` to `StringSerDe`, and `STATE_MAP_VALUE_SERIALIZER` from `GenericObjectSerDe<Map<String, String>>` to `MapStringSerDe`

### Key Code Change in GetAsanaObject.java:
```java
// BEFORE (vulnerable):
protected static final GenericObjectSerDe<String> STATE_MAP_KEY_SERIALIZER = new GenericObjectSerDe<>();
protected static final GenericObjectSerDe<Map<String, String>> STATE_MAP_VALUE_SERIALIZER = new GenericObjectSerDe<>();

// AFTER (fixed):
protected static final StringSerDe STATE_MAP_KEY_SERIALIZER = new StringSerDe();
protected static final MapStringSerDe STATE_MAP_VALUE_SERIALIZER = new MapStringSerDe();
```

## Build System

- **Build Tool**: Apache Maven
- **Java Version**: 21 (maven.compiler.release=21)
- **Root Artifact**: `org.apache.nifi:nifi` (POM packaging, multi-module)
- **Vulnerable Module Path**: `nifi-extension-bundles/nifi-asana-bundle/nifi-asana-processors`
- **Packaging**: JAR (bundled into NAR for NiFi deployment)

## Key Dependencies (for nifi-asana-processors)

- `org.apache.nifi:nifi-distributed-cache-client-service-api` — Provides `DistributedMapCacheClient`, `Serializer`, `Deserializer` interfaces
- `org.apache.nifi:nifi-asana-services-api:2.6.0` — Asana client service API
- `com.google.code.gson:gson` — JSON serialization (used by the fix, already present as dependency)
- `org.apache.httpcomponents:httpcore` — HTTP support
- `com.asana:asana` — Asana Java client SDK
- `org.apache.commons:commons-collections4` — Collections utilities
- `com.google.http-client:google-http-client:1.36.0` — Google HTTP client

## Vulnerable File Locations

```
nifi-extension-bundles/nifi-asana-bundle/nifi-asana-processors/src/main/java/org/apache/nifi/processors/asana/
├── GetAsanaObject.java          # Main processor (uses GenericObjectSerDe)
├── GenericObjectSerDe.java      # VULNERABLE: ObjectInputStream.readObject() without filtering
└── ... (other Asana utility classes)
```

## Public Exploits

**No public exploits found.** The EIP database shows zero exploits for this CVE. No Metasploit modules, ExploitDB entries, or GitHub PoCs were identified.

This is expected given:
- The CVE was recently published (2025-12-19)
- Exploitation requires access to the NiFi Distributed Map Cache service (not directly internet-exposed)
- Java deserialization exploits require specific gadget chains to be on the classpath

## PoC Development Notes

To reproduce this vulnerability, a PoC would need to:
1. **Set up a vulnerable NiFi instance** (version 2.6.0) with the GetAsanaObject Processor configured
2. **Set up a Distributed Map Cache Server** that the GetAsanaObject Processor connects to
3. **Inject a malicious serialized Java object** into the cache at the key corresponding to the processor's identifier
4. **Trigger the processor** to call `recoverState()` which deserializes the cached object via `GenericObjectSerDe.deserialize()`
5. **Gadget chain**: Standard Java deserialization gadget chains (e.g., Commons Collections, Commons BeanUtils) would be needed. Check NiFi's classpath for available gadgets.

Key observations for PoC:
- The cache key is the processor's identifier (`getIdentifier()`) — a UUID
- The value serializer deserializes `Map<String, String>` but `GenericObjectSerDe.deserialize()` accepts arbitrary objects
- The `DistributedMapCacheClient` uses a custom TCP protocol (NiFi's distributed cache protocol)
- NiFi ships with `commons-collections4` which may provide gadget chain classes

## References

| Type | URL |
|------|-----|
| Vendor Advisory | https://lists.apache.org/thread/k9h004ydjg7opdvxr0nfywtzf33z60d7 |
| OSS-Security | http://www.openwall.com/lists/oss-security/2025/12/18/2 |
| GitHub Advisory | https://github.com/advisories/GHSA-v4p2-2w39-mhrj |
| JIRA Issue | https://issues.apache.org/jira/browse/NIFI-15292 |
| Fix Commit | https://github.com/apache/nifi/commit/1c081c15544b8459d69daaae2056f0f433cafce6 |
| GitHub PR | https://github.com/apache/nifi/pull/10599 |
| NVD | https://nvd.nist.gov/vuln/detail/CVE-2025-66524 |
| CVE Record | https://www.cve.org/CVERecord?id=CVE-2025-66524 |
| Apache NiFi | https://nifi.apache.org/ |

## Source Reference

- **Source tag**: `rel/nifi-2.6.0` (vulnerable version)
- **Vulnerable module**: `nifi-extension-bundles/nifi-asana-bundle/nifi-asana-processors/`
