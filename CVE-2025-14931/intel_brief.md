# Intel Brief: CVE-2025-14931

## CVE Summary

| Field | Value |
|-------|-------|
| **CVE ID** | CVE-2025-14931 |
| **Affected Software** | Hugging Face smolagents |
| **Vendor** | Hugging Face |
| **CVSS Score** | 10.0 (CRITICAL) |
| **CVSS Vector** | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H |
| **CWE** | CWE-502 — Deserialization of Untrusted Data |
| **EPSS** | 1.9% (82.9th percentile) |
| **Published** | 2025-12-23 |
| **ZDI Tracking** | ZDI-25-1143 (ZDI-CAN-28312) |
| **GHSA** | GHSA-q9r5-6hrr-9ph7 |

## Description

Hugging Face smolagents Remote Python Executor contains an unsafe deserialization vulnerability. The `RemotePythonExecutor` base class and all its subclasses (`E2BExecutor`, `DockerExecutor`, `ModalExecutor`, `BlaxelExecutor`, `WasmExecutor`) use `pickle.loads()` to deserialize data received from remote code execution environments without any validation or safety checks.

The specific flaw exists in the parsing of pickle data returned by remote executors when handling `FinalAnswerException` responses. When a remote executor (e.g., a Jupyter kernel in a Docker container, E2B sandbox, etc.) returns a final answer, the result is base64-encoded pickle data that is deserialized on the HOST side using `pickle.loads()`. An attacker who can control or inject data into the remote execution environment can craft a malicious pickle payload that achieves arbitrary code execution on the host machine.

**Authentication is not required** to exploit this vulnerability. The attack vector is network-based with no user interaction needed.

## Vulnerable Code Locations

In `src/smolagents/remote_executors.py` (version 1.24.0):

1. **Line 194** — `E2BExecutor.run_code_raise_errors()`:
   ```python
   final_answer = pickle.loads(base64.b64decode(execution.error.value))
   ```

2. **Line 309** — `_websocket_run_code_raise_errors()` (used by DockerExecutor, ModalExecutor, BlaxelExecutor):
   ```python
   result = pickle.loads(base64.b64decode(msg_content.get("evalue", "")))
   ```

3. **Line 969** — `WasmExecutor.run_code_raise_errors()`:
   ```python
   result = pickle.loads(base64.b64decode(error["pythonExceptionValue"]))
   ```

4. **Line 98** — `RemotePythonExecutor.send_variables()` (sends pickle to remote, less critical but part of the pattern):
   ```python
   vars_dict = pickle.loads(base64.b64decode('{pickled_vars}'))
   ```

## Attack Vector Analysis

The most practical attack path involves the `DockerExecutor`:

1. The smolagents host creates a DockerExecutor which runs a Jupyter kernel in a Docker container
2. The host sends Python code to the Jupyter kernel for execution via WebSocket
3. Code executing in the container can raise a `FinalAnswerException` with an arbitrary payload
4. The host receives this exception via WebSocket and calls `pickle.loads()` on the payload
5. A crafted pickle payload triggers arbitrary code execution **on the host**

The critical insight is that code running INSIDE the sandboxed environment (Docker/E2B/Modal/etc.) can escape to execute code on the HOST by sending a malicious pickle payload as a "final answer." This defeats the purpose of sandbox isolation.

For a PoC, one can:
- Run smolagents with a DockerExecutor
- Execute code in the container that raises `FinalAnswerException` with a crafted pickle payload
- The pickle payload uses `__reduce__` to call `os.system()` or similar on the host

## Repository

| Field | Value |
|-------|-------|
| **Repository URL** | https://github.com/huggingface/smolagents.git |
| **Language** | Python |
| **Build System** | setuptools (pyproject.toml) |
| **Python Requirement** | >=3.10 |

## Version Information

| Field | Value |
|-------|-------|
| **First Vulnerable Version** | v1.10.0 (first release containing `remote_executors.py` with `pickle.loads`) |
| **Last Vulnerable Version** | v1.24.0 (latest release, 2026-01-16) |
| **Vulnerable Version Range** | v1.10.0 through v1.24.0 |
| **Checked-Out Version** | v1.24.0 (tag) |
| **Fix Commit** | `41a3b005fadc6edd587a3ac6f6812987da405e26` (2026-02-15, PR #1637) |
| **Patched Version** | No tagged release yet (fix is on main branch post-v1.24.0) |

### Fix Commit Details

- **Hash**: `41a3b005fadc6edd587a3ac6f6812987da405e26`
- **Date**: 2026-02-15
- **Title**: "Fix High impact vulnerability on remote executors (#1637)"
- **Authors**: Natann (nnfrog), Albert Villanova del Moral, Copilot
- **Files Changed**:
  - `src/smolagents/__init__.py` — exports new serialization module
  - `src/smolagents/remote_executors.py` — replaces `pickle.loads()` with `SafeSerializer`
  - `src/smolagents/serialization.py` — NEW: `SafeSerializer` class with JSON-based safe serialization
  - `tests/test_serialization.py` — NEW: comprehensive serialization tests

### Follow-up Fix Commits

- `b48889204ad50b6dce7546ae364eedc6ceb87d46` (2026-02-15): "Fix SafeSerializer.get_deserializer_code (#1983)"
- `bb2dab0671a835a5a43ffe171a3886e39907af72` (2026-02-15): "Test 'pickle:...' payloads are properly decoded (#1985)"
- `7f21b7480e9510cbee57ec5cae8969646a1f17ed` (2026-02-15): "Fix RemotePythonExecutor._deserialize_final_answer for legacy no-prefix pickle (#1984)"
- `440e91923d79145fadfb206e56ad91fc23251eb0` (2026-02-21): "Remove support for legacy no-prefix pickle (#1986)"

### How the Fix Works

The fix introduces a `SafeSerializer` class that replaces direct `pickle.loads()` calls with:
1. **Default safe mode** (`allow_pickle=False`): Uses JSON-based serialization only. Handles common Python types (str, int, float, bool, None, dict, list, tuple, set, bytes, complex, frozenset, PIL.Image, datetime, Decimal, Path, numpy arrays, dataclasses).
2. **Legacy mode** (`allow_pickle=True`): Tries safe JSON first, falls back to pickle with a warning. The `_deserialize_final_answer()` method checks for `safe:` or `pickle:` prefixes and rejects pickle data when `allow_pickle=False`.
3. All executor subclasses now accept `allow_pickle` parameter (default `False`).

## Build System & Dependencies

### Core Dependencies (from pyproject.toml)
- `huggingface-hub>=0.31.2,<1.0.0`
- `requests>=2.32.3`
- `rich>=13.9.4`
- `jinja2>=3.1.4`
- `pillow>=10.0.1`
- `python-dotenv`

### Dependencies for DockerExecutor (most practical for lab)
- `docker>=7.1.0` (pip extra: `smolagents[docker]`)
- `websocket-client`
- Requires Docker daemon running

### Build/Install Commands
```bash
pip install -e ".[docker]"  # Install with Docker executor support
# or
pip install smolagents==1.24.0  # Install specific vulnerable version
pip install "smolagents[docker]==1.24.0"  # With Docker support
```

## Public Exploits

**No public exploits found** in EIP (ExploitDB, GitHub, Metasploit, etc.)

The ZDI advisory (ZDI-25-1143) was published as a 0-day on 2025-12-18 after the vendor initially rejected/closed the report as a duplicate. No PoC code was disclosed.

## References

| Source | URL |
|--------|-----|
| ZDI Advisory | https://www.zerodayinitiative.com/advisories/ZDI-25-1143/ |
| NVD | https://nvd.nist.gov/vuln/detail/CVE-2025-14931 |
| GHSA | https://github.com/advisories/GHSA-q9r5-6hrr-9ph7 |
| GitHub Repository | https://github.com/huggingface/smolagents |
| Fix PR | https://github.com/huggingface/smolagents/pull/1637 |
| Fix Commit | https://github.com/huggingface/smolagents/commit/41a3b005fadc6edd587a3ac6f6812987da405e26 |

