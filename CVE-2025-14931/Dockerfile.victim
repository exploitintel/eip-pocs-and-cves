# CVE-2025-14931 — Victim container (smolagents v1.24.0)
FROM python:3.12-slim-bookworm

LABEL description="Victim container with smolagents v1.24.0 for CVE-2025-14931 PoC"
LABEL role="victim"

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Install smolagents v1.24.0 (vulnerable) with websocket-client
# Use --no-audit to bypass pip vulnerability warnings
RUN pip install --no-cache-dir \
    "smolagents==1.24.0" \
    "websocket-client>=1.6.0"

WORKDIR /app

# Create a verification script to confirm the vulnerable code path exists
RUN python3 -c "\
from smolagents.remote_executors import _websocket_run_code_raise_errors; \
import pickle, base64; \
print('smolagents v1.24.0 installed — vulnerable pickle.loads() path confirmed')"

# Copy PoC scripts into the container
COPY trigger_exploit.py /app/trigger_exploit.py
COPY poc/poc.py /app/poc.py
COPY poc/poc_vector2.py /app/poc_vector2.py
COPY poc/poc_vector3.py /app/poc_vector3.py

# Keep container running for exec access
CMD ["sleep", "infinity"]
