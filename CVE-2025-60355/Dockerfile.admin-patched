# Runtime for OneBlog 2.3.9 blog-admin (patched)
# Multi-stage: builds from source, then packages into a slim JRE image.
FROM maven:3.8.6-openjdk-8-slim AS builder
RUN apt-get update && apt-get install -y --no-install-recommends git && rm -rf /var/lib/apt/lists/*
WORKDIR /build
RUN git clone https://github.com/zhangyd-c/OneBlog.git .
RUN git checkout ac1c801f06a595dab6d3a9c26d4a130b0ca5fac2
RUN mvn clean package -DskipTests -Pdev -pl blog-core,blog-admin -am --batch-mode

FROM eclipse-temurin:8-jre-jammy
ENV TZ=UTC
RUN mkdir -p /var/tmp/oneblog
EXPOSE 8085
COPY --from=builder /build/blog-admin/target/blog-admin.jar /app.jar
ENTRYPOINT ["java", "-jar", "/app.jar", "-Djava.security.egd=file:/dev/./urandom"]
