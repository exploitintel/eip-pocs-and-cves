# Runtime for OneBlog 2.3.8 blog-web (vulnerable)
# Multi-stage: builds from source, then packages into a slim JRE image.
FROM maven:3.8.6-openjdk-8-slim AS builder
RUN apt-get update && apt-get install -y --no-install-recommends git && rm -rf /var/lib/apt/lists/*
WORKDIR /build
RUN git clone https://github.com/zhangyd-c/OneBlog.git .
RUN git checkout 8669276
RUN mvn clean package -DskipTests -Pdev -pl blog-core,blog-web -am --batch-mode

FROM eclipse-temurin:8-jre-jammy
ENV TZ=UTC
RUN mkdir -p /var/tmp/oneblog
EXPOSE 8443
COPY --from=builder /build/blog-web/target/blog-web.jar /app.jar
ENTRYPOINT ["java", "-jar", "/app.jar", "-Djava.security.egd=file:/dev/./urandom"]
